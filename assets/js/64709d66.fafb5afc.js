"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7127],{43:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>l});var i=t(5893),o=t(1151);const s={},a="Evaluation",r={id:"server/evaluation",title:"Evaluation",description:"This guide is a work in progress. Currently, it just contains",source:"@site/docs/server/evaluation.md",sourceDirName:"server",slug:"/server/evaluation",permalink:"/chatbot/server/evaluation",draft:!1,unlisted:!1,editUrl:"https://github.com/mongodb/chatbot/tree/main/docs/docs/server/evaluation.md",tags:[],version:"current",frontMatter:{},sidebar:"main",previous:{title:"Context Engineering",permalink:"/chatbot/server/context-engineering"},next:{title:"Chatbot UI",permalink:"/chatbot/ui"}},c={},l=[{value:"Do Not Use Sensitive Customer Data in Evaluations",id:"do-not-use-sensitive-customer-data-in-evaluations",level:2},{value:"Evaluation API",id:"evaluation-api",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Evaluation in CI/CD",id:"evaluation-in-cicd",level:3},{value:"Braintrust Evaluation Platform",id:"braintrust-evaluation-platform",level:2},{value:"Run Evaluations",id:"run-evaluations",level:3},{value:"Responses API Staging Tracing",id:"responses-api-staging-tracing",level:3}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"evaluation",children:"Evaluation"}),"\n",(0,i.jsx)(n.admonition,{title:"Work in Progress",type:"info",children:(0,i.jsx)(n.p,{children:"This guide is a work in progress. Currently, it just contains\nthe minimum information to get started writing evals\nagainst the MongoDB Responses API"})}),"\n",(0,i.jsxs)(n.p,{children:["This guide contains information about writing evaluations against the ",(0,i.jsx)(n.a,{href:"/chatbot/server/responses-api",children:"MongoDB Responses API"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"When developing against the Responses API, you should write evaluations to understand the quality of your AI system and iteratively improve it."}),"\n",(0,i.jsx)(n.h2,{id:"do-not-use-sensitive-customer-data-in-evaluations",children:"Do Not Use Sensitive Customer Data in Evaluations"}),"\n",(0,i.jsx)(n.p,{children:"NEVER use sensitive customer data in your evaluations. Period."}),"\n",(0,i.jsx)(n.p,{children:"Use either fake data or anonymize real customer data, in line with information security best practices.\nIf you are not sure if you can use some data, assume that you cannot.\nReach out to the Information Security team with any questions about data usage."}),"\n",(0,i.jsx)(n.h2,{id:"evaluation-api",children:"Evaluation API"}),"\n",(0,i.jsx)(n.p,{children:"To run evaluations against the MongoDB Responses API, use the following base endpoint:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://chat-server.docs.staging.corp.mongodb.com/api/v1/\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This endpoint bypasses the Web Application Firewall (WAF) and CloudFront protections that we have on the standard staging API, ",(0,i.jsx)(n.code,{children:"http://knowledge.staging.corp.mongodb.com/"}),", and the production API ",(0,i.jsx)(n.code,{children:"http://knowledge.mongodb.com/"}),". Do not run evaluations against these APIs. You will get ",(0,i.jsx)(n.code,{children:"4XX"})," errors from CloudFront!"]}),"\n",(0,i.jsx)(n.p,{children:"To use the evaluation API, you must authenticate. Refer to the following section for authentication information."}),"\n",(0,i.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsxs)(n.admonition,{title:"Intentionally Vague",type:"info",children:[(0,i.jsx)(n.p,{children:"This section is intentionally a bit vague because this docs site is currently on the public internet, and we do not want to expose much information on our internal authentication systems. Sorry!"}),(0,i.jsxs)(n.p,{children:["If you have any questions, ",(0,i.jsx)(n.a,{href:"/chatbot/contact",children:"contact the Education AI team"}),"."]})]}),"\n",(0,i.jsxs)(n.p,{children:["Unlike the standard staging/production APIs, you must authenticate into the evaluation API. Authenticate with the header ",(0,i.jsx)(n.code,{children:"X-Kanopy-Authorization: Bearer {{authToken}}"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["You can use the ",(0,i.jsx)(n.code,{children:"kanopy-oidc"})," utility to get an auth token:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"kanopy-oidc login\n"})}),"\n",(0,i.jsx)(n.p,{children:"Minimal example with curl:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:'curl -i -X POST https://chat-server.docs.staging.corp.mongodb.com/api/v1/ \\\n-H "X-Kanopy-Authorization: Bearer $(kanopy-oidc login)"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.strong,{children:"authentication works"}),", you should receive a ",(0,i.jsx)(n.code,{children:"200"})," response resembling:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'HTTP/2 200 \n...other stuff\n\nevent: error\ndata: {"status":400,"headers":{},"requestID":null,"error":{"type":"error","code":"invalid_request_error","message":"Path: body.model - Required | Path: body.input - Invalid input | Path: body.stream - Required","name":"Error"},"code":"invalid_request_error","param":null,"type":"error","sequence_number":0}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.strong,{children:"authentication does not work"}),", you should receive a ",(0,i.jsx)(n.code,{children:"302"})," response resembling:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'HTTP/2 302 \n...other stuff\n\n<a href="https://login.corp.mongodb.com/login?redirect=https%3A%2F%2Fchat-server.docs.staging.corp.mongodb.com%2Fapi%2Fv1%2F">Found</a>.\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The response is ",(0,i.jsx)(n.code,{children:"302"})," because its redirecting you to login through a UI,\nwhich you cannot do when programmatically running evals."]}),"\n",(0,i.jsx)(n.p,{children:"You can programmatically inject the token into locally-run evaluations with an environment variable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"MY_ENV_VAR=$(kanopy-oidc login) npx braintrust eval path/to/some.eval.ts\n"})}),"\n",(0,i.jsx)(n.h3,{id:"evaluation-in-cicd",children:"Evaluation in CI/CD"}),"\n",(0,i.jsx)(n.admonition,{title:"Coming Soon",type:"info",children:(0,i.jsx)(n.p,{children:"Sorry, not yet \ud83d\ude22"})}),"\n",(0,i.jsx)(n.p,{children:"Currently, you cannot run evaluations in a CI/CD environment. We will add this feature after we complete a migration of our server to a new environment."}),"\n",(0,i.jsx)(n.h2,{id:"braintrust-evaluation-platform",children:"Braintrust Evaluation Platform"}),"\n",(0,i.jsxs)(n.p,{children:["We use ",(0,i.jsx)(n.a,{href:"https://www.braintrust.dev/home",children:"Braintrust"})," as an evaluation platform as a service. You can run evaluations in it. To learn more about Braintrust, refer to its official documentation, ",(0,i.jsx)(n.a,{href:"https://braintrust.com/docs",children:"https://braintrust.com/docs"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["To set up Braintrust, ",(0,i.jsx)(n.a,{href:"/chatbot/contact",children:"contact the Education AI team"}),". The Education AI team will:"]}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add you to Slack channel ",(0,i.jsx)(n.code,{children:"#ext-braintrust-mongodb"}),". You can talk to the Braintrust team in this channel or get any necessary support."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Create a permission group and project in the ",(0,i.jsx)(n.code,{children:"mongodb-education-ai"})," Braintrust organization for your team to use. In your team's project you can ",(0,i.jsx)(n.a,{href:"#run-evaluations",children:"run evaluations"}),"."]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add you as a viewer to the ",(0,i.jsx)(n.a,{href:"#responses-api-staging-tracing",children:"Responses API staging tracing"}),". This way you can see what is happening on the MongoDB responses API when you make requests to it."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"run-evaluations",children:"Run Evaluations"}),"\n",(0,i.jsxs)(n.p,{children:["Run evaluations for your application's use of the Responses API using the Braintrust SDK. For more information on using the SDK, refer to the SDK documentation, ",(0,i.jsx)(n.a,{href:"https://www.braintrust.dev/docs/start/eval-sdk",children:"https://www.braintrust.dev/docs/start/eval-sdk"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["To see some example evaluations, refer to the evaluation suite that the Responses API uses internally, ",(0,i.jsx)(n.a,{href:"https://github.com/mongodb/chatbot/blob/main/packages/chatbot-server-mongodb-public/src/conversations.eval.ts",children:(0,i.jsx)(n.code,{children:"conversations.eval.ts"})}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"responses-api-staging-tracing",children:"Responses API Staging Tracing"}),"\n",(0,i.jsx)(n.p,{children:"When evaluating your AI application that uses the MongoDB Responses API,\nit can be useful to see what's happening inside the Responses API."}),"\n",(0,i.jsxs)(n.p,{children:["All calls to the staging Responses API are traced by default. Tracing is only disabled if you set the body param ",(0,i.jsx)(n.code,{children:"store: true"}),". You should ",(0,i.jsx)(n.strong,{children:"never"})," set ",(0,i.jsx)(n.code,{children:"store: true"})," in your evaluations."]}),"\n",(0,i.jsxs)(n.p,{children:["To access the staging API traces, go to the ",(0,i.jsx)(n.a,{href:"https://www.braintrust.dev/app/mongodb-education-ai/p/chatbot-responses-staging/logs",children:"chatbot-responses-staging Logs in Braintrust"}),"."]})]})}function d(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>a});var i=t(7294);const o={},s=i.createContext(o);function a(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);