source:
  programmingLanguage: TypeScript
  description: |
    A code example for the MongoDB Node.js Driver.
target:
  programmingLanguage: TypeScript
  description: |
    A jest test suite that tests the provided source code. Make sure to
    import the necessary dependencies and declare any necessary types.

    The file MUST include:

    - a `describe()` block with a title that matches the
      provided source code's title.

    - assertions via the `expect()` function that test actual behavior and values
      against expected behavior and values.

    - comments with Bluehawk annotations such that the output of
      `bluehawk snip` is identical to the provided source code.

    <section>
    ## Bluehawk Snippets

    Bluehawk is a markup processor for extracting and manipulating
    arbitrary code. With Bluehawk, you can:

    - Extract code examples for use in documentation
    - Generate formatted code examples for use in documentation
    - Replace "finished" code with "todo" code for a branch in a tutorial repo

    To use Bluehawk, you add special comments, called tags, to your
    source code. Then, you run the Bluehawk CLI to generate code
    snippets based on those tags.

    ## Annotate Unit Tests

    The first step to use Bluehawk is to annotate your unit tests with
    [Bluehawk tags](/reference/tags). Tags are similar to HTML or XML; you
    put a `start` tag before the code you want to annotate, and an `end` tag
    after it. Bluehawk reads those start and end tags, and generates output
    files based on your annotations. You can use Bluehawk tags in any text file.

    The Bluehawk tool has language-specific "comment awareness" - as well as
    string literal awareness - that allows it to:

    - Avoid making snippet files with a closing block comment token at the front
    - Parse multi-line, commented out JSON "attribute lists" of tags so they
      don't create syntax errors in your code

    There is not currently a way to find out which languages Bluehawk supports
    from the CLI. However, you can see the [supported file extensions in
    the Bluehawk source](https://github.com/mongodb-university/Bluehawk/blob/8bb5766e5f30182ed3992eae8f36dba8a8db99ba/src/bluehawk/getBluehawk.ts#L52)
    to see if Bluehawk supports your preferred language.

    To request support for your language, [file an issue in the Bluehawk
    repository](https://github.com/mongodb-university/Bluehawk/issues), or
    make a PR to add support for your preferred language.

    ### Output File Names

    When you start a Bluehawk code block tag, you append a descriptive title,
    similar to:

    ```
    // :snippet-start: person-model
    ```

    When you generate Bluehawk output, the output file name concatenates:

    - The name of your unit test file
    - The word `snippet`
    - The descriptive name that you put in the `snippet-start` tag
    - The file type of your unit test file

    For this example, the code block is in a file called Models.swift, so
    the generated output file name would be: `Models.snippet.person-model.swift`.

    ### Example Unit Test Annotation

    #### Snippet start and end

    This is a complete code example in the
    [Models.swift](https://github.com/mongodb/docs-realm/blob/master/examples/ios/Examples/Models.swift)
    file in the Realm Docs iOS Unit Test suite.

    For this code snippet, we don't need to show the `import` statement in our final
    example, so we start the snippet after it. Then, after the code we want
    to show in our final example, we end the snippet.

    ```swift
    import RealmSwift

    // :snippet-start: person-model
    class Person: Object {
        // Required string property
        @Persisted var name: String = ""

        // Optional string property
        @Persisted var address: String?

        // Optional integral type property
        @Persisted var age: Int?
    }
    // :snippet-end:
    ```

    The output file becomes
    [Models.snippet.person-model.swift](https://github.com/mongodb/docs-realm/blob/master/source/examples/generated/code/start/Models.snippet.person-model.swift). After we use the Bluehawk CLI to extract
    this code example, the final code example looks like this:

    ```swift
    class Person: Object {
        // Required string property
        @Persisted var name: String = ""

        // Optional string property
        @Persisted var address: String?

        // Optional integral type property
        @Persisted var age: Int?
    }
    ```

    The output file includes only the lines of code between the `snippet-start`
    and the `snippet-end` tags.

    #### Remove code

    Bluehawk lets you to remove code that isn't relevant to your
    documentation viewers.

    This example is from the [ManageEmailPasswordUsers.swift](https://github.com/mongodb/docs-realm/blob/master/examples/ios/Examples/ManageEmailPasswordUsers.swift) file in the Realm Docs iOS Unit Test suite.

    This uses the snippet start and end tags, but it also uses `// :remove-start:`
    and `// :remove-end:` to remove elements of the code example. Here, we're
    removing a test assertion in the `catch` block that the documentation viewer
    doesn't need to see. You might also use it to remove test setup or teardown code
    that isn't relevant to your documentation viewers.

    ```swift
        func testPasswordResetFunc() async {
            // :snippet-start: password-reset-function
            let app = App(id: YOUR_REALM_APP_ID)
            let client = app.emailPasswordAuth

            let email = "forgot.my.password@example.com"
            let newPassword = "mynewpassword12345"
            // The password reset function takes any number of
            // arguments. You might ask the user to provide answers to
            // security questions, for example, to verify the user
            // should be able to complete the password reset.
            let args: [AnyBSON] = []

            // This SDK call maps to the custom password reset
            // function that you define in the backend
            do {
                try await client.callResetPasswordFunction(email: email, password: newPassword, args: args)
                print("Password reset successful!")
            } catch {
                print("Password reset failed: \(error.localizedDescription)")
                // :remove-start:
                XCTAssertEqual(error.localizedDescription, "user not found")
                // :remove-end:
            }
            // :snippet-end:
        }
    ```

    The final output code example at
    [ManageEmailPasswordUsers.snippet.password-reset-function.swift](https://github.com/mongodb/docs-realm/blob/master/source/examples/generated/code/start/ManageEmailPasswordUsers.snippet.password-reset-function.swift)
    looks like:

    ```swift
    let app = App(id: YOUR_REALM_APP_ID)
    let client = app.emailPasswordAuth

    let email = "forgot.my.password@example.com"
    let newPassword = "mynewpassword12345"
    // The password reset function takes any number of
    // arguments. You might ask the user to provide answers to
    // security questions, for example, to verify the user
    // should be able to complete the password reset.
    let args: [AnyBSON] = []

    // This SDK call maps to the custom password reset
    // function that you define in the backend
    do {
        try await client.callResetPasswordFunction(email: email, password: newPassword, args: args)
        print("Password reset successful!")
    } catch {
        print("Password reset failed: \(error.localizedDescription)")
    }
    ```

    The `catch` block does not show the hidden assertion; it only shows the
    print line.

    #### Replace

    Bluehawk gives you the ability to replace terms with different terms, or even
    nothing at all. In the Realm Docs iOS Unit Test suite, we use the `replace` tag
    to remove awkward names we have to use to avoid namespace collisions. For
    example, here are the opening lines of the
    [ReadWriteData.swift](https://github.com/mongodb/docs-realm/blob/master/examples/ios/Examples/ReadWriteData.swift)
    file:

    ```swift
    // :replace-start: {
    //   "terms": {
    //     "ReadWriteDataExamples_": ""
    //   }
    // }
    import XCTest
    import RealmSwift

    // :snippet-start: models
    class ReadWriteDataExamples_DogToy: Object {
        @Persisted var name = ""
    }

    class ReadWriteDataExamples_Dog: Object {
        @Persisted var name = ""
        @Persisted var age = 0
        @Persisted var color = ""
        @Persisted var currentCity = ""

        // To-one relationship
        @Persisted var favoriteToy: ReadWriteDataExamples_DogToy?
    }

    class ReadWriteDataExamples_Person: Object {
        @Persisted(primaryKey: true) var id = 0
        @Persisted var name = ""

        // To-many relationship - a person can have many dogs
        @Persisted var dogs: List<ReadWriteDataExamples_Dog>

        // Inverse relationship - a person can be a member of many clubs
        @Persisted(originProperty: "members") var clubs: LinkingObjects<ReadWriteDataExamples_DogClub>
    }

    class ReadWriteDataExamples_DogClub: Object {
        @Persisted var name = ""
        @Persisted var members: List<ReadWriteDataExamples_Person>
    }
    // :snippet-end:
    // Many more lines of code examples, until eventually, we end the replace
    // :replace-end:
    ```

    As you can see, the model names such as `ReadWriteDataExamples_DogToy` are
    very awkward. The `ReadWriteDataExamples` is present to avoid namespace
    collisions with `Dog` or `Person` models in other test files. But this
    awkward name isn't something we want to show documentation viewers.

    Fortunately, replace lets us swap any instance of the term we specify with
    some alternative. In this example, we replace `ReadWriteDataExamples`
    with an empty string.

    ```swift
    // :replace-start: {
    //   "terms": {
    //     "ReadWriteDataExamples_": ""
    //   }
    // }
    ```

    The [output file for the code block above](https://github.com/mongodb/docs-realm/blob/master/source/examples/generated/code/start/ReadWriteData.snippet.models.swift)
    looks like:

    ```swift
    class DogToy: Object {
        @Persisted var name = ""
    }

    class Dog: Object {
        @Persisted var name = ""
        @Persisted var age = 0
        @Persisted var color = ""
        @Persisted var currentCity = ""

        // To-one relationship
        @Persisted var favoriteToy: DogToy?
    }

    class Person: Object {
        @Persisted(primaryKey: true) var id = 0
        @Persisted var name = ""

        // To-many relationship - a person can have many dogs
        @Persisted var dogs: List<Dog>

        // Inverse relationship - a person can be a member of many clubs
        @Persisted(originProperty: "members") var clubs: LinkingObjects<DogClub>
    }

    class DogClub: Object {
        @Persisted var name = ""
        @Persisted var members: List<Person>
    }
    ```

    The long, awkward name has been replaced with nothing.

    :::tip
    Be careful with `replace`. Use VerySpecificNamesAndCharacters\_ here so
    you can be sure you don't unintentionally delete something common.
    :::
    </section>
