# Quick note about toolCallArgs.pageUrl - if the user provides a URL, then we should expect 
# the exact (un-normalized) URL to be used as pageUrl.
# HOWEVER, for "implied" on-page uses, the URL is taken from the front matter, 
# which is already normalized.
# (This is not ideal for writing eval cases, consider fixes in future)
- name: fetch_page_given_URL
  expectation: should call fetch_page tool for a user-provided URL
  messages:
    - role: user
      content: Summarize this page https://www.mongodb.com/docs/atlas/data-federation/overview/
  customData:
    origin: https://www.mongodb.com/docs/atlas/data-federation/overview/
  expectedLinks:
    - https://www.mongodb.com/docs/atlas/data-federation/overview/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: https://www.mongodb.com/docs/atlas/data-federation/overview/
    - role: tool
    - role: assistant
  tags:
    - fetch_page

- name: fetch_page_given_URL_with_conflicting_origin
  expectation: should call fetch_page tool for a user-provided URL when origin is different
  messages:
    - role: user
      content: I'm following this tutorial https://www.mongodb.com/docs/drivers/java/sync/current/get-started/ but I got a SSL error how to fix it?
  customData:
    origin: https://www.mongodb.com/docs/drivers/java/sync/current/connection/
  expectedLinks:
    - https://www.mongodb.com/docs/drivers/java/sync/current/get-started/
  expectedMessageDetail: 
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: https://www.mongodb.com/docs/drivers/java/sync/current/get-started/
    - role: tool
    - role: assistant
  tags:
    - fetch_page

- name: fetch_page_given_URL_with_conflicting_origin_not_URL
  expectation: should call fetch_page tool for a user-provided URL when origin is different 2
  messages:
    - role: user
      content: I'm following this tutorial https://www.mongodb.com/docs/drivers/java/sync/current/get-started/ but I got a SSL error how to fix it?
  customData:
    origin: google-gemini-code-assist
  expectedLinks:
    - https://www.mongodb.com/docs/drivers/java/sync/current/get-started/
  expectedMessageDetail: 
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: https://www.mongodb.com/docs/drivers/java/sync/current/get-started/
    - role: tool
    - role: assistant
  tags:
    - fetch_page

- name: fetch_page_given_URL_with_conflicting_origin_not_URL_2
  expectation: should call fetch_page tool for a user-provided URL when origin is different
  messages:
    - role: user
      content: Summarize this page https://www.mongodb.com/docs/atlas/atlas-vector-search/vector-search-type/
  customData:
    origin: https://www.mongodb.com/docs/atlas/getting-started/
  expectedLinks:
    - https://www.mongodb.com/docs/atlas/atlas-vector-search/vector-search-type/
  expectedMessageDetail: 
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: https://www.mongodb.com/docs/atlas/atlas-vector-search/vector-search-type/
    - role: tool
    - role: assistant
  tags:
    - fetch_page

- name: fetch_page_given_multiple_URLs_multiple_toolcalls
  expectation: Calls fetch_page in parallel for each provided URL (x3)
  messages: 
    - role: user
      content: Summarize across these URLs about preventing slow searches https://www.mongodb.com/docs/atlas/atlas-vector-search/improve-accuracy/, https://www.mongodb.com/docs/atlas/atlas-vector-search/benchmark/, https://www.mongodb.com/docs/atlas/atlas-vector-search/troubleshooting/
  customData:
    origin: https://www.mongodb.com/docs/atlas/atlas-vector-search/troubleshooting/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
    - role: assistant-tool
      toolCallName: fetch_page
    - role: assistant-tool
      toolCallName: fetch_page
    - role: tool
    - role: tool
    - role: tool
    - role: assistant
  tags:
    - fetch_page

- name: fetch_page_given_multiple_URLs_multiple_toolcalls_includes_external
  expectation: Calls fetch_page in parallel for each provided URL (x2), w/ search fallback for for external URL
  messages:
    - role: user
      content: Use these as documentation https://www.mongodb.com/docs/manual/core/schema-validation/ https://www.datacamp.com/tutorial/mongodb-schema-validation How do I validate there are no extra fields that I haven't defined
  customData:
    origin: https://www.mongodb.com/docs/manual/core/schema-validation/
  expectedMessageDetail: 
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
    - role: assistant-tool
      toolCallName: fetch_page
    - role: tool
    - role: tool
    - role: assistant-tool
      toolCallName: search_content
    - role: tool
    - role: assistant
  tags:
    - fetch_page

- name: fetch_page_implied_URL_summary
  expectation: should call fetch_page tool for implied on-page use (summarize)
  messages:
    - role: user
      content: Summarize the page I am on
  customData: 
    origin: https://www.mongodb.com/docs/atlas/data-federation/overview/
  expectedLinks:
    - https://www.mongodb.com/docs/atlas/data-federation/overview/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: mongodb.com/docs/atlas/data-federation/overview
    - role: tool
    - role: assistant
  tags:
    - fetch_page
    - implied_url

- name: fetch_page_implied_URL_question
  expectation: should call fetch_page tool for implied on-page use (question)
  messages:
    - role: user
      content: On this page, what does federation mean?
  customData: 
    origin: https://www.mongodb.com/docs/atlas/data-federation/overview/
  expectedLinks:
    - https://www.mongodb.com/docs/atlas/data-federation/overview/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: mongodb.com/docs/atlas/data-federation/overview
    - role: tool
    - role: assistant
  tags:
    - fetch_page
    - implied_url

- name: fetch_page_implied_URL_summary_2
  expectation: should call fetch_page tool for implied on-page use (summarize)
  messages:
    - role: user
      content : Use the page I am on. Please summarize with a focus on how to use it 
  customData: 
    origin: https://www.mongodb.com/docs/atlas/data-federation/overview/
  expectedLinks:
    - https://www.mongodb.com/docs/atlas/data-federation/overview/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: mongodb.com/docs/atlas/data-federation/overview
    - role: tool
    - role: assistant
  tags:
    - fetch_page
    - implied_url

- name: fetch_page_given_external_URL_fallback_to_search_1
  expectation: falls back to search tool if there's no content for the URL 
  messages:
    - role: user
      content: using this page https://en.wikipedia.org/wiki/MongoDB what are the benefits of mongodb
  customData: 
    origin: https://www.mongodb.com/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: https://en.wikipedia.org/wiki/MongoDB
    - role: tool
    - role: assistant-tool
      toolCallName: search_content 
    - role: tool
    - role: assistant
  tags:
    - fetch_page
    - fallback_to_search

- name: fetch_page_given_external_URL_fallback_to_search_2
  expectation: falls back to search tool if there's no content for the URL 2 
  messages:
    - role: user
      content: How do I turn off the query profiler? Reference this page https://studio3t.com/knowledge-base/articles/mongodb-query-performance/
  customData:
    origin: https://www.mongodb.com/docs/atlas/tutorial/query-profiler/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: https://studio3t.com/knowledge-base/articles/mongodb-query-performance/
    - role: tool
    - role: assistant-tool
      toolCallName: search_content 
    - role: tool
    - role: assistant
  tags:
    - fetch_page
    - fallback_to_search

- name: fetch_page_given_URL_answer_not_on_page_search_fallback
  expectation: fall back to search tool if answer is not on the page (stretch goal)
  messages:
    - role: user
      content: I'm following this tutorial https://www.mongodb.com/docs/drivers/java/sync/current/get-started/ How do I insert a document instead of searching
  customData:
    origin: https://www.mongodb.com/docs/drivers/java/sync/current/get-started/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: https://www.mongodb.com/docs/drivers/java/sync/current/get-started/
    - role: tool
    - role: assistant-tool
      toolCallName: search_content 
    - role: tool
    - role: assistant
  tags:
    - fetch_page
    - fallback_to_search

- name: fetch_page_implied_URL_answer_not_on_page_search_fallback
  expectation: fall back to search tool if answer is not on the page 2 (stretch goal)
  messages:
    - role: user
      content: I'm using the tutorial on this page. How do I insert a document instead of searching
  customData:
    origin: https://www.mongodb.com/docs/drivers/java/sync/current/get-started/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: mongodb.com/docs/drivers/java/sync/current/get-started
    - role: tool
    - role: assistant-tool
      toolCallName: search_content 
    - role: tool
    - role: assistant
  tags:
    - fetch_page
    - implied_url
    - fallback_to_search
  
- name: fetch_page_given_URL_needs_more_info_search_fallback
  expectation: should fall back to search tool if more information is needed to answer all parts of user query (stretch goal)
  messages:
    - role: user
      content: how do i implement hybrid search in python https://www.mongodb.com/docs/atlas/atlas-search/accuracy/
  customData:
    origin: https://www.mongodb.com/docs/atlas/atlas-search/accuracy/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: https://www.mongodb.com/docs/atlas/atlas-search/accuracy/
    - role: tool
    - role: assistant-tool
      toolCallName: search_content 
    - role: tool
    - role: assistant
  tags:
    - fetch_page
    - fallback_to_search

- name: search_tool_for_no_URL
  messages:
    - role: user
      content: How do I create a new index using Typescript
  customData: 
    origin: https://www.mongodb.com/docs/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: search_content 
    - role: tool
    - role: assistant
  tags:
    - search_content
- name: search_tool_ignores_related_url_when_no_instruction
  expectation: The search tool should be used when no user instruction is given otherwise.
  messages:
    - role: user
      content: How do I set up billing alerts for Atlas
  customData: 
    origin: https://www.mongodb.com/docs/atlas/billing/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: search_content 
    - role: tool
    - role: assistant
  tags:
    - search_content
- name: search_tool_ignores_related_url_when_no_instruction_2
  expectation: The search tool should be used when no user instruction is given otherwise.
  messages: 
    - role: user
      content: how to backup Atlas cluster when using GCP
  customData: 
    origin: https://www.mongodb.com/docs/atlas/backup-restore-cluster/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: search_content 
    - role: tool
    - role: assistant
  tags:
    - search_content
- name: search_tool_ignores_related_url_when_no_instruction_3
  expectation: The search tool should be used when no user instruction is given otherwise.
  messages: 
    - role: user
      content: count documents with a condition
  customData: 
    origin: https://www.mongodb.com/docs/php-library/current/crud/query/count/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: search_content 
    - role: tool
    - role: assistant
  tags:
    - search_content
- name: fetch_page_answer_not_on_long_page_search_fallback
  expectation: should fall back to search if required information is not on a long (>150000 character) page
  messages:
    - role: user
      content: Please reference https://www.mongodb.com/docs/atlas/reference/api-resources-spec/v2/ I am using the Atlas API to create x509 certificates for my database but I am running into an issue connecting to the cluster with the certificate. This is the error "SSL peer certificate revocation status checking failed"
  customData: 
    origin: https://www.mongodb.com/docs/atlas/reference/api-resources-spec/v2/
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: fetch_page
      toolCallArgs:
        pageUrl: https://www.mongodb.com/docs/atlas/reference/api-resources-spec/v2/
    - role: tool
    - role: assistant-tool
      toolCallName: search_content 
    - role: tool
    - role: assistant
  tags:
    - fetch_page
    - fallback_to_search
- name: use_internal_and_custom_tools
  expectation: should use internal tool 'search_content' then follow up with the custom tool
  messages:
    - role: user
      content: How do I insert a document into a MongoDB collection using Typescript?
  expectedMessageDetail:
    - role: user
    - role: assistant-tool
      toolCallName: search_content
    - role: tool
    - role: assistant-tool
      toolCallName: run_sandbox_code 
  customTools:
    - name: run_sandbox_code
      description: Runs code in a sandbox environment so we can demonstrate to the user what it does. This tool should ALWAYS be used after code is generated.
      parameters:
        code:
          type: string
          description: The code snippet to execute.
        language:
          type: string
          description: The programming language of the code snippet.
      strict: true
  tags:
    - search_content
    - customTools
