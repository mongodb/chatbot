{"nlQuery":"List the top 15 neighborhoods with the most Chinese restaurants","dbQuery":"db.temp_neighborhood_counts.find(\n  { chineseCount: { $gt: 0 } },\n  { name: 1, chineseCount: 1, _id: 0 }\n)\n.sort({ chineseCount: -1 })\n.limit(15)","language":"mongosh","result":[{"name":"Sunset Park East","chineseCount":26},{"name":"Bensonhurst West","chineseCount":13},{"name":"East New York","chineseCount":10},{"name":"Stuyvesant Heights","chineseCount":10},{"name":"Madison","chineseCount":6},{"name":"Prospect Lefferts Gardens-Wingate","chineseCount":6},{"name":"Flatlands","chineseCount":6},{"name":"Crown Heights North","chineseCount":6},{"name":"Dyker Heights","chineseCount":5},{"name":"Rugby-Remsen Village","chineseCount":5},{"name":"Bay Ridge","chineseCount":5},{"name":"Sunset Park West","chineseCount":5},{"name":"Park Slope-Gowanus","chineseCount":5},{"name":"Flatbush","chineseCount":5},{"name":"DUMBO-Vinegar Hill-Downtown Brooklyn-Boerum Hill","chineseCount":4}],"executionTimeMs":2737,"queryOperators":["$gt"],"methods":["find","sort","limit"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"How many Chinese restaurants are there in Manhattan versus Queens?","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      cuisine: \"Chinese\",\n      borough: { $in: [\"Manhattan\", \"Queens\"] }\n    }\n  },\n  {\n    $group: {\n      _id: \"$borough\",\n      chineseRestaurantCount: { $sum: 1 }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      borough: \"$_id\",\n      chineseRestaurantCount: 1\n    }\n  },\n  {\n    $sort: { borough: 1 }\n  }\n])","language":"mongosh","result":[{"chineseRestaurantCount":510,"borough":"Manhattan"},{"chineseRestaurantCount":728,"borough":"Queens"}],"executionTimeMs":2441,"queryOperators":["$match","$in","$group","$sum","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the count of Chinese restaurants in each borough of NYC, sorted by the highest number first","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      cuisine: \"Chinese\"\n    }\n  },\n  {\n    $group: {\n      _id: \"$borough\",\n      chineseRestaurantCount: { $sum: 1 }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      borough: \"$_id\",\n      chineseRestaurantCount: 1\n    }\n  },\n  {\n    $sort: {\n      chineseRestaurantCount: -1\n    }\n  }\n])","language":"mongosh","result":[{"chineseRestaurantCount":763,"borough":"Brooklyn"},{"chineseRestaurantCount":728,"borough":"Queens"},{"chineseRestaurantCount":510,"borough":"Manhattan"},{"chineseRestaurantCount":323,"borough":"Bronx"},{"chineseRestaurantCount":88,"borough":"Staten Island"},{"chineseRestaurantCount":6,"borough":"Missing"}],"executionTimeMs":2904,"queryOperators":["$match","$group","$sum","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find neighborhoods that have at least 5 Chinese restaurants and where Chinese restaurants make up more than 20% of all restaurants","dbQuery":"db.temp_neighborhood_counts.aggregate([\n  {\n    $match: {\n      chineseCount: { $gte: 5 }\n    }\n  },\n  {\n    $addFields: {\n      chinesePercentage: {\n        $multiply: [\n          { $divide: [\"$chineseCount\", \"$count\"] },\n          100\n        ]\n      }\n    }\n  },\n  {\n    $match: {\n      chinesePercentage: { $gt: 20 }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      chineseCount: 1,\n      totalCount: \"$count\",\n      chinesePercentage: 1\n    }\n  },\n  {\n    $sort: { chinesePercentage: -1 }\n  }\n])","language":"mongosh","result":[{"name":"East New York","chineseCount":10,"chinesePercentage":100,"totalCount":10},{"name":"Rugby-Remsen Village","chineseCount":5,"chinesePercentage":100,"totalCount":5},{"name":"Bensonhurst West","chineseCount":13,"chinesePercentage":100,"totalCount":13},{"name":"Dyker Heights","chineseCount":5,"chinesePercentage":100,"totalCount":5},{"name":"Stuyvesant Heights","chineseCount":10,"chinesePercentage":100,"totalCount":10},{"name":"Flatlands","chineseCount":6,"chinesePercentage":100,"totalCount":6},{"name":"Crown Heights North","chineseCount":6,"chinesePercentage":100,"totalCount":6},{"name":"Madison","chineseCount":6,"chinesePercentage":100,"totalCount":6},{"name":"Prospect Lefferts Gardens-Wingate","chineseCount":6,"chinesePercentage":85.71428571428571,"totalCount":7},{"name":"Sunset Park East","chineseCount":26,"chinesePercentage":78.78787878787878,"totalCount":33},{"name":"Bay Ridge","chineseCount":5,"chinesePercentage":50,"totalCount":10},{"name":"Flatbush","chineseCount":5,"chinesePercentage":50,"totalCount":10},{"name":"Park Slope-Gowanus","chineseCount":5,"chinesePercentage":35.714285714285715,"totalCount":14},{"name":"Sunset Park West","chineseCount":5,"chinesePercentage":35.714285714285715,"totalCount":14}],"executionTimeMs":1741,"queryOperators":["$match","$gte","$addFields","$multiply","$divide","$gt","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"For each borough, calculate what percentage of all restaurants are Chinese cuisine, including the total restaurant count and Chinese restaurant count","dbQuery":"db.restaurants.aggregate([\n  {\n    $group: {\n      _id: \"$borough\",\n      totalRestaurants: { $sum: 1 },\n      chineseRestaurants: {\n        $sum: {\n          $cond: [\n            { $eq: [\"$cuisine\", \"Chinese\"] },\n            1,\n            0\n          ]\n        }\n      }\n    }\n  },\n  {\n    $project: {\n      borough: \"$_id\",\n      totalRestaurants: 1,\n      chineseRestaurants: 1,\n      chinesePercentage: {\n        $multiply: [\n          { $divide: [\"$chineseRestaurants\", \"$totalRestaurants\"] },\n          100\n        ]\n      },\n      _id: 0\n    }\n  },\n  {\n    $sort: { borough: 1 }\n  }\n])","language":"mongosh","result":[{"totalRestaurants":2338,"chineseRestaurants":323,"borough":"Bronx","chinesePercentage":13.815226689478186},{"totalRestaurants":6086,"chineseRestaurants":763,"borough":"Brooklyn","chinesePercentage":12.53697009530069},{"totalRestaurants":10259,"chineseRestaurants":510,"borough":"Manhattan","chinesePercentage":4.971244760697924},{"totalRestaurants":51,"chineseRestaurants":6,"borough":"Missing","chinesePercentage":11.76470588235294},{"totalRestaurants":5656,"chineseRestaurants":728,"borough":"Queens","chinesePercentage":12.871287128712872},{"totalRestaurants":969,"chineseRestaurants":88,"borough":"Staten Island","chinesePercentage":9.081527347781218}],"executionTimeMs":3107,"queryOperators":["$group","$sum","$cond","$eq","$project","$multiply","$divide","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Find neighborhoods in Queens that either contain 'China' in their name or have more than 10 Chinese restaurants, along with their restaurant counts","dbQuery":"db.temp_neighborhood_counts.aggregate([\n  {\n    $lookup: {\n      from: \"restaurants\",\n      let: { neighborhoodName: \"$name\" },\n      pipeline: [\n        {\n          $match: {\n            $expr: { $eq: [\"$borough\", \"Queens\"] }\n          }\n        },\n        {\n          $limit: 1\n        }\n      ],\n      as: \"queensRestaurants\"\n    }\n  },\n  {\n    $match: {\n      queensRestaurants: { $ne: [] },\n      $or: [\n        { name: { $regex: \"China\", $options: \"i\" } },\n        { chineseCount: { $gt: 10 } }\n      ]\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      neighborhoodName: \"$name\",\n      chineseRestaurantCount: \"$chineseCount\",\n      totalRestaurantCount: \"$count\"\n    }\n  },\n  {\n    $sort: { chineseRestaurantCount: -1 }\n  }\n])","language":"mongosh","result":[{"neighborhoodName":"Sunset Park East","chineseRestaurantCount":26,"totalRestaurantCount":33},{"neighborhoodName":"Bensonhurst West","chineseRestaurantCount":13,"totalRestaurantCount":13}],"executionTimeMs":2527,"queryOperators":["$lookup","$match","$expr","$eq","$limit","$ne","$or","$regex","$options","$gt","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"For each borough, calculate the percentage of Chinese restaurants that improved from B or C grades to A grades between 2018 and 2024","dbQuery":"db.restaurants.aggregate([\n  // Stage 1: Filter for Chinese restaurants only\n  {\n    $match: {\n      cuisine: \"Chinese\"\n    }\n  },\n  // Stage 2: Add fields to check for improvement\n  {\n    $addFields: {\n      // Filter grades to only include those between 2018 and 2024\n      relevantGrades: {\n        $filter: {\n          input: \"$grades\",\n          cond: {\n            $and: [\n              { $gte: [\"$$this.date\", new Date(\"2018-01-01\")] },\n              { $lte: [\"$$this.date\", new Date(\"2024-12-31\")] }\n            ]\n          }\n        }\n      }\n    }\n  },\n  // Stage 3: Determine if restaurant improved\n  {\n    $addFields: {\n      improved: {\n        $let: {\n          vars: {\n            // Find the latest B or C grade\n            lastBorC: {\n              $arrayElemAt: [\n                {\n                  $filter: {\n                    input: \"$relevantGrades\",\n                    cond: { $in: [\"$$this.grade\", [\"B\", \"C\"]] }\n                  }\n                },\n                0\n              ]\n            }\n          },\n          in: {\n            $and: [\n              // Must have at least one B or C grade\n              { $ne: [\"$$lastBorC\", null] },\n              // Must have an A grade after the B or C grade\n              {\n                $gt: [\n                  {\n                    $size: {\n                      $filter: {\n                        input: \"$relevantGrades\",\n                        cond: {\n                          $and: [\n                            { $eq: [\"$$this.grade\", \"A\"] },\n                            { $lt: [\"$$lastBorC.date\", \"$$this.date\"] }\n                          ]\n                        }\n                      }\n                    }\n                  },\n                  0\n                ]\n              }\n            ]\n          }\n        }\n      }\n    }\n  },\n  // Stage 4: Group by borough and calculate statistics\n  {\n    $group: {\n      _id: \"$borough\",\n      totalChineseRestaurants: { $sum: 1 },\n      improvedRestaurants: {\n        $sum: {\n          $cond: [{ $eq: [\"$improved\", true] }, 1, 0]\n        }\n      }\n    }\n  },\n  // Stage 5: Calculate improvement percentage\n  {\n    $project: {\n      borough: \"$_id\",\n      totalChineseRestaurants: 1,\n      improvedRestaurants: 1,\n      improvementPercentage: {\n        $round: [\n          {\n            $multiply: [\n              {\n                $divide: [\"$improvedRestaurants\", \"$totalChineseRestaurants\"]\n              },\n              100\n            ]\n          },\n          2\n        ]\n      }\n    }\n  },\n  // Stage 6: Sort by borough name\n  {\n    $sort: { borough: 1 }\n  }\n])","language":"mongosh","result":[{"_id":"Bronx","totalChineseRestaurants":323,"improvedRestaurants":0,"borough":"Bronx","improvementPercentage":0},{"_id":"Brooklyn","totalChineseRestaurants":763,"improvedRestaurants":0,"borough":"Brooklyn","improvementPercentage":0},{"_id":"Manhattan","totalChineseRestaurants":510,"improvedRestaurants":0,"borough":"Manhattan","improvementPercentage":0},{"_id":"Missing","totalChineseRestaurants":6,"improvedRestaurants":0,"borough":"Missing","improvementPercentage":0},{"_id":"Queens","totalChineseRestaurants":728,"improvedRestaurants":0,"borough":"Queens","improvementPercentage":0},{"_id":"Staten Island","totalChineseRestaurants":88,"improvedRestaurants":0,"borough":"Staten Island","improvementPercentage":0}],"executionTimeMs":2600,"queryOperators":["$match","$addFields","$filter","$and","$gte","$lte","$let","$arrayElemAt","$in","$ne","$gt","$size","$eq","$lt","$group","$sum","$cond","$project","$round","$multiply","$divide","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Find all streets in Brooklyn where there are at least 3 Pizza restaurants and 2 Latin restaurants within the same zipcode, showing the street names and total restaurant count","dbQuery":"db.restaurants.aggregate([\n  // Stage 1: Filter for Brooklyn restaurants only\n  {\n    $match: {\n      borough: \"Brooklyn\"\n    }\n  },\n  // Stage 2: Group by street and zipcode, counting by cuisine type\n  {\n    $group: {\n      _id: {\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      pizzaCount: {\n        $sum: {\n          $cond: [\n            { $eq: [\"$cuisine\", \"Pizza\"] },\n            1,\n            0\n          ]\n        }\n      },\n      latinCount: {\n        $sum: {\n          $cond: [\n            { $eq: [\"$cuisine\", \"Latin (Cuban, Dominican, Puerto Rican, South & Central American)\"] },\n            1,\n            0\n          ]\n        }\n      },\n      totalCount: { $sum: 1 }\n    }\n  },\n  // Stage 3: Filter for streets meeting both criteria\n  {\n    $match: {\n      pizzaCount: { $gte: 3 },\n      latinCount: { $gte: 2 }\n    }\n  },\n  // Stage 4: Project to match the required output format\n  {\n    $project: {\n      _id: 0,\n      street: \"$_id.street\",\n      zipcode: \"$_id.zipcode\",\n      pizzaCount: 1,\n      latinCount: 1,\n      totalCount: 1\n    }\n  },\n  // Stage 5: Sort by total count descending for better readability\n  {\n    $sort: { totalCount: -1 }\n  }\n])","language":"mongosh","result":[{"pizzaCount":4,"latinCount":5,"totalCount":87,"street":"Grand Street","zipcode":"11211"},{"pizzaCount":6,"latinCount":4,"totalCount":53,"street":"5 Avenue","zipcode":"11220"},{"pizzaCount":3,"latinCount":5,"totalCount":36,"street":"Fulton Street","zipcode":"11208"},{"pizzaCount":4,"latinCount":6,"totalCount":35,"street":"4 Avenue","zipcode":"11232"},{"pizzaCount":4,"latinCount":3,"totalCount":33,"street":"Broadway","zipcode":"11221"},{"pizzaCount":3,"latinCount":2,"totalCount":26,"street":"Broadway","zipcode":"11206"},{"pizzaCount":4,"latinCount":3,"totalCount":23,"street":"Graham Avenue","zipcode":"11206"}],"executionTimeMs":2496,"queryOperators":["$match","$group","$sum","$cond","$eq","$gte","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Find the top 20 zipcodes in Manhattan and Brooklyn that have the highest concentration of Pizza, American, and Latin restaurants combined","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: { $in: [\"Manhattan\", \"Brooklyn\"] },\n      cuisine: { \n        $in: [\n          \"Pizza\", \n          \"American\", \n          \"Latin (Cuban, Dominican, Puerto Rican, South & Central American)\"\n        ] \n      }\n    }\n  },\n  {\n    $group: {\n      _id: {\n        zipcode: \"$address.zipcode\",\n        borough: \"$borough\"\n      },\n      lateNightRestaurantCount: { $sum: 1 }\n    }\n  },\n  {\n    $sort: { lateNightRestaurantCount: -1 }\n  },\n  {\n    $limit: 20\n  },\n  {\n    $project: {\n      _id: 0,\n      zipcode: \"$_id.zipcode\",\n      borough: \"$_id.borough\",\n      lateNightRestaurantCount: 1\n    }\n  }\n])","language":"mongosh","result":[{"lateNightRestaurantCount":300,"zipcode":"10019","borough":"Manhattan"},{"lateNightRestaurantCount":290,"zipcode":"10036","borough":"Manhattan"},{"lateNightRestaurantCount":221,"zipcode":"10003","borough":"Manhattan"},{"lateNightRestaurantCount":203,"zipcode":"10001","borough":"Manhattan"},{"lateNightRestaurantCount":197,"zipcode":"10022","borough":"Manhattan"},{"lateNightRestaurantCount":172,"zipcode":"10011","borough":"Manhattan"},{"lateNightRestaurantCount":159,"zipcode":"10014","borough":"Manhattan"},{"lateNightRestaurantCount":156,"zipcode":"11211","borough":"Brooklyn"},{"lateNightRestaurantCount":155,"zipcode":"10002","borough":"Manhattan"},{"lateNightRestaurantCount":147,"zipcode":"10012","borough":"Manhattan"},{"lateNightRestaurantCount":146,"zipcode":"10017","borough":"Manhattan"},{"lateNightRestaurantCount":143,"zipcode":"10018","borough":"Manhattan"},{"lateNightRestaurantCount":136,"zipcode":"10016","borough":"Manhattan"},{"lateNightRestaurantCount":127,"zipcode":"10009","borough":"Manhattan"},{"lateNightRestaurantCount":127,"zipcode":"10013","borough":"Manhattan"},{"lateNightRestaurantCount":126,"zipcode":"11215","borough":"Brooklyn"},{"lateNightRestaurantCount":122,"zipcode":"11201","borough":"Brooklyn"},{"lateNightRestaurantCount":97,"zipcode":"11238","borough":"Brooklyn"},{"lateNightRestaurantCount":94,"zipcode":"10010","borough":"Manhattan"},{"lateNightRestaurantCount":91,"zipcode":"11217","borough":"Brooklyn"}],"executionTimeMs":2420,"queryOperators":["$match","$in","$group","$sum","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Count how many Latin cuisine restaurants in the Bronx have received an 'A' grade in their last health inspection","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Bronx\",\n      cuisine: { $regex: \"Latin\", $options: \"i\" }\n    }\n  },\n  {\n    $match: {\n      \"grades.0.grade\": \"A\"\n    }\n  },\n  {\n    $count: \"count\"\n  }\n])","language":"mongosh","result":[{"count":144}],"executionTimeMs":2416,"queryOperators":["$match","$regex","$options","$count"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"List Chinese restaurants in Staten Island that have only A grades with inspection scores under 10 points","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Staten Island\",\n      cuisine: \"Chinese\"\n    }\n  },\n  {\n    $match: {\n      $and: [\n        {\n          grades: {\n            $not: {\n              $elemMatch: {\n                $or: [\n                  { grade: { $ne: \"A\" } },\n                  { score: { $gte: 10 } }\n                ]\n              }\n            }\n          }\n        },\n        {\n          grades: { $exists: true, $ne: [] }\n        }\n      ]\n    }\n  },\n  {\n    $addFields: {\n      averageScore: { $avg: \"$grades.score\" }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      restaurant_id: 1,\n      address: {\n        street: \"$address.street\",\n        building: \"$address.building\"\n      },\n      averageScore: 1,\n      grades: 1\n    }\n  },\n  {\n    $sort: { averageScore: 1 }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f480a6","address":{"street":"Forest Avenue","building":"1778"},"grades":[{"date":"2014-07-02T00:00:00.000Z","grade":"A","score":7}],"name":"Yum Yum Chinese Restaurant","restaurant_id":"50010027","averageScore":7},{"_id":"5eb3d669b31de5d588f48561","address":{"street":"Seguine Avenue","building":"27"},"grades":[{"date":"2014-10-30T00:00:00.000Z","grade":"A","score":8}],"name":"New Island","restaurant_id":"50014447","averageScore":8},{"_id":"5eb3d669b31de5d588f47726","address":{"street":"Amboy Road","building":"4373"},"grades":[{"date":"2014-10-20T00:00:00.000Z","grade":"A","score":8},{"date":"2013-11-04T00:00:00.000Z","grade":"A","score":9}],"name":"Empire Szechuan Village","restaurant_id":"50002395","averageScore":8.5},{"_id":"5eb3d669b31de5d588f486f0","address":{"street":"Lafayette Avenue","building":"143"},"grades":[{"date":"2014-10-28T00:00:00.000Z","grade":"A","score":9}],"name":"Lucky Garden","restaurant_id":"50015661","averageScore":9}],"executionTimeMs":2414,"queryOperators":["$match","$and","$not","$elemMatch","$or","$ne","$gte","$exists","$addFields","$avg","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Give me the top 10 Chinese restaurants in Queens, Brooklyn, Bronx, or Staten Island that have never received anything below an A grade","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      cuisine: \"Chinese\",\n      borough: { $in: [\"Queens\", \"Brooklyn\", \"Bronx\", \"Staten Island\"] },\n      grades: { $exists: true, $ne: [] },\n      grades: { $not: { $elemMatch: { grade: { $ne: \"A\" } } } }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      restaurant_id: 1,\n      borough: 1,\n      address: {\n        street: \"$address.street\",\n        building: \"$address.building\"\n      },\n      totalInspections: { $size: \"$grades\" }\n    }\n  },\n  {\n    $limit: 10\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f4295c","address":{"street":"East Kingsbridge Road","building":"277"},"borough":"Bronx","name":"Happy Garden","restaurant_id":"40364296","totalInspections":5},{"_id":"5eb3d668b31de5d588f42ed7","address":{"street":"Webster Avenue","building":"2459"},"borough":"Bronx","name":"China Wok Ii","restaurant_id":"40510328","totalInspections":4},{"_id":"5eb3d668b31de5d588f430a2","address":{"street":"East  167 Street","building":"202"},"borough":"Bronx","name":"Lucky House Restaurant","restaurant_id":"40571587","totalInspections":5},{"_id":"5eb3d668b31de5d588f430b0","address":{"street":"Westchester Avenue","building":"1474"},"borough":"Bronx","name":"New Wah Kitchen","restaurant_id":"40573101","totalInspections":3},{"_id":"5eb3d668b31de5d588f436c5","address":{"street":"East 170 Street","building":"317"},"borough":"Bronx","name":"Lin'S Garden","restaurant_id":"40857406","totalInspections":6},{"_id":"5eb3d668b31de5d588f4355b","address":{"street":"Williamsbridge Road","building":"1811"},"borough":"Bronx","name":"Hong Kong Restaurant","restaurant_id":"40765358","totalInspections":5},{"_id":"5eb3d668b31de5d588f43631","address":{"street":"Crosby Avenue","building":"1634"},"borough":"Bronx","name":"East Dynasty","restaurant_id":"40827529","totalInspections":5},{"_id":"5eb3d668b31de5d588f437dd","address":{"street":"White Plains Road","building":"3906"},"borough":"Bronx","name":"New Rainbow Restaurant","restaurant_id":"40899178","totalInspections":5},{"_id":"5eb3d668b31de5d588f43909","address":{"street":"Jerome Avenue","building":"1171"},"borough":"Bronx","name":"Xin Hing Restaurant","restaurant_id":"40941277","totalInspections":4},{"_id":"5eb3d668b31de5d588f43952","address":{"street":"Westchester Avenue","building":"2211"},"borough":"Bronx","name":"China One","restaurant_id":"40948231","totalInspections":3}],"executionTimeMs":2461,"queryOperators":["$match","$in","$exists","$ne","$not","$elemMatch","$project","$size","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Count how many Thai restaurants are currently operating in each borough","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      cuisine: \"Thai\"\n    }\n  },\n  {\n    $group: {\n      _id: \"$borough\",\n      thaiRestaurantCount: { $sum: 1 }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      borough: \"$_id\",\n      thaiRestaurantCount: 1\n    }\n  },\n  {\n    $sort: {\n      borough: 1\n    }\n  }\n])","language":"mongosh","result":[{"thaiRestaurantCount":2,"borough":"Bronx"},{"thaiRestaurantCount":66,"borough":"Brooklyn"},{"thaiRestaurantCount":154,"borough":"Manhattan"},{"thaiRestaurantCount":62,"borough":"Queens"},{"thaiRestaurantCount":1,"borough":"Staten Island"}],"executionTimeMs":2535,"queryOperators":["$match","$group","$sum","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Show me all Chinese restaurants in zip code 10034 with their most recent health grade","dbQuery":"db.restaurants.find(\n  {\n    cuisine: \"Chinese\",\n    \"address.zipcode\": \"10034\"\n  },\n  {\n    name: 1,\n    \"address.building\": 1,\n    \"address.street\": 1,\n    \"address.zipcode\": 1,\n    latestGrade: {\n      grade: { $arrayElemAt: [\"$grades.grade\", 0] },\n      date: { $arrayElemAt: [\"$grades.date\", 0] }\n    },\n    _id: 0\n  }\n)","language":"mongosh","result":[{"address":{"building":"3864","street":"10 Avenue","zipcode":"10034"},"name":"Ten-Tan Chinese Restaurant","latestGrade":{"grade":"A","date":"2014-07-10T00:00:00.000Z"}},{"address":{"building":"586","street":"West 207 Street","zipcode":"10034"},"name":"Amy'S Restaurant","latestGrade":{"grade":"A","date":"2015-01-05T00:00:00.000Z"}},{"address":{"building":"4840","street":"Broadway","zipcode":"10034"},"name":"Lotus Lucky Express","latestGrade":{"grade":"A","date":"2014-10-15T00:00:00.000Z"}},{"address":{"building":"666","street":"West 204 Street","zipcode":"10034"},"name":"Hang Lee Restaurant","latestGrade":{"grade":"A","date":"2014-11-20T00:00:00.000Z"}},{"address":{"building":"4926","street":"Broadway","zipcode":"10034"},"name":"''U'' Like Chinese Restaurant","latestGrade":{"grade":"A","date":"2014-07-16T00:00:00.000Z"}},{"address":{"building":"563A","street":"W 207Th St","zipcode":"10034"},"name":"Zhang Qun Empire Inc","latestGrade":{"grade":"A","date":"2014-04-29T00:00:00.000Z"}},{"address":{"building":"4926","street":"Broadway","zipcode":"10034"},"name":"U Like Chinese Take Out","latestGrade":{"grade":"Not Yet Graded","date":"2015-01-20T00:00:00.000Z"}}],"executionTimeMs":1982,"queryOperators":["$arrayElemAt"],"methods":["find"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"List the top 10 Chinese restaurants in zip code 11355 that currently have an 'A' grade, sorted by their most recent inspection score from lowest to highest","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      \"address.zipcode\": \"11355\",\n      \"cuisine\": \"Chinese\"\n    }\n  },\n  {\n    $addFields: {\n      mostRecentGrade: { $arrayElemAt: [\"$grades\", 0] }\n    }\n  },\n  {\n    $match: {\n      \"mostRecentGrade.grade\": \"A\"\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      currentGrade: \"$mostRecentGrade.grade\",\n      latestScore: \"$mostRecentGrade.score\",\n      inspectionDate: \"$mostRecentGrade.date\"\n    }\n  },\n  {\n    $sort: { latestScore: 1 }\n  },\n  {\n    $limit: 10\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f4849f","address":{"building":"41-28","street":"Main Street","zipcode":"11355"},"name":"Expressway Bubble Tea & Snacks","currentGrade":"A","latestScore":2,"inspectionDate":"2014-10-07T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f46f97","address":{"building":"4224","street":"College Point Boulevard","zipcode":"11355"},"name":"Xingyun","currentGrade":"A","latestScore":3,"inspectionDate":"2014-06-12T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f4877f","address":{"building":"43-18","street":"Main Street","zipcode":"11355"},"name":"Lao Ma Ma La Tang","currentGrade":"A","latestScore":4,"inspectionDate":"2014-12-09T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f472c8","address":{"building":"136-17","street":"41 Avenue","zipcode":"11355"},"name":"Lcle Bar","currentGrade":"A","latestScore":4,"inspectionDate":"2014-08-13T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f4523d","address":{"building":"5914","street":"Main Street","zipcode":"11355"},"name":"Main St Imperial Taiwanese Gourmet","currentGrade":"A","latestScore":5,"inspectionDate":"2014-10-23T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f47b05","address":{"building":"60-06","street":"Kissena Boulevard","zipcode":"11355"},"name":"New Woks Kitchen","currentGrade":"A","latestScore":5,"inspectionDate":"2014-09-15T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f44c04","address":{"building":"43-18","street":"Main Street","zipcode":"11355"},"name":"Spicy Restaurant","currentGrade":"A","latestScore":5,"inspectionDate":"2014-09-23T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f466f2","address":{"building":"4128","street":"Main St","zipcode":"11355"},"name":"New Ruyi Noodle","currentGrade":"A","latestScore":7,"inspectionDate":"2014-07-02T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f475b4","address":{"building":"46-26","street":"Kissena Boulevard","zipcode":"11355"},"name":"Yj Chinese Cuisine","currentGrade":"A","latestScore":7,"inspectionDate":"2014-07-24T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f46953","address":{"building":"4429","street":"Kissena Blvd","zipcode":"11355"},"name":"New Kissena Chinese Food","currentGrade":"A","latestScore":7,"inspectionDate":"2014-02-12T00:00:00.000Z"}],"executionTimeMs":1794,"queryOperators":["$match","$addFields","$arrayElemAt","$project","$sort","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"List 15 Chinese restaurants in zip code 10019 that have only received 'A' grades in all their inspections","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      cuisine: \"Chinese\",\n      \"address.zipcode\": \"10019\"\n    }\n  },\n  {\n    $match: {\n      grades: {\n        $not: {\n          $elemMatch: {\n            grade: { $ne: \"A\" }\n          }\n        }\n      },\n      grades: { $exists: true, $ne: [] }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      totalInspections: { $size: \"$grades\" },\n      allGrades: {\n        $map: {\n          input: \"$grades\",\n          as: \"grade\",\n          in: \"$$grade.grade\"\n        }\n      }\n    }\n  },\n  {\n    $limit: 15\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f42b3e","address":{"building":"877","street":"10 Avenue","zipcode":"10019"},"name":"Ocean Dragon Restaurant","totalInspections":5,"allGrades":["B","A","A","A","A"]},{"_id":"5eb3d668b31de5d588f43316","address":{"building":"24","street":"West 56 Street","zipcode":"10019"},"name":"Joe'S Shanghai Restaurant","totalInspections":6,"allGrades":["Z","B","A","A","C","B"]},{"_id":"5eb3d668b31de5d588f43c93","address":{"building":"200","street":"West   57 Street","zipcode":"10019"},"name":"Lili'S 57","totalInspections":5,"allGrades":["Z","A","A","B","A"]},{"_id":"5eb3d668b31de5d588f44a3c","address":{"building":"795","street":"9 Avenue","zipcode":"10019"},"name":"Mee Noodle Shop","totalInspections":3,"allGrades":["A","A","A"]},{"_id":"5eb3d669b31de5d588f4551d","address":{"building":"242","street":"West   56 Street","zipcode":"10019"},"name":"Szechuan Gourmet","totalInspections":6,"allGrades":["B","C","B","B","B","P"]},{"_id":"5eb3d669b31de5d588f45ff4","address":{"building":"858","street":"8 Avenue","zipcode":"10019"},"name":"Peking Roast Duck","totalInspections":4,"allGrades":["A","B","B","A"]},{"_id":"5eb3d669b31de5d588f46220","address":{"building":"694","street":"10 Avenue","zipcode":"10019"},"name":"New Food King Chinese Restaurant","totalInspections":5,"allGrades":["A","A","A","B","A"]},{"_id":"5eb3d669b31de5d588f462bd","address":{"building":"760","street":"10 Avenue","zipcode":"10019"},"name":"Happy Joy","totalInspections":6,"allGrades":["A","C","A","B","A","C"]},{"_id":"5eb3d669b31de5d588f46e9c","address":{"building":"65","street":"West 55 Street","zipcode":"10019"},"name":"Tang Pavilion","totalInspections":3,"allGrades":["A","A","B"]},{"_id":"5eb3d669b31de5d588f46fb2","address":{"building":"860","street":"10 Avenue","zipcode":"10019"},"name":"Bei Jing Chinese Restaurant","totalInspections":3,"allGrades":["A","A","A"]},{"_id":"5eb3d669b31de5d588f47a1d","address":{"building":"811","street":"8 Avenue","zipcode":"10019"},"name":"Kung Fu Little Stemed Buns Ramen Inc","totalInspections":1,"allGrades":["A"]},{"_id":"5eb3d669b31de5d588f480bc","address":{"building":"877","street":"8 Avenue","zipcode":"10019"},"name":"China Gourmet","totalInspections":2,"allGrades":["C","A"]},{"_id":"5eb3d669b31de5d588f4817a","address":{"building":"40","street":"West 56 Street","zipcode":"10019"},"name":"Hunan House","totalInspections":1,"allGrades":["A"]},{"_id":"5eb3d669b31de5d588f48a0d","address":{"building":"877","street":"8Th Ave","zipcode":"10019"},"name":"China Gourmet 35 Inc","totalInspections":1,"allGrades":["Not Yet Graded"]}],"executionTimeMs":2055,"queryOperators":["$match","$not","$elemMatch","$ne","$exists","$project","$size","$map","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"In zip codes 10003 and 10009, which Chinese restaurants have improved from a 'B' or 'C' grade to an 'A' grade in their most recent inspection compared to their previous one, including the dates of both inspections?","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      \"address.zipcode\": { $in: [\"10003\", \"10009\"] },\n      \"cuisine\": \"Chinese\",\n      \"grades.1\": { $exists: true } // Ensure at least 2 grades exist\n    }\n  },\n  {\n    $addFields: {\n      // Sort grades by date descending to ensure most recent is first\n      sortedGrades: {\n        $sortArray: {\n          input: \"$grades\",\n          sortBy: { date: -1 }\n        }\n      }\n    }\n  },\n  {\n    $match: {\n      $expr: {\n        $and: [\n          { $eq: [{ $arrayElemAt: [\"$sortedGrades.grade\", 0] }, \"A\"] }, // Most recent grade is A\n          { $in: [{ $arrayElemAt: [\"$sortedGrades.grade\", 1] }, [\"B\", \"C\"]] } // Previous grade is B or C\n        ]\n      }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      currentInspection: {\n        grade: { $arrayElemAt: [\"$sortedGrades.grade\", 0] },\n        score: { $arrayElemAt: [\"$sortedGrades.score\", 0] },\n        date: { $arrayElemAt: [\"$sortedGrades.date\", 0] }\n      },\n      previousInspection: {\n        grade: { $arrayElemAt: [\"$sortedGrades.grade\", 1] },\n        score: { $arrayElemAt: [\"$sortedGrades.score\", 1] },\n        date: { $arrayElemAt: [\"$sortedGrades.date\", 1] }\n      }\n    }\n  },\n  {\n    $sort: { name: 1 }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f46066","address":{"building":"238","street":"East   14 Street","zipcode":"10003"},"name":"Baohaus","currentInspection":{"grade":"A","score":10,"date":"2014-08-12T00:00:00.000Z"},"previousInspection":{"grade":"B","score":14,"date":"2014-01-30T00:00:00.000Z"}},{"_id":"5eb3d669b31de5d588f47130","address":{"building":"223","street":"East   14 Street","zipcode":"10003"},"name":"Beijing Chinese Restaurant","currentInspection":{"grade":"A","score":11,"date":"2014-11-07T00:00:00.000Z"},"previousInspection":{"grade":"B","score":19,"date":"2014-03-18T00:00:00.000Z"}},{"_id":"5eb3d669b31de5d588f4615b","address":{"building":"104","street":"2 Avenue","zipcode":"10003"},"name":"Hot Kitchen","currentInspection":{"grade":"A","score":2,"date":"2014-09-03T00:00:00.000Z"},"previousInspection":{"grade":"B","score":20,"date":"2014-02-11T00:00:00.000Z"}},{"_id":"5eb3d669b31de5d588f453ec","address":{"building":"203","street":"East 14 Street","zipcode":"10003"},"name":"Red House Restaurant","currentInspection":{"grade":"A","score":12,"date":"2015-01-14T00:00:00.000Z"},"previousInspection":{"grade":"B","score":26,"date":"2014-09-22T00:00:00.000Z"}}],"executionTimeMs":5553,"queryOperators":["$match","$in","$exists","$addFields","$sortArray","$expr","$and","$eq","$arrayElemAt","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Find the top 10 streets in Queens that have 3 or more restaurants serving the same type of cuisine, grouped by cuisine type","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Queens\"\n    }\n  },\n  {\n    $group: {\n      _id: {\n        street: \"$address.street\",\n        cuisine: \"$cuisine\"\n      },\n      restaurantCount: { $sum: 1 },\n      restaurants: { $push: \"$name\" }\n    }\n  },\n  {\n    $match: {\n      restaurantCount: { $gte: 3 }\n    }\n  },\n  {\n    $sort: {\n      restaurantCount: -1\n    }\n  },\n  {\n    $limit: 10\n  },\n  {\n    $project: {\n      _id: 0,\n      street: \"$_id.street\",\n      cuisine: \"$_id.cuisine\",\n      restaurantCount: 1,\n      restaurants: 1\n    }\n  }\n])","language":"mongosh","result":[{"restaurantCount":69,"restaurants":["Timmy'S Deli","Evolution","Flushing Meadows Pitch And Putt","Tres Coronas Bar","Uno Cafe & Billiards","Stop Inn Restaurant & Cafe","Olmsted Cafeteria","Saints & Sinners","Roosevelt Sports Bar","Carmelitas Billards","World Ice Cafe","Employee Cafeteria","Sterling Market","Stand 142 The Original Cascarino\u001aS Brick Oven Pizzeria & Ristorante","Stand 139 Taco Frites","Stand 139 Blue Smoke","Stand 402","Champions' Club (Stand 119)","Stand # 425","Champion Club 1St Base Stand 117","Stand 139 Shake Shack","Stand 327","Stands 303 And 301 Pepsi Porch","310 - Exelsior","Stand 325 Nathan'S Dogs & Burgers","Left Field Rest Acela 340","Concessions Stand Gac","Delta Kitchen (In Seat Svc Bar 1)","World'S Fair Market","Stand 135","Dunkin' Donuts, Subway","Stand 420","Stand 417","Suite Kitchen","318 - Two Boots","Stand 312","Press Kitchen","Stand 431","Stand 406","Stand 404","Sagitario Bakery","Stand 114","Stand 123","Stand 121","Stand 435","Stand # 433","Stand 140 Beer Island","Stand 335 Beverages & Snacks","New York Mets Visitors Clubhouse","New York Mets Home Clubhouse","Inseat Service (2Nd Flr)","Stand 110","Catch Of The Day","Stand 137","Stand 112","Field Level In Seat Kitchen","Stand 423","Stand 421","Club Bar #2 Horseshoe Bar (1St Base)","Club Bar #1 (First Base)","Stand 321 Caesars Club","Ceasar/Club Bar #3","Stand 408","Two Boots/ Stand 412","337 - Burgers & Dogs","Metro Kitchen","Friends Corner Cafe","Donovan'S Pub","Tuscan Cafe"],"street":"Roosevelt Avenue","cuisine":"American"},{"restaurantCount":57,"restaurants":["Kum Gang San","E-Dah Korean Bbq Lounge","San Soo Kap San","Park'S Snack","Yiyi Rang","Nolbu Restaurant","Mani Mani Restaurant","Happy Karaoke","Seoul Korean Restaurant","Dae Dong Manor","Hansol Nutrition Center","Mad For Chicken","Korean Bbq Restaurant","Bonjuk","Geo Si Gi","Cosmos Room Cafe","Kyedong","Kyochon Chicken","Picnic Garden","Ga Hwa Korean Restaurant","Sam Won Gahk","New York Kim-Bob Nara","Bbq Chicken","Bbq Village","Yedon","Tong Tong Tonkatsu","Rolly Kimbab","Sweetie & Vip","Hanra Cafe","Gal Bi Ma Eul","Dotori (Roosevelt Ave)","Da Heen Wangmandoo","Song'S Food","Mat Ba Ram","Bcd Tofu House","Sorang Korean Bbq Grill","Hyung Je Haejank Guk","Janchi Ny","Emone Korean Family Restaurant","Shinjung Galbi Bbq Korean Restaurant","Korean Noodle House","Cafe Originale","Gag Pocha","Cafe Bene","Cosmos Room Cafe","1962 Sogongdong Sontofu","Byung Chun Soon Dae","Gang San Deul","Kang Ho Dong Baek Jeong","Shin Hwang Je Topokki","New York Spa & Sauna Cafe","Yedang","Ceo","Hashi Ramen & Izakaya","Tang","Modurang","Chang'S Family Restaurant"],"street":"Northern Boulevard","cuisine":"Korean"},{"restaurantCount":56,"restaurants":["Jr Restaurant At Jamaicia","Tian Jin Chinese Restaurant","Jing Fu House","New Golden Szechuan","Jin Cheng Restaurant","New Spring Garden","Casserole.Big Bowl Of Noodle","M S Han Song Ting","New Flushing Bakery","Li'S Lanzhou Hand-Stretched Noodles","Lao Ma Ma La Tang","New Mei Hua","New Ming Garden","New Panda Garden","New King House","Hot Pot (Ste #4)","Ma La Xiang Wok","King House","Happy Su Garden","Quickly Cafe","Claypot (Food Court, #23)","Taipei Hong","Long Spring Garden","Taiwanese Market Food","Sichuan Cuisine","Yummy Dim Sum","China Aaa","Palace Restaurant","Hot Pot & Bubble Tea","New China Iii","Lan Zhou Hand Made Noodle","Tao Xiang","Yoz Shanghai (Booth 20)","Hot Point Pot","Royal Queen","E-Pie","8090 Tai Wanese","Xiao Wei Mala Yabu","Liang Pi Wang","Hot Kitchen Sichuan Style","Fresh Dumpling","Hong Kong Cafe / Fresh Sandwich Bakery (Basement Food Court Restaurant & 1St Fl Bakery)","Yang Yang Noodle","Hang # 16","Incredibowl","Chicken Noodle","Yoyo Dessert# 6","Panyo Bbq","Slz # 14","Xiangyi Noodle Inc","Happy Lemon","Guchun Private Kitchen","Joyful Yummy House","Gladly Cuisine # 15","Jb Crispy Pancake","Bubble Panda"],"street":"Roosevelt Avenue","cuisine":"Chinese"},{"restaurantCount":54,"restaurants":["Red Bowl Noodle Shop","Annie'S Kitchen","Chen Du Tian Fu","Spicy Restaurant","Hu She","Tasty Roast House","Maple Garden","Melody Karaoke","Great Wall Chinese Restaurant","Main St Imperial Taiwanese Gourmet","Rural Chinese Restaurant","Noodle Village So Good","Hong Tai Yang","Chatime","Kan Wah Kitchen","Yoz Shanghai","First Hot Pot","Quan De Fu","Wu Chinese Restaurant","7Th Mansion Ktv","Kung Fu Xiao Long Bao","Shanghai Cuisine 33","Jin Feng Fish Ball","Lamb Noodle Soup","Chuanshi # 17","Northern Dumpling King","Grand Shangai","On & On Restaurant","Hly Chinese Cuisine","East Dim Sum","Hunan Kitchen","Red Bean","East Buffet & Restaurant","Super Snacks","Xinxin Restaurant","Ah2 Ice Tea","Guizhou Noodles House","Jake Tasty Food","East Buffet & Restaurant","Xing Wang Fuzhou Cuisine","Vishine Fashion (Juice Bar)","King Wok","Soy Sauce","Lok Lok Restaurant","Tianjin Dumpling House","Halal Bbq Chicken","Biang","Happy Family Hotpot","Xian Famous Foods","C & Y Noodle (Store#24 E)","Dumpling Galaxy","Expressway Bubble Tea & Snacks","Lao Ma Ma La Tang","Lao Ma Spicy"],"street":"Main Street","cuisine":"Chinese"},{"restaurantCount":50,"restaurants":["Cobblestone Pub","Alpha Donuts","Georgia Diner","T-Bone Diner","Flagship Diner","O'Hanlon'S","Pj Horgan'S Pub","Midway Cinemas","The Courtyard Ale House","The New Thompson Diner","Cinnabon World Famous Cinnamon Rolls","Boston Market","Tasty Fast Food","The Gaslight Bar","Applebee'S Neighborhood Grill & Bar","Play","Maggie Mae'S","Burger King","Applebee'S Neighborhood Grill & Bar","Tropix Bar & Lounge","Sunnyside Movie Theater","Allure","New York Style Eats","Mcdonald'S","Pete'S Grill","Friends Coffee Shop","Briarwood Cafe","Euro Grill & Salad Bar","Ariel'S Cafe","Cafe Bora Bora","Salt And Fat","Ranch One","Mila'S Cafe","Forest Hills Bagels","Kentucky Fried Chicken","Nathans Famous","16 Handles Frozen Yogurt","Hot & Tasty","Fresco Deli Corp","Sbarro","Redwood Deli","Keuka Kafe","Seven One Ocho","Foxy'S Diner","Secrets Gentleman'S Club","Sidetracks Restaurant","Nevada Diner","Gloria Jean'S Coffees","Oasis Restaurant","Seattle Cafe"],"street":"Queens Boulevard","cuisine":"American"},{"restaurantCount":38,"restaurants":["Flamingo","Cafe 75 Bar","Queens Coffee Shop","Izalco Restaurant","Desseo Night Club","El Dorado Cafe","Hornado Ecuatoriano","Hairos Night Club","El Sitio Restaurant","Cositas Ricas","Bum Bum Bar","El Pequeno Coffee Shop","Los Cuencanitos","Romanticos","Pollos Mario","Luz De America Restaurant","Amor Karaoke & Bar","Seba-Seba","Pollos A La Brasa Marion","La Escuelita Nueva Bar Lounge","Los Mismo Restaurant","Puerto Escondido","Tropical Restaurant","Quisqueya Restaurant","Quick Stop Deli","El Abuelo Gozon","La Abundancia Bakery And Restauran","Los Sauces Bar & Restaurant","El Canelazo Bar Restaurant","El Tucanazo Bar","Tradiciones Latinas Restaurant","La Casa Del Pollo Peruano","La Dulce Bakery","El Picosito Bar Lounge","La Gata Golosa/Yogurtberry","Ny Chevillo-Tte","Chiflez","Arepa Lady"],"street":"Roosevelt Avenue","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)"},{"restaurantCount":37,"restaurants":["Swiss International Airlines Lounge","Virgin Atlantic Club House","Soho Bistro","Star Mountain Coffee","Idlewild Wine Bar","O'Neals","Nysb","Drink","The Medalist Bar","Trafalgar Pub","Food Court Kitchen","Illy/Velocity Bar (Ec2)","Revive (Sc)","Piquillo","Cc Kitchen","Fresh","Aeronuova","New York Sports Grill","Croque Madame","Lavazza Espresso Bar","Labrea Bakery","Shake Shack","Uptown Brasserie","Blue Smoke/On The Road","Buffalo Wild Wings,Peets Coofee &Tea, Panopolis Bakery & Cafe","Tigin Irish Pub,Peets Coffee&Tea,Panopolis Bakery&Cafe","Airspace Lounge","World Bean","Cibo Market (Gate C65)","World Bean Main","Peet'S Coffee/Tea","The Palm","Cibo Market Right","Central Diner","Loft","Hudson/Dunkin Donuts/Basking Robins","Urban  Crave"],"street":"Jfk International Airport","cuisine":"American"},{"restaurantCount":35,"restaurants":["Los Arrieros Restaurant","Scorpio Bar","Pollos A La Brasa","Hornado Ecuatoriano","Scorpion","Pollos Gus Restaurant","True Colors Bar","Original Mama'S Empanadas","Manila Bar & Restaurant","La Abundancia Bakery","Mini Picanteria El Guayaquileno Ii","La Picardia Poblana Bar","El Sabroso Coffee Shop","Pastes Kiko'S New York","Melao","Casa Colombia Restaurant","Nanos Restaurant","Delicias Bakery & Restaurant","Pico De Gallo","La Mitad Del Mundo Bar-Restaurant","12 Corazones Restaurant & Bar","La Fonda Restaurant","La Abundancia","Carmen'S Lunch The Best Dominican Cuisine","Taqueria Chila","Los Chuzos","Mi Tierra Coffee Shop","El Burito Loco","Tarros Bar","Organic Food, Natural Juices And Coffee Shop","Las Jarochitas Rest","La Gitana # 2","La Pequena Colombia","Delicias Calenas Bakery & Restaurant","La Parada De Los Pinchos"],"street":"Roosevelt Avenue","cuisine":"Spanish"},{"restaurantCount":34,"restaurants":["Marbella Restaurant","Los Toldos Restaurant","La Cabana Argentina","Galicia Bar","El Rumbero Bar Restaurant","Pico Rico","El Paisa Cafe","Lenos Bar Cafe","Kabu Bar & Lounge","Pio Pio To Go","Caridad Restaurant","Manta Llave Del Mar Bar Restaurant","Cafe Rubio","La Boom Club","Los Cabos","Pio-Pio","Cibao Restaurant","D'Antigua Restaurant","Pal Karajo","Colombian Burger","Banana King","La Pollera Colorada Ii","Rubi Rosa Restaurant & Bar","Salinas Ecuadorian Bar & Restaurant","Los Toritos Bar Restaurant","Sal'S Restaurant","La Perrada De Chalo","Puerto Colombia","La Choza Del Gordo","Gloria","La Gloria","Mama'S Empanadas","Theater Restaurant Blvd","Rancho Mofongo"],"street":"Northern Boulevard","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)"},{"restaurantCount":32,"restaurants":["Ambassador Dining Room  At Saratoga Family Inn","Track Kitchen","Trackside","The Tick Tavern","Cozy Bowl Lounge","A & B Deli & Catering","Kennedy Deli","Dunkin' Donuts, Baskin Robbins","Meditteranean Grill","R.C.L Enterprises Inc.","Subway","Fresh To You Cafe","Rockaway Plaza Deli","Baccarat Club","Bar 360","Subway","Palm Beach Lounge","Popeyes Chicken & Biscuits","Queens Burgers","Rw Prime Service Bar","Winner'S Circle Coffee Shop","Triple Crown Cafe","Equestris","Uptown Express Service Bar","Liberty Bar Service Bar- Service Bar 7","Long Shots","Third Service Bar","Liberty Bar","The Jockey'S Room","Portable Bar 4 & 5","Villa Marcello","Betty Ann'S Place"],"street":"Rockaway Boulevard","cuisine":"American"}],"executionTimeMs":6587,"queryOperators":["$match","$group","$sum","$push","$gte","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find all zip codes where less than 50% of restaurants have an A grade","dbQuery":"db.restaurants.aggregate([\n  {\n    $addFields: {\n      hasAGrade: {\n        $in: [\"A\", \"$grades.grade\"]\n      }\n    }\n  },\n  {\n    $group: {\n      _id: \"$address.zipcode\",\n      totalRestaurants: { $sum: 1 },\n      restaurantsWithAGrade: {\n        $sum: {\n          $cond: [\"$hasAGrade\", 1, 0]\n        }\n      }\n    }\n  },\n  {\n    $addFields: {\n      percentageAGrade: {\n        $multiply: [\n          {\n            $divide: [\"$restaurantsWithAGrade\", \"$totalRestaurants\"]\n          },\n          100\n        ]\n      }\n    }\n  },\n  {\n    $match: {\n      percentageAGrade: { $lt: 50 }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      zipcode: \"$_id\",\n      percentageAGrade: { $round: [\"$percentageAGrade\", 2] },\n      totalRestaurants: 1\n    }\n  },\n  {\n    $sort: { percentageAGrade: 1 }\n  }\n])","language":"mongosh","result":[{"totalRestaurants":1,"zipcode":"10167","percentageAGrade":0},{"totalRestaurants":1,"zipcode":"10048","percentageAGrade":0},{"totalRestaurants":1,"zipcode":"11352","percentageAGrade":0}],"executionTimeMs":2953,"queryOperators":["$addFields","$in","$group","$sum","$cond","$multiply","$divide","$match","$lt","$project","$round","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the 15 most recent restaurants in Tribeca and SoHo that got a B or C grade in their last inspection","dbQuery":"db.restaurants.aggregate([\n  // Match restaurants in Manhattan first (using borough index)\n  {\n    $match: {\n      borough: \"Manhattan\"\n    }\n  },\n  // Filter for restaurants with most recent grade B or C\n  {\n    $match: {\n      \"grades.0.grade\": { $in: [\"B\", \"C\"] }\n    }\n  },\n  // Filter by approximate geographic boundaries for Tribeca and SoHo\n  // Tribeca roughly: south of Canal St, north of Chambers St, west of Broadway\n  // SoHo roughly: south of Houston St, north of Canal St, between 6th Ave and Lafayette\n  {\n    $match: {\n      $or: [\n        // Tribeca approximate boundaries\n        {\n          \"address.coord.1\": { $gte: 40.7163, $lte: 40.7270 },\n          \"address.coord.0\": { $gte: -74.0130, $lte: -74.0030 }\n        },\n        // SoHo approximate boundaries\n        {\n          \"address.coord.1\": { $gte: 40.7210, $lte: 40.7280 },\n          \"address.coord.0\": { $gte: -74.0050, $lte: -73.9940 }\n        }\n      ]\n    }\n  },\n  // Sort by most recent inspection date\n  {\n    $sort: {\n      \"grades.0.date\": -1\n    }\n  },\n  // Limit to 15 results\n  {\n    $limit: 15\n  },\n  // Project only required fields\n  {\n    $project: {\n      name: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\"\n      },\n      lastGrade: { $arrayElemAt: [\"$grades.grade\", 0] },\n      lastInspectionDate: { $arrayElemAt: [\"$grades.date\", 0] }\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f45909","address":{"building":"40","street":"Harrison Street"},"name":"Josephine","lastGrade":"B","lastInspectionDate":"2014-11-28T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f47475","address":{"building":"458","street":"Greenwich Street"},"name":"The Greek","lastGrade":"B","lastInspectionDate":"2014-11-12T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f45ffe","address":{"building":"77","street":"Hudson Street"},"name":"Zutto","lastGrade":"B","lastInspectionDate":"2014-11-12T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42dda","address":{"building":"69","street":"Thompson Street"},"name":"Vin Et Fleurs","lastGrade":"B","lastInspectionDate":"2014-11-05T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f456f5","address":{"building":"319","street":"Greenwich Street"},"name":"Salaam Bombay","lastGrade":"B","lastInspectionDate":"2014-10-27T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f43549","address":{"building":"545","street":"Broadway"},"name":"Cafe Duke","lastGrade":"B","lastInspectionDate":"2014-10-27T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f437f8","address":{"building":"337","street":"Lafayette Street"},"name":"Bite","lastGrade":"B","lastInspectionDate":"2014-10-21T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42adb","address":{"building":"172","street":"Thompson Street"},"name":"Tomoe Sushi","lastGrade":"B","lastInspectionDate":"2014-10-15T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f44b7f","address":{"building":"508","street":"Greenwich Street"},"name":"508 Restaurant And Bar","lastGrade":"C","lastInspectionDate":"2014-10-14T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42ce7","address":{"building":"340","street":"West Broadway"},"name":"Felix","lastGrade":"B","lastInspectionDate":"2014-10-07T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f429ae","address":{"building":"1","street":"Lispenard Street"},"name":"Nancy Whiskey Pub","lastGrade":"B","lastInspectionDate":"2014-10-07T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42ff0","address":{"building":"195","street":"Spring Street"},"name":"Mezzogiorno","lastGrade":"B","lastInspectionDate":"2014-10-01T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f45c99","address":{"building":"86","street":"Kenmare Street"},"name":"Tobys Public House","lastGrade":"B","lastInspectionDate":"2014-09-29T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f4495b","address":{"building":"185","street":"Duane Street"},"name":"Hideaway","lastGrade":"B","lastInspectionDate":"2014-09-22T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f43806","address":{"building":"311","street":"Church Street"},"name":"Macao  Restuarant And Bar","lastGrade":"B","lastInspectionDate":"2014-09-17T00:00:00.000Z"}],"executionTimeMs":1746,"queryOperators":["$match","$in","$or","$gte","$lte","$sort","$limit","$project","$arrayElemAt"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find the 12 Italian restaurants in Manhattan with zipcodes 10011, 10012, or 10013 that have B or C as their most recent grade","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Manhattan\",\n      cuisine: \"Italian\",\n      \"address.zipcode\": { $in: [\"10011\", \"10012\", \"10013\"] }\n    }\n  },\n  {\n    $addFields: {\n      sortedGrades: {\n        $sortArray: {\n          input: \"$grades\",\n          sortBy: { date: -1 }\n        }\n      }\n    }\n  },\n  {\n    $addFields: {\n      mostRecentGrade: { $arrayElemAt: [\"$sortedGrades\", 0] }\n    }\n  },\n  {\n    $match: {\n      \"mostRecentGrade.grade\": { $in: [\"B\", \"C\"] }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      cuisine: 1,\n      address: {\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      mostRecentGrade: \"$mostRecentGrade.grade\",\n      inspectionDate: \"$mostRecentGrade.date\"\n    }\n  },\n  {\n    $limit: 12\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f42f2f","address":{"street":"Mulberry Street","zipcode":"10013"},"cuisine":"Italian","name":"Il Palazzo","mostRecentGrade":"B","inspectionDate":"2014-09-23T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42ff0","address":{"street":"Spring Street","zipcode":"10012"},"cuisine":"Italian","name":"Mezzogiorno","mostRecentGrade":"B","inspectionDate":"2014-10-01T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f43562","address":{"street":"Chelsea Piers","zipcode":"10011"},"cuisine":"Italian","name":"Studio Cafe 59","mostRecentGrade":"B","inspectionDate":"2014-08-12T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f4365e","address":{"street":"Spring Street","zipcode":"10012"},"cuisine":"Italian","name":"Bread","mostRecentGrade":"B","inspectionDate":"2014-08-22T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f45169","address":{"street":"8 Avenue","zipcode":"10011"},"cuisine":"Italian","name":"Tello'S","mostRecentGrade":"B","inspectionDate":"2014-07-10T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f45c99","address":{"street":"Kenmare Street","zipcode":"10012"},"cuisine":"Italian","name":"Tobys Public House","mostRecentGrade":"B","inspectionDate":"2014-09-29T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f45ebf","address":{"street":"Mulberry Street","zipcode":"10013"},"cuisine":"Italian","name":"Ristorante Luna","mostRecentGrade":"B","inspectionDate":"2014-08-13T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f462a7","address":{"street":"Bowery","zipcode":"10012"},"cuisine":"Italian","name":"Forcella","mostRecentGrade":"C","inspectionDate":"2014-05-21T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f46366","address":{"street":"West 13 Street","zipcode":"10011"},"cuisine":"Italian","name":"Sotto 13","mostRecentGrade":"B","inspectionDate":"2014-05-27T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f4664d","address":{"street":"8 Avenue","zipcode":"10011"},"cuisine":"Italian","name":"Intermezzo","mostRecentGrade":"B","inspectionDate":"2014-05-19T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f46948","address":{"street":"Mercer Street","zipcode":"10013"},"cuisine":"Italian","name":"Galli Restaurant","mostRecentGrade":"B","inspectionDate":"2014-08-27T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f475c0","address":{"street":"West Broadway","zipcode":"10013"},"cuisine":"Italian","name":"Terra","mostRecentGrade":"B","inspectionDate":"2014-08-04T00:00:00.000Z"}],"executionTimeMs":2250,"queryOperators":["$match","$in","$addFields","$sortArray","$arrayElemAt","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"What's the average percentage of A-grade restaurants in zip codes 10013, 10014, and 10011 versus zip codes 10451, 10452, and 10453?","dbQuery":"db.restaurants.aggregate([\n  // Match restaurants in the specified zip codes\n  {\n    $match: {\n      \"address.zipcode\": {\n        $in: [\"10013\", \"10014\", \"10011\", \"10451\", \"10452\", \"10453\"]\n      }\n    }\n  },\n  // Add a field to categorize zip codes and check if restaurant has A grade\n  {\n    $addFields: {\n      zipCategory: {\n        $cond: {\n          if: { $in: [\"$address.zipcode\", [\"10013\", \"10014\", \"10011\"]] },\n          then: \"highRent\",\n          else: \"lowRent\"\n        }\n      },\n      hasAGrade: {\n        $gt: [\n          {\n            $size: {\n              $filter: {\n                input: \"$grades\",\n                cond: { $eq: [\"$$this.grade\", \"A\"] }\n              }\n            }\n          },\n          0\n        ]\n      }\n    }\n  },\n  // Group by zip code to get counts\n  {\n    $group: {\n      _id: {\n        zipcode: \"$address.zipcode\",\n        category: \"$zipCategory\"\n      },\n      totalRestaurants: { $sum: 1 },\n      aGradeRestaurants: {\n        $sum: { $cond: [\"$hasAGrade\", 1, 0] }\n      }\n    }\n  },\n  // Calculate percentage for each zip code\n  {\n    $addFields: {\n      aGradePercentage: {\n        $multiply: [\n          { $divide: [\"$aGradeRestaurants\", \"$totalRestaurants\"] },\n          100\n        ]\n      }\n    }\n  },\n  // Group by category to get average percentage\n  {\n    $group: {\n      _id: \"$_id.category\",\n      zipcodes: { $push: \"$_id.zipcode\" },\n      averageAGradePercentage: { $avg: \"$aGradePercentage\" },\n      totalRestaurants: { $sum: \"$totalRestaurants\" }\n    }\n  },\n  // Format the final output\n  {\n    $group: {\n      _id: null,\n      results: {\n        $push: {\n          k: \"$_id\",\n          v: {\n            zipcodes: \"$zipcodes\",\n            averageAGradePercentage: \"$averageAGradePercentage\",\n            totalRestaurants: \"$totalRestaurants\"\n          }\n        }\n      }\n    }\n  },\n  {\n    $replaceRoot: {\n      newRoot: { $arrayToObject: \"$results\" }\n    }\n  },\n  // Rename fields to match expected schema\n  {\n    $project: {\n      highRentZips: \"$highRent\",\n      lowRentZips: \"$lowRent\"\n    }\n  }\n])","language":"mongosh","result":[{"highRentZips":{"zipcodes":["10014","10011","10013"],"averageAGradePercentage":93.42850622941779,"totalRestaurants":1375},"lowRentZips":{"zipcodes":["10452","10451","10453"],"averageAGradePercentage":92.0265163162279,"totalRestaurants":350}}],"executionTimeMs":2146,"queryOperators":["$match","$in","$addFields","$cond","$gt","$size","$filter","$eq","$group","$sum","$multiply","$divide","$push","$avg","$replaceRoot","$arrayToObject","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Show me all restaurants at building number '1515' on Broadway that have received an 'A' grade in their most recent inspection","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      \"address.building\": \"1515\",\n      \"address.street\": \"Broadway\",\n      \"grades\": { $exists: true, $ne: [] }\n    }\n  },\n  {\n    $unwind: \"$grades\"\n  },\n  {\n    $sort: { \"grades.date\": -1 }\n  },\n  {\n    $group: {\n      _id: \"$_id\",\n      name: { $first: \"$name\" },\n      cuisine: { $first: \"$cuisine\" },\n      latestGrade: { $first: \"$grades\" }\n    }\n  },\n  {\n    $match: {\n      \"latestGrade.grade\": \"A\"\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      cuisine: 1,\n      latestGrade: {\n        date: \"$latestGrade.date\",\n        grade: \"$latestGrade.grade\",\n        score: \"$latestGrade.score\"\n      }\n    }\n  }\n])","language":"mongosh","result":[{"name":"Best Buy Theater","cuisine":"American","latestGrade":{"date":"2014-06-19T00:00:00.000Z","grade":"A","score":7}},{"name":"Viacom Cafeteria","cuisine":"American","latestGrade":{"date":"2014-09-16T00:00:00.000Z","grade":"A","score":10}},{"name":"Refresh Cafe","cuisine":"Café/Coffee/Tea","latestGrade":{"date":"2014-12-31T00:00:00.000Z","grade":"A","score":4}},{"name":"Viacom Executive Dining Room","cuisine":"American","latestGrade":{"date":"2014-02-21T00:00:00.000Z","grade":"A","score":12}}],"executionTimeMs":2130,"queryOperators":["$match","$exists","$ne","$unwind","$sort","$group","$first","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"For each borough in NYC, count how many different types of cuisines are available and show the top 5 boroughs with the most diverse food options","dbQuery":"db.restaurants.aggregate([\n  {\n    $group: {\n      _id: \"$borough\",\n      uniqueCuisines: { $addToSet: \"$cuisine\" }\n    }\n  },\n  {\n    $project: {\n      borough: \"$_id\",\n      uniqueCuisineCount: { $size: \"$uniqueCuisines\" }\n    }\n  },\n  {\n    $sort: { uniqueCuisineCount: -1 }\n  },\n  {\n    $limit: 5\n  }\n])","language":"mongosh","result":[{"_id":"Manhattan","borough":"Manhattan","uniqueCuisineCount":82},{"_id":"Brooklyn","borough":"Brooklyn","uniqueCuisineCount":80},{"_id":"Queens","borough":"Queens","uniqueCuisineCount":74},{"_id":"Staten Island","borough":"Staten Island","uniqueCuisineCount":56},{"_id":"Bronx","borough":"Bronx","uniqueCuisineCount":52}],"executionTimeMs":2221,"queryOperators":["$group","$addToSet","$project","$size","$sort","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the top 15 cuisine types in Manhattan with their restaurant counts, sorted by how many restaurants serve each cuisine","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Manhattan\"\n    }\n  },\n  {\n    $group: {\n      _id: \"$cuisine\",\n      restaurantCount: { $sum: 1 }\n    }\n  },\n  {\n    $sort: {\n      restaurantCount: -1\n    }\n  },\n  {\n    $limit: 15\n  },\n  {\n    $project: {\n      _id: 0,\n      cuisine: \"$_id\",\n      restaurantCount: 1\n    }\n  }\n])","language":"mongosh","result":[{"restaurantCount":3205,"cuisine":"American"},{"restaurantCount":680,"cuisine":"Café/Coffee/Tea"},{"restaurantCount":621,"cuisine":"Italian"},{"restaurantCount":510,"cuisine":"Chinese"},{"restaurantCount":438,"cuisine":"Japanese"},{"restaurantCount":371,"cuisine":"Other"},{"restaurantCount":339,"cuisine":"Pizza"},{"restaurantCount":273,"cuisine":"Mexican"},{"restaurantCount":266,"cuisine":"French"},{"restaurantCount":221,"cuisine":"Bakery"},{"restaurantCount":211,"cuisine":"Sandwiches"},{"restaurantCount":195,"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)"},{"restaurantCount":154,"cuisine":"Thai"},{"restaurantCount":152,"cuisine":"Indian"},{"restaurantCount":142,"cuisine":"Sandwiches/Salads/Mixed Buffet"}],"executionTimeMs":2485,"queryOperators":["$match","$group","$sum","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Calculate a diversity score for each borough by dividing the number of unique cuisine types by the total number of restaurants, and show all 5 boroughs ranked by this diversity ratio","dbQuery":"db.restaurants.aggregate([\n  {\n    $group: {\n      _id: \"$borough\",\n      uniqueCuisines: { $addToSet: \"$cuisine\" },\n      totalRestaurants: { $sum: 1 }\n    }\n  },\n  {\n    $project: {\n      borough: \"$_id\",\n      totalRestaurants: 1,\n      uniqueCuisines: { $size: \"$uniqueCuisines\" },\n      diversityRatio: {\n        $divide: [\n          { $size: \"$uniqueCuisines\" },\n          \"$totalRestaurants\"\n        ]\n      }\n    }\n  },\n  {\n    $sort: { diversityRatio: -1 }\n  }\n])","language":"mongosh","result":[{"_id":"Missing","totalRestaurants":51,"borough":"Missing","uniqueCuisines":21,"diversityRatio":0.4117647058823529},{"_id":"Staten Island","totalRestaurants":969,"borough":"Staten Island","uniqueCuisines":56,"diversityRatio":0.05779153766769866},{"_id":"Bronx","totalRestaurants":2338,"borough":"Bronx","uniqueCuisines":52,"diversityRatio":0.022241231822070145},{"_id":"Brooklyn","totalRestaurants":6086,"borough":"Brooklyn","uniqueCuisines":80,"diversityRatio":0.013144922773578704},{"_id":"Queens","totalRestaurants":5656,"borough":"Queens","uniqueCuisines":74,"diversityRatio":0.013083451202263084},{"_id":"Manhattan","totalRestaurants":10259,"borough":"Manhattan","uniqueCuisines":82,"diversityRatio":0.007992981772102545}],"executionTimeMs":2411,"queryOperators":["$group","$addToSet","$sum","$project","$size","$divide","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Count how many unique cuisine types are available in Queens versus Brooklyn","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: { $in: [\"Queens\", \"Brooklyn\"] }\n    }\n  },\n  {\n    $group: {\n      _id: \"$borough\",\n      uniqueCuisines: { $addToSet: \"$cuisine\" }\n    }\n  },\n  {\n    $project: {\n      borough: \"$_id\",\n      uniqueCuisineCount: { $size: \"$uniqueCuisines\" },\n      _id: 0\n    }\n  },\n  {\n    $sort: { borough: 1 }\n  }\n])","language":"mongosh","result":[{"borough":"Brooklyn","uniqueCuisineCount":80},{"borough":"Queens","uniqueCuisineCount":74}],"executionTimeMs":1385,"queryOperators":["$match","$in","$group","$addToSet","$project","$size","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Get the complete health inspection history for 'Pizza Haven' including all dates, grades, and scores","dbQuery":"db.restaurants.find(\n  { name: \"Pizza Haven\" },\n  { name: 1, grades: 1, _id: 0 }\n)","language":"mongosh","result":[{"grades":[{"date":"2014-12-31T00:00:00.000Z","grade":"A","score":9},{"date":"2014-05-22T00:00:00.000Z","grade":"B","score":19},{"date":"2013-10-22T00:00:00.000Z","grade":"A","score":11},{"date":"2013-04-04T00:00:00.000Z","grade":"A","score":13},{"date":"2012-08-27T00:00:00.000Z","grade":"B","score":19}],"name":"Pizza Haven"}],"executionTimeMs":2283,"queryOperators":[],"methods":["find"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"List 10 Italian restaurants in Queens that have received only 'A' grades in all their health inspections","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Queens\",\n      cuisine: \"Italian\",\n      grades: {\n        $exists: true,\n        $ne: [],\n        $not: {\n          $elemMatch: {\n            grade: { $ne: \"A\" }\n          }\n        }\n      }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      address: {\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      grades: 1\n    }\n  },\n  {\n    $limit: 10\n  }\n])","language":"mongosh","result":[{"address":{"street":"Corona Avenue","zipcode":"11368"},"grades":[{"date":"2014-07-17T00:00:00.000Z","grade":"A","score":13},{"date":"2014-02-25T00:00:00.000Z","grade":"A","score":11},{"date":"2013-03-27T00:00:00.000Z","grade":"A","score":13},{"date":"2012-02-07T00:00:00.000Z","grade":"A","score":11},{"date":"2011-12-28T00:00:00.000Z","grade":"A","score":13}],"name":"Parkside Restaurant"},{"address":{"street":"Northern Boulevard","zipcode":"11372"},"grades":[{"date":"2014-01-16T00:00:00.000Z","grade":"A","score":12},{"date":"2012-12-13T00:00:00.000Z","grade":"A","score":12},{"date":"2012-05-21T00:00:00.000Z","grade":"A","score":13},{"date":"2011-05-18T00:00:00.000Z","grade":"A","score":12}],"name":"Triestes Restaurant"},{"address":{"street":"Jackson Avenue","zipcode":"11101"},"grades":[{"date":"2014-10-03T00:00:00.000Z","grade":"A","score":12},{"date":"2013-09-27T00:00:00.000Z","grade":"A","score":12},{"date":"2012-09-14T00:00:00.000Z","grade":"A","score":12},{"date":"2012-04-18T00:00:00.000Z","grade":"A","score":10},{"date":"2011-11-25T00:00:00.000Z","grade":"A","score":13}],"name":"Manducatis"},{"address":{"street":"Marathon Parkway","zipcode":"11362"},"grades":[{"date":"2014-04-08T00:00:00.000Z","grade":"A","score":7},{"date":"2013-02-07T00:00:00.000Z","grade":"A","score":10}],"name":"Aunt Bella'S Rest Of Little Neck"},{"address":{"street":"Clintonville Street","zipcode":"11357"},"grades":[{"date":"2014-06-25T00:00:00.000Z","grade":"A","score":11},{"date":"2013-05-21T00:00:00.000Z","grade":"A","score":12},{"date":"2012-10-17T00:00:00.000Z","grade":"A","score":13},{"date":"2012-03-10T00:00:00.000Z","grade":"A","score":9},{"date":"2011-09-24T00:00:00.000Z","grade":"A","score":11}],"name":"Clinton Restaurant"},{"address":{"street":"69 Avenue","zipcode":"11365"},"grades":[{"date":"2014-08-21T00:00:00.000Z","grade":"A","score":9},{"date":"2014-02-05T00:00:00.000Z","grade":"A","score":9},{"date":"2013-06-13T00:00:00.000Z","grade":"A","score":13},{"date":"2012-04-18T00:00:00.000Z","grade":"A","score":7},{"date":"2011-12-07T00:00:00.000Z","grade":"A","score":5}],"name":"Napoli Pizza"},{"address":{"street":"Cross Island Parkway","zipcode":"11357"},"grades":[{"date":"2014-12-02T00:00:00.000Z","grade":"A","score":4},{"date":"2014-04-17T00:00:00.000Z","grade":"A","score":10},{"date":"2013-10-15T00:00:00.000Z","grade":"A","score":12},{"date":"2013-03-13T00:00:00.000Z","grade":"A","score":9}],"name":"Verdi Restaurant"},{"address":{"street":"Crossbay Boulevard","zipcode":"11414"},"grades":[{"date":"2014-11-29T00:00:00.000Z","grade":"A","score":11},{"date":"2014-04-25T00:00:00.000Z","grade":"A","score":13},{"date":"2013-03-19T00:00:00.000Z","grade":"A","score":10},{"date":"2012-03-15T00:00:00.000Z","grade":"A","score":13}],"name":"Prima Pasta & Cafe"},{"address":{"street":"Cross Island Parkway","zipcode":"11357"},"grades":[{"date":"2014-09-18T00:00:00.000Z","grade":"A","score":10},{"date":"2014-02-22T00:00:00.000Z","grade":"A","score":10},{"date":"2013-06-11T00:00:00.000Z","grade":"A","score":8},{"date":"2012-12-17T00:00:00.000Z","grade":"A","score":12},{"date":"2012-06-05T00:00:00.000Z","grade":"A","score":9},{"date":"2012-01-03T00:00:00.000Z","grade":"A","score":8}],"name":"Erin'S Isle"},{"address":{"street":"Bell Boulevard","zipcode":"11361"},"grades":[{"date":"2014-11-20T00:00:00.000Z","grade":"A","score":12},{"date":"2013-10-03T00:00:00.000Z","grade":"A","score":13},{"date":"2013-04-16T00:00:00.000Z","grade":"A","score":9},{"date":"2012-02-09T00:00:00.000Z","grade":"A","score":2}],"name":"Papazzio Restaurant"}],"executionTimeMs":6804,"queryOperators":["$match","$exists","$ne","$not","$elemMatch","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find 15 restaurants in Manhattan where the health inspection scores have gotten worse over the last 3 inspections, showing their name and complete grade history","dbQuery":"db.restaurants.aggregate([\n  // Match restaurants in Manhattan\n  {\n    $match: {\n      borough: \"Manhattan\"\n    }\n  },\n  // Only consider restaurants with at least 3 grades\n  {\n    $match: {\n      $expr: { $gte: [{ $size: \"$grades\" }, 3] }\n    }\n  },\n  // Add fields for analysis\n  {\n    $addFields: {\n      // Get the last 3 grades\n      lastThreeGrades: { $slice: [\"$grades\", -3] }\n    }\n  },\n  // Check if scores are getting worse (increasing)\n  {\n    $addFields: {\n      scoresGettingWorse: {\n        $and: [\n          // Check if the most recent score is higher than the second most recent\n          {\n            $gt: [\n              { $arrayElemAt: [\"$lastThreeGrades.score\", 2] },\n              { $arrayElemAt: [\"$lastThreeGrades.score\", 1] }\n            ]\n          },\n          // Check if the second most recent score is higher than the third most recent\n          {\n            $gt: [\n              { $arrayElemAt: [\"$lastThreeGrades.score\", 1] },\n              { $arrayElemAt: [\"$lastThreeGrades.score\", 0] }\n            ]\n          }\n        ]\n      }\n    }\n  },\n  // Filter only restaurants with worsening scores\n  {\n    $match: {\n      scoresGettingWorse: true\n    }\n  },\n  // Project only the required fields\n  {\n    $project: {\n      name: 1,\n      grades: 1\n    }\n  },\n  // Limit to 15 results\n  {\n    $limit: 15\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f4298e","grades":[{"date":"2014-07-22T00:00:00.000Z","grade":"A","score":6},{"date":"2013-05-28T00:00:00.000Z","grade":"A","score":2},{"date":"2012-05-29T00:00:00.000Z","grade":"A","score":8},{"date":"2012-01-05T00:00:00.000Z","grade":"A","score":9},{"date":"2011-08-10T00:00:00.000Z","grade":"B","score":24}],"name":"Keats Restaurant"},{"_id":"5eb3d668b31de5d588f429ca","grades":[{"date":"2014-05-05T00:00:00.000Z","grade":"A","score":11},{"date":"2013-04-25T00:00:00.000Z","grade":"A","score":7},{"date":"2012-03-20T00:00:00.000Z","grade":"A","score":8},{"date":"2011-09-13T00:00:00.000Z","grade":"A","score":9}],"name":"Shun Lee Palace Restaurant"},{"_id":"5eb3d668b31de5d588f429ee","grades":[{"date":"2014-07-30T00:00:00.000Z","grade":"A","score":6},{"date":"2013-05-23T00:00:00.000Z","grade":"A","score":12},{"date":"2012-10-04T00:00:00.000Z","grade":"A","score":7},{"date":"2012-09-04T00:00:00.000Z","grade":"P","score":9},{"date":"2012-02-23T00:00:00.000Z","grade":"B","score":22},{"date":"2011-09-12T00:00:00.000Z","grade":"B","score":24}],"name":"Malaga Restaurant"},{"_id":"5eb3d668b31de5d588f42a0d","grades":[{"date":"2014-05-16T00:00:00.000Z","grade":"A","score":10},{"date":"2013-05-13T00:00:00.000Z","grade":"A","score":6},{"date":"2012-05-18T00:00:00.000Z","grade":"A","score":12},{"date":"2011-05-25T00:00:00.000Z","grade":"A","score":13}],"name":"Red Flame Diner"},{"_id":"5eb3d668b31de5d588f42a44","grades":[{"date":"2014-10-09T00:00:00.000Z","grade":"A","score":7},{"date":"2014-05-07T00:00:00.000Z","grade":"A","score":13},{"date":"2013-11-08T00:00:00.000Z","grade":"A","score":12},{"date":"2012-10-04T00:00:00.000Z","grade":"A","score":12},{"date":"2012-05-16T00:00:00.000Z","grade":"A","score":13},{"date":"2011-12-27T00:00:00.000Z","grade":"B","score":19}],"name":"The Cupping Room"},{"_id":"5eb3d668b31de5d588f42996","grades":[{"date":"2014-11-15T00:00:00.000Z","grade":"B","score":20},{"date":"2014-04-25T00:00:00.000Z","grade":"A","score":10},{"date":"2014-03-28T00:00:00.000Z","grade":"P","score":15},{"date":"2013-08-19T00:00:00.000Z","grade":"B","score":23},{"date":"2013-02-20T00:00:00.000Z","grade":"A","score":3},{"date":"2012-08-22T00:00:00.000Z","grade":"B","score":23},{"date":"2012-01-30T00:00:00.000Z","grade":"C","score":48}],"name":"Reynold'S Bar"},{"_id":"5eb3d668b31de5d588f4299b","grades":[{"date":"2014-07-25T00:00:00.000Z","grade":"A","score":12},{"date":"2014-03-27T00:00:00.000Z","grade":"A","score":13},{"date":"2013-01-14T00:00:00.000Z","grade":"A","score":9},{"date":"2011-12-29T00:00:00.000Z","grade":"A","score":10},{"date":"2011-08-03T00:00:00.000Z","grade":"A","score":13}],"name":"Spain Restaurant & Bar"},{"_id":"5eb3d668b31de5d588f429f3","grades":[{"date":"2014-06-10T00:00:00.000Z","grade":"A","score":12},{"date":"2013-06-17T00:00:00.000Z","grade":"A","score":2},{"date":"2013-01-24T00:00:00.000Z","grade":"A","score":7},{"date":"2012-01-04T00:00:00.000Z","grade":"A","score":9}],"name":"Griffis Faculty Club"},{"_id":"5eb3d668b31de5d588f42a1f","grades":[{"date":"2014-02-04T00:00:00.000Z","grade":"A","score":11},{"date":"2013-04-10T00:00:00.000Z","grade":"A","score":7},{"date":"2012-02-27T00:00:00.000Z","grade":"A","score":10},{"date":"2011-11-02T00:00:00.000Z","grade":"A","score":4},{"date":"2011-07-11T00:00:00.000Z","grade":"A","score":9},{"date":"2011-03-07T00:00:00.000Z","grade":"C","score":39}],"name":"La Mangeoire"},{"_id":"5eb3d668b31de5d588f42a9e","grades":[{"date":"2014-05-28T00:00:00.000Z","grade":"A","score":7},{"date":"2013-05-13T00:00:00.000Z","grade":"A","score":10},{"date":"2012-03-20T00:00:00.000Z","grade":"A","score":11}],"name":"Bar 515"},{"_id":"5eb3d668b31de5d588f42aa8","grades":[{"date":"2015-01-15T00:00:00.000Z","grade":"Z","score":19},{"date":"2014-07-31T00:00:00.000Z","grade":"A","score":10},{"date":"2013-06-10T00:00:00.000Z","grade":"A","score":12},{"date":"2012-06-21T00:00:00.000Z","grade":"A","score":13}],"name":"Keens Steakhouse"},{"_id":"5eb3d668b31de5d588f42ac5","grades":[{"date":"2014-07-08T00:00:00.000Z","grade":"A","score":13},{"date":"2014-02-03T00:00:00.000Z","grade":"A","score":9},{"date":"2013-01-10T00:00:00.000Z","grade":"A","score":9},{"date":"2012-01-19T00:00:00.000Z","grade":"A","score":10},{"date":"2011-10-06T00:00:00.000Z","grade":"A","score":11}],"name":"Cozy Soup & Burger"},{"_id":"5eb3d668b31de5d588f42ac7","grades":[{"date":"2014-10-28T00:00:00.000Z","grade":"A","score":10},{"date":"2014-07-09T00:00:00.000Z","grade":"B","score":24},{"date":"2014-01-17T00:00:00.000Z","grade":"A","score":11},{"date":"2013-05-28T00:00:00.000Z","grade":"A","score":9},{"date":"2012-03-27T00:00:00.000Z","grade":"A","score":13},{"date":"2011-11-02T00:00:00.000Z","grade":"C","score":28}],"name":"Agra Restaurant"},{"_id":"5eb3d668b31de5d588f42a30","grades":[{"date":"2015-01-07T00:00:00.000Z","grade":"A","score":11},{"date":"2014-06-26T00:00:00.000Z","grade":"A","score":13},{"date":"2014-01-09T00:00:00.000Z","grade":"A","score":6},{"date":"2013-04-02T00:00:00.000Z","grade":"B","score":14},{"date":"2012-05-14T00:00:00.000Z","grade":"B","score":19}],"name":"Knickerbocker Bar & Grill"},{"_id":"5eb3d668b31de5d588f42a6e","grades":[{"date":"2015-01-15T00:00:00.000Z","grade":"A","score":0},{"date":"2014-06-18T00:00:00.000Z","grade":"A","score":9},{"date":"2013-04-25T00:00:00.000Z","grade":"A","score":10},{"date":"2012-11-15T00:00:00.000Z","grade":"A","score":12}],"name":"West Bank Cafe"}],"executionTimeMs":5156,"queryOperators":["$match","$expr","$gte","$size","$addFields","$slice","$and","$gt","$arrayElemAt","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the top 10 restaurants that have improved their health inspection scores the most, comparing their first recorded grade to their most recent one","dbQuery":"db.restaurants.aggregate([\n  // Only include restaurants with at least 2 grades\n  {\n    $match: {\n      $expr: { $gte: [{ $size: \"$grades\" }, 2] }\n    }\n  },\n  // Add fields for first and latest grades\n  {\n    $addFields: {\n      firstGrade: { $last: \"$grades\" },  // Last element is the earliest date\n      latestGrade: { $first: \"$grades\" }  // First element is the most recent date\n    }\n  },\n  // Calculate score improvement\n  {\n    $addFields: {\n      scoreImprovement: {\n        $subtract: [\"$firstGrade.score\", \"$latestGrade.score\"]\n      }\n    }\n  },\n  // Sort by score improvement (highest improvement first)\n  {\n    $sort: { scoreImprovement: -1 }\n  },\n  // Limit to top 10\n  {\n    $limit: 10\n  },\n  // Project the required fields\n  {\n    $project: {\n      name: 1,\n      firstGrade: {\n        date: \"$firstGrade.date\",\n        grade: \"$firstGrade.grade\",\n        score: \"$firstGrade.score\"\n      },\n      latestGrade: {\n        date: \"$latestGrade.date\",\n        grade: \"$latestGrade.grade\",\n        score: \"$latestGrade.score\"\n      },\n      scoreImprovement: 1,\n      _id: 0\n    }\n  }\n])","language":"mongosh","result":[{"name":"Baluchi'S Indian Food","firstGrade":{"date":"2011-12-23T00:00:00.000Z","grade":"C","score":98},"latestGrade":{"date":"2014-09-25T00:00:00.000Z","grade":"A","score":7},"scoreImprovement":91},{"name":"La Potencia Restaurant","firstGrade":{"date":"2014-10-07T00:00:00.000Z","grade":"C","score":82},"latestGrade":{"date":"2015-01-06T00:00:00.000Z","grade":"A","score":10},"scoreImprovement":72},{"name":"B.B. Kings","firstGrade":{"date":"2011-11-21T00:00:00.000Z","grade":"C","score":80},"latestGrade":{"date":"2014-10-31T00:00:00.000Z","grade":"A","score":9},"scoreImprovement":71},{"name":"Fortunato Bros Cafe & Bakery","firstGrade":{"date":"2011-05-03T00:00:00.000Z","grade":"C","score":77},"latestGrade":{"date":"2014-03-19T00:00:00.000Z","grade":"A","score":10},"scoreImprovement":67},{"name":"La Trattoria","firstGrade":{"date":"2011-09-02T00:00:00.000Z","grade":"C","score":79},"latestGrade":{"date":"2014-07-15T00:00:00.000Z","grade":"A","score":12},"scoreImprovement":67},{"name":"Brothers Fish Market","firstGrade":{"date":"2012-03-14T00:00:00.000Z","grade":"C","score":77},"latestGrade":{"date":"2014-09-18T00:00:00.000Z","grade":"Z","score":11},"scoreImprovement":66},{"name":"El Molino Rojo Restaurant","firstGrade":{"date":"2011-04-25T00:00:00.000Z","grade":"C","score":76},"latestGrade":{"date":"2014-04-10T00:00:00.000Z","grade":"A","score":10},"scoreImprovement":66},{"name":"Anella","firstGrade":{"date":"2012-01-12T00:00:00.000Z","grade":"C","score":81},"latestGrade":{"date":"2014-12-11T00:00:00.000Z","grade":"Z","score":18},"scoreImprovement":63},{"name":"Live Bait Bar & Restaurant","firstGrade":{"date":"2012-06-15T00:00:00.000Z","grade":"C","score":71},"latestGrade":{"date":"2014-10-28T00:00:00.000Z","grade":"A","score":9},"scoreImprovement":62},{"name":"Victoria Pizza","firstGrade":{"date":"2012-05-21T00:00:00.000Z","grade":"C","score":68},"latestGrade":{"date":"2014-11-26T00:00:00.000Z","grade":"A","score":12},"scoreImprovement":56}],"executionTimeMs":6965,"queryOperators":["$match","$expr","$gte","$size","$addFields","$last","$first","$subtract","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Find 12 restaurants that have had the most grade changes between A, B, and C ratings, showing how many times their grade letter changed","dbQuery":"db.restaurants.aggregate([\n  // Filter out restaurants with less than 2 grades\n  {\n    $match: {\n      \"grades.1\": { $exists: true }\n    }\n  },\n  // Add fields for analysis\n  {\n    $addFields: {\n      // Extract just the grade letters in chronological order\n      gradeLetters: {\n        $map: {\n          input: { $reverseArray: \"$grades\" },\n          as: \"grade\",\n          in: \"$$grade.grade\"\n        }\n      }\n    }\n  },\n  // Calculate grade changes\n  {\n    $addFields: {\n      gradeChanges: {\n        $reduce: {\n          input: { $range: [1, { $size: \"$gradeLetters\" }] },\n          initialValue: 0,\n          in: {\n            $add: [\n              \"$$value\",\n              {\n                $cond: [\n                  {\n                    $ne: [\n                      { $arrayElemAt: [\"$gradeLetters\", { $subtract: [\"$$this\", 1] }] },\n                      { $arrayElemAt: [\"$gradeLetters\", \"$$this\"] }\n                    ]\n                  },\n                  1,\n                  0\n                ]\n              }\n            ]\n          }\n        }\n      }\n    }\n  },\n  // Filter to only include restaurants with at least one grade change\n  {\n    $match: {\n      gradeChanges: { $gt: 0 }\n    }\n  },\n  // Sort by most grade changes\n  {\n    $sort: { gradeChanges: -1 }\n  },\n  // Limit to top 12\n  {\n    $limit: 12\n  },\n  // Project final output\n  {\n    $project: {\n      name: 1,\n      borough: 1,\n      gradeChanges: 1,\n      gradeHistory: \"$gradeLetters\"\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f45859","borough":"Manhattan","name":"Breeze Thai-French Kitchen","gradeChanges":8,"gradeHistory":["B","A","P","A","B","A","P","B","A"]},{"_id":"5eb3d668b31de5d588f44e2a","borough":"Queens","name":"El Pollo Inka Peru Ii","gradeChanges":7,"gradeHistory":["B","A","P","A","B","P","B","Z"]},{"_id":"5eb3d669b31de5d588f45195","borough":"Brooklyn","name":"Silver Krust West Indian Restaurant","gradeChanges":7,"gradeHistory":["A","C","A","P","B","A","A","C","A"]},{"_id":"5eb3d668b31de5d588f4488d","borough":"Manhattan","name":"Nomado 33","gradeChanges":7,"gradeHistory":["B","C","B","P","B","P","B","A","A"]},{"_id":"5eb3d669b31de5d588f452c7","borough":"Brooklyn","name":"El Rey Iii","gradeChanges":7,"gradeHistory":["C","A","B","P","B","A","B","A"]},{"_id":"5eb3d668b31de5d588f43a8b","borough":"Manhattan","name":"Cozy Corner","gradeChanges":7,"gradeHistory":["A","B","A","P","B","A","B","A"]},{"_id":"5eb3d668b31de5d588f44cf6","borough":"Manhattan","name":"Happy Garden Palace","gradeChanges":7,"gradeHistory":["A","B","A","P","A","B","A","B"]},{"_id":"5eb3d669b31de5d588f461a5","borough":"Manhattan","name":"China House Chinese Restaurant","gradeChanges":7,"gradeHistory":["A","P","B","P","A","P","B","A"]},{"_id":"5eb3d669b31de5d588f4649e","borough":"Manhattan","name":"Amazing 66 Restaurant","gradeChanges":7,"gradeHistory":["A","P","B","C","P","C","B","A"]},{"_id":"5eb3d668b31de5d588f441ef","borough":"Manhattan","name":"Benton","gradeChanges":7,"gradeHistory":["B","B","P","A","C","P","A","B","A"]},{"_id":"5eb3d668b31de5d588f42d78","borough":"Manhattan","name":"World Cup Cafe","gradeChanges":7,"gradeHistory":["A","C","B","P","A","B","C","B"]},{"_id":"5eb3d668b31de5d588f4374e","borough":"Queens","name":"Don Alex Restaurant","gradeChanges":6,"gradeHistory":["C","B","P","A","P","A","B","B"]}],"executionTimeMs":5415,"queryOperators":["$match","$exists","$addFields","$map","$reverseArray","$reduce","$range","$size","$add","$cond","$ne","$arrayElemAt","$subtract","$gt","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Show me 20 restaurants that improved from a C or B grade to an A grade in their most recent inspection compared to the previous one","dbQuery":"db.restaurants.aggregate([\n  // First, filter restaurants that have at least 2 grades\n  {\n    $match: {\n      grades: { $exists: true },\n      $expr: { $gte: [{ $size: \"$grades\" }, 2] }\n    }\n  },\n  // Add fields for the two most recent grades\n  {\n    $addFields: {\n      // Sort grades by date descending to ensure most recent first\n      sortedGrades: {\n        $sortArray: {\n          input: \"$grades\",\n          sortBy: { date: -1 }\n        }\n      }\n    }\n  },\n  {\n    $addFields: {\n      mostRecentGrade: { $arrayElemAt: [\"$sortedGrades\", 0] },\n      previousGrade: { $arrayElemAt: [\"$sortedGrades\", 1] }\n    }\n  },\n  // Filter for restaurants where most recent is A and previous was B or C\n  {\n    $match: {\n      \"mostRecentGrade.grade\": \"A\",\n      \"previousGrade.grade\": { $in: [\"B\", \"C\"] }\n    }\n  },\n  // Project the required fields\n  {\n    $project: {\n      name: 1,\n      cuisine: 1,\n      previousGrade: {\n        date: \"$previousGrade.date\",\n        grade: \"$previousGrade.grade\",\n        score: \"$previousGrade.score\"\n      },\n      currentGrade: {\n        date: \"$mostRecentGrade.date\",\n        grade: \"$mostRecentGrade.grade\",\n        score: \"$mostRecentGrade.score\"\n      }\n    }\n  },\n  // Limit to 20 results\n  {\n    $limit: 20\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f4292d","cuisine":"Hamburgers","name":"Wendy'S","previousGrade":{"date":"2014-07-01T00:00:00.000Z","grade":"B","score":23},"currentGrade":{"date":"2014-12-30T00:00:00.000Z","grade":"A","score":8}},{"_id":"5eb3d668b31de5d588f4297e","cuisine":"American","name":"The New Starling Athletic Club Of The Bronx","previousGrade":{"date":"2014-05-01T00:00:00.000Z","grade":"B","score":17},"currentGrade":{"date":"2014-12-18T00:00:00.000Z","grade":"A","score":7}},{"_id":"5eb3d668b31de5d588f42991","cuisine":"American","name":"Palace Cafe","previousGrade":{"date":"2014-05-09T00:00:00.000Z","grade":"B","score":19},"currentGrade":{"date":"2014-11-19T00:00:00.000Z","grade":"A","score":5}},{"_id":"5eb3d668b31de5d588f429ef","cuisine":"Soul Food","name":"Mitchell'S Restaurant","previousGrade":{"date":"2014-03-27T00:00:00.000Z","grade":"C","score":2},"currentGrade":{"date":"2014-08-28T00:00:00.000Z","grade":"A","score":9}},{"_id":"5eb3d668b31de5d588f429fb","cuisine":"Pizza/Italian","name":"Lb Spumoni Gardens","previousGrade":{"date":"2013-11-21T00:00:00.000Z","grade":"B","score":17},"currentGrade":{"date":"2014-07-16T00:00:00.000Z","grade":"A","score":7}},{"_id":"5eb3d668b31de5d588f42a41","cuisine":"American","name":"Viand Cafe","previousGrade":{"date":"2013-10-21T00:00:00.000Z","grade":"B","score":15},"currentGrade":{"date":"2014-05-02T00:00:00.000Z","grade":"A","score":10}},{"_id":"5eb3d668b31de5d588f42a52","cuisine":"Hamburgers","name":"Burger King","previousGrade":{"date":"2013-09-10T00:00:00.000Z","grade":"B","score":27},"currentGrade":{"date":"2014-03-12T00:00:00.000Z","grade":"A","score":10}},{"_id":"5eb3d668b31de5d588f42956","cuisine":"Pizza","name":"Domino'S Pizza","previousGrade":{"date":"2014-05-05T00:00:00.000Z","grade":"B","score":18},"currentGrade":{"date":"2014-12-08T00:00:00.000Z","grade":"A","score":13}},{"_id":"5eb3d668b31de5d588f42997","cuisine":"Pizza/Italian","name":"Joe & Pat'S Pizzeria","previousGrade":{"date":"2014-01-13T00:00:00.000Z","grade":"B","score":14},"currentGrade":{"date":"2014-11-20T00:00:00.000Z","grade":"A","score":5}},{"_id":"5eb3d668b31de5d588f429bb","cuisine":"Irish","name":"Mcdwyers Pub","previousGrade":{"date":"2014-03-26T00:00:00.000Z","grade":"B","score":23},"currentGrade":{"date":"2014-08-26T00:00:00.000Z","grade":"A","score":10}},{"_id":"5eb3d668b31de5d588f429d9","cuisine":"American","name":"New Floridian Diner","previousGrade":{"date":"2013-07-01T00:00:00.000Z","grade":"B","score":15},"currentGrade":{"date":"2014-02-20T00:00:00.000Z","grade":"A","score":10}},{"_id":"5eb3d668b31de5d588f42a20","cuisine":"Pizza/Italian","name":"Valentino'S Pizza","previousGrade":{"date":"2014-05-13T00:00:00.000Z","grade":"B","score":19},"currentGrade":{"date":"2014-09-24T00:00:00.000Z","grade":"A","score":7}},{"_id":"5eb3d668b31de5d588f42a2b","cuisine":"American","name":"Reif'S Tavern","previousGrade":{"date":"2013-12-17T00:00:00.000Z","grade":"B","score":17},"currentGrade":{"date":"2014-06-15T00:00:00.000Z","grade":"A","score":13}},{"_id":"5eb3d668b31de5d588f42a77","cuisine":"American","name":"Sizzler","previousGrade":{"date":"2014-04-21T00:00:00.000Z","grade":"B","score":26},"currentGrade":{"date":"2015-01-02T00:00:00.000Z","grade":"A","score":11}},{"_id":"5eb3d668b31de5d588f42a92","cuisine":"American","name":"Murals On 54/Randolphs'S","previousGrade":{"date":"2014-03-28T00:00:00.000Z","grade":"C","score":131},"currentGrade":{"date":"2014-08-22T00:00:00.000Z","grade":"A","score":11}},{"_id":"5eb3d668b31de5d588f42a9d","cuisine":"Hamburgers","name":"Mcdonald'S","previousGrade":{"date":"2014-08-12T00:00:00.000Z","grade":"B","score":17},"currentGrade":{"date":"2015-01-14T00:00:00.000Z","grade":"A","score":7}},{"_id":"5eb3d668b31de5d588f42aaf","cuisine":"Japanese","name":"Omen Japanese Cuisine","previousGrade":{"date":"2013-12-11T00:00:00.000Z","grade":"B","score":16},"currentGrade":{"date":"2014-07-01T00:00:00.000Z","grade":"A","score":12}},{"_id":"5eb3d668b31de5d588f42ab6","cuisine":"Pizza","name":"Victoria Pizza","previousGrade":{"date":"2014-04-09T00:00:00.000Z","grade":"B","score":24},"currentGrade":{"date":"2014-11-26T00:00:00.000Z","grade":"A","score":12}},{"_id":"5eb3d668b31de5d588f42ac7","cuisine":"Indian","name":"Agra Restaurant","previousGrade":{"date":"2014-07-09T00:00:00.000Z","grade":"B","score":24},"currentGrade":{"date":"2014-10-28T00:00:00.000Z","grade":"A","score":10}},{"_id":"5eb3d668b31de5d588f42ad8","cuisine":"French","name":"Chez Jaqueline","previousGrade":{"date":"2013-09-04T00:00:00.000Z","grade":"B","score":20},"currentGrade":{"date":"2014-05-07T00:00:00.000Z","grade":"A","score":13}}],"executionTimeMs":6326,"queryOperators":["$match","$exists","$expr","$gte","$size","$addFields","$sortArray","$arrayElemAt","$in","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Count how many restaurants are within 250 meters, 500 meters, and 1000 meters of the Times Square subway station at [-73.9851, 40.7589]","dbQuery":"db.restaurants.aggregate([\n  {\n    $geoNear: {\n      near: {\n        type: \"Point\",\n        coordinates: [-73.9851, 40.7589]\n      },\n      distanceField: \"distance\",\n      maxDistance: 1000,\n      spherical: true\n    }\n  },\n  {\n    $bucket: {\n      groupBy: \"$distance\",\n      boundaries: [0, 250, 500, 1000],\n      default: \"other\",\n      output: {\n        count: { $sum: 1 }\n      }\n    }\n  },\n  {\n    $project: {\n      distance: \"$_id\",\n      count: 1,\n      _id: 0\n    }\n  },\n  {\n    $sort: { distance: 1 }\n  }\n])","language":"mongosh","result":[{"count":152,"distance":0},{"count":409,"distance":250},{"count":1208,"distance":500}],"executionTimeMs":1695,"queryOperators":["$geoNear","$bucket","$sum","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find the 5 nearest Chinese restaurants to coordinates [-73.935242, 40.730610] that got an A on their latest health inspection","dbQuery":"db.restaurants.aggregate([\n  {\n    $geoNear: {\n      near: {\n        type: \"Point\",\n        coordinates: [-73.935242, 40.730610]\n      },\n      distanceField: \"distance\",\n      spherical: true,\n      query: {\n        cuisine: \"Chinese\",\n        \"grades.0.grade\": \"A\"\n      }\n    }\n  },\n  {\n    $limit: 5\n  },\n  {\n    $project: {\n      name: 1,\n      cuisine: 1,\n      latestGrade: { $arrayElemAt: [\"$grades.grade\", 0] },\n      distance: 1,\n      address: {\n        street: \"$address.street\",\n        building: \"$address.building\"\n      }\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f472c7","address":{"street":"Nassau Avenue","building":"237"},"cuisine":"Chinese","name":"Peking Express","distance":823.2818985732166,"latestGrade":"A"},{"_id":"5eb3d668b31de5d588f44e6a","address":{"street":"48 Avenue","building":"39-49"},"cuisine":"Chinese","name":"Ten Full","distance":1345.6641368141288,"latestGrade":"A"},{"_id":"5eb3d669b31de5d588f46c2e","address":{"street":"Woodpoint Road","building":"100"},"cuisine":"Chinese","name":"Ho May Kitchen","distance":1418.3694395871298,"latestGrade":"A"},{"_id":"5eb3d669b31de5d588f45299","address":{"street":"48 Avenue","building":"4516"},"cuisine":"Chinese","name":"Good Luck Chinese Restaurant","distance":1424.4911635384265,"latestGrade":"A"},{"_id":"5eb3d668b31de5d588f44f82","address":{"street":"47 Avenue","building":"3920"},"cuisine":"Chinese","name":"China Garden","distance":1466.870835182819,"latestGrade":"A"}],"executionTimeMs":2363,"queryOperators":["$geoNear","$limit","$project","$arrayElemAt"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"What Latin restaurants are within a half mile walk from location [-73.989308, 40.757977] in Manhattan?","dbQuery":"db.restaurants.aggregate([\n  {\n    $geoNear: {\n      near: {\n        type: \"Point\",\n        coordinates: [-73.989308, 40.757977]\n      },\n      distanceField: \"distance\",\n      maxDistance: 804.672, // 0.5 miles in meters\n      spherical: true,\n      query: {\n        borough: \"Manhattan\",\n        cuisine: { $regex: \"Latin\", $options: \"i\" }\n      }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      cuisine: 1,\n      borough: 1,\n      distance: 1\n    }\n  }\n])","language":"mongosh","result":[{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Copacabana","distance":74.63179410844572},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Chimichurri Grill","distance":295.5793600164533},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Cafe Mofongo","distance":367.7728412302312},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Baja Fresh","distance":385.19485334026996},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Havana Central","distance":442.7758808390224},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Margon Restaurant","distance":450.8579973163027},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Acuario Cafe","distance":495.27538119145333},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Lali'S Restaurant","distance":534.0649819370478},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"El Rincon Del Sabor","distance":652.875845384604},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Cafe Nunez","distance":686.1059615323435},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Victor'S Cafe","distance":702.3466767354871},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Empanada Mama","distance":716.4275316870917},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Sophie'S Cuban Cuisine","distance":773.8530069693912},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Calle Dao","distance":777.1060526957809},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"El Azteca Mexican Restaurant","distance":790.5870592691274},{"borough":"Manhattan","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Zoralie Restaurant Inc.","distance":793.8792829664625}],"executionTimeMs":2098,"queryOperators":["$geoNear","$regex","$options","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Give me the 10 American restaurants with the best health scores within 0.8 miles of coordinates [-73.981426, 40.763873]","dbQuery":"db.restaurants.aggregate([\n  {\n    $geoNear: {\n      near: {\n        type: \"Point\",\n        coordinates: [-73.981426, 40.763873]\n      },\n      distanceField: \"distanceInMeters\",\n      maxDistance: 1287.475, // 0.8 miles in meters\n      spherical: true\n    }\n  },\n  {\n    $match: {\n      cuisine: \"American\"\n    }\n  },\n  {\n    $addFields: {\n      bestScore: {\n        $min: \"$grades.score\"\n      }\n    }\n  },\n  {\n    $match: {\n      bestScore: { $exists: true, $ne: null }\n    }\n  },\n  {\n    $sort: {\n      bestScore: 1 // Lower scores are better\n    }\n  },\n  {\n    $limit: 10\n  },\n  {\n    $project: {\n      name: 1,\n      bestScore: 1,\n      address: {\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      distanceInMiles: {\n        $divide: [\"$distanceInMeters\", 1609.344]\n      }\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f4592e","address":{"street":"West   52 Street","zipcode":"10019"},"name":"August Wilson Theatre","bestScore":0,"distanceInMiles":0.1542781502470639},{"_id":"5eb3d669b31de5d588f4777f","address":{"street":"West 52 Street","zipcode":"10019"},"name":"Niva Novotel Gift Shop","bestScore":0,"distanceInMiles":0.14872855258645448},{"_id":"5eb3d668b31de5d588f43512","address":{"street":"Broadway","zipcode":"10019"},"name":"Circle In The Square Theatre","bestScore":0,"distanceInMiles":0.20631839055638787},{"_id":"5eb3d669b31de5d588f4744c","address":{"street":"7Th Avenue","zipcode":"10019"},"name":"Stagecoach Tavern","bestScore":0,"distanceInMiles":0.03340602379210401},{"_id":"5eb3d668b31de5d588f42e30","address":{"street":"7 Avenue","zipcode":"10106"},"name":"Brooklyn Diner","bestScore":0,"distanceInMiles":0.09446299245644703},{"_id":"5eb3d668b31de5d588f43e7a","address":{"street":"West   58 Street","zipcode":"10019"},"name":"Red 58","bestScore":0,"distanceInMiles":0.183282716738017},{"_id":"5eb3d668b31de5d588f441c5","address":{"street":"West   57 Street","zipcode":"10019"},"name":"Cafe 57","bestScore":0,"distanceInMiles":0.22205943999724706},{"_id":"5eb3d668b31de5d588f42eca","address":{"street":"West   51 Street","zipcode":"10019"},"name":"Gershwin Theatre","bestScore":0,"distanceInMiles":0.20862720097036236},{"_id":"5eb3d669b31de5d588f46062","address":{"street":"7 Avenue","zipcode":"10019"},"name":"Sidley Austin Cafeteria","bestScore":0,"distanceInMiles":0.14312635871839963},{"_id":"5eb3d668b31de5d588f44b3a","address":{"street":"Broadway","zipcode":"10019"},"name":"Starbucks Coffee,Limited Brands Cafe","bestScore":0,"distanceInMiles":0.08434917955046325}],"executionTimeMs":2150,"queryOperators":["$geoNear","$match","$addFields","$min","$exists","$ne","$sort","$limit","$project","$divide"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"For the subway stations at Union Square [-73.9897, 40.7359], 14th St [-73.9969, 40.7381], and Astor Place [-73.9917, 40.7304], calculate the number of restaurants within 300 meters of each station and the overlap between their coverage areas","dbQuery":"db.restaurants.aggregate([\n  // First, find all restaurants within 300m of any of the three stations\n  {\n    $geoNear: {\n      near: { type: \"Point\", coordinates: [-73.9897, 40.7359] }, // Union Square as reference\n      distanceField: \"distFromUnion\",\n      maxDistance: 300,\n      spherical: true\n    }\n  },\n  // Add distance calculations for other stations\n  {\n    $addFields: {\n      distFrom14th: {\n        $sqrt: {\n          $add: [\n            { $pow: [{ $multiply: [{ $subtract: [{ $arrayElemAt: [\"$address.coord\", 0] }, -73.9969] }, 111320] }, 2] },\n            { $pow: [{ $multiply: [{ $subtract: [{ $arrayElemAt: [\"$address.coord\", 1] }, 40.7381] }, 110540] }, 2] }\n          ]\n        }\n      },\n      distFromAstor: {\n        $sqrt: {\n          $add: [\n            { $pow: [{ $multiply: [{ $subtract: [{ $arrayElemAt: [\"$address.coord\", 0] }, -73.9917] }, 111320] }, 2] },\n            { $pow: [{ $multiply: [{ $subtract: [{ $arrayElemAt: [\"$address.coord\", 1] }, 40.7304] }, 110540] }, 2] }\n          ]\n        }\n      }\n    }\n  },\n  // Filter to include restaurants within 300m of at least one station\n  {\n    $match: {\n      $or: [\n        { distFromUnion: { $lte: 300 } },\n        { distFrom14th: { $lte: 300 } },\n        { distFromAstor: { $lte: 300 } }\n      ]\n    }\n  },\n  // Mark which stations each restaurant is near\n  {\n    $addFields: {\n      nearUnion: { $lte: [\"$distFromUnion\", 300] },\n      near14th: { $lte: [\"$distFrom14th\", 300] },\n      nearAstor: { $lte: [\"$distFromAstor\", 300] },\n      stationCount: {\n        $add: [\n          { $cond: [{ $lte: [\"$distFromUnion\", 300] }, 1, 0] },\n          { $cond: [{ $lte: [\"$distFrom14th\", 300] }, 1, 0] },\n          { $cond: [{ $lte: [\"$distFromAstor\", 300] }, 1, 0] }\n        ]\n      }\n    }\n  },\n  // Group to calculate totals\n  {\n    $group: {\n      _id: null,\n      totalRestaurants: { $sum: 1 },\n      nearUnionCount: { $sum: { $cond: [\"$nearUnion\", 1, 0] } },\n      near14thCount: { $sum: { $cond: [\"$near14th\", 1, 0] } },\n      nearAstorCount: { $sum: { $cond: [\"$nearAstor\", 1, 0] } },\n      sharedByMultiple: { $sum: { $cond: [{ $gt: [\"$stationCount\", 1] }, 1, 0] } }\n    }\n  },\n  // Format the output\n  {\n    $project: {\n      _id: 0,\n      results: [\n        {\n          station: \"Union Square\",\n          coordinates: [-73.9897, 40.7359],\n          restaurantCount: \"$nearUnionCount\",\n          sharedRestaurants: \"$sharedByMultiple\"\n        },\n        {\n          station: \"14th St\",\n          coordinates: [-73.9969, 40.7381],\n          restaurantCount: \"$near14thCount\",\n          sharedRestaurants: \"$sharedByMultiple\"\n        },\n        {\n          station: \"Astor Place\",\n          coordinates: [-73.9917, 40.7304],\n          restaurantCount: \"$nearAstorCount\",\n          sharedRestaurants: \"$sharedByMultiple\"\n        }\n      ]\n    }\n  },\n  { $unwind: \"$results\" },\n  { $replaceRoot: { newRoot: \"$results\" } }\n])","language":"mongosh","result":[{"station":"Union Square","coordinates":[-73.9897,40.7359],"restaurantCount":133,"sharedRestaurants":0},{"station":"14th St","coordinates":[-73.9969,40.7381],"restaurantCount":0,"sharedRestaurants":0},{"station":"Astor Place","coordinates":[-73.9917,40.7304],"restaurantCount":0,"sharedRestaurants":0}],"executionTimeMs":2749,"queryOperators":["$geoNear","$addFields","$sqrt","$add","$pow","$multiply","$subtract","$arrayElemAt","$match","$or","$lte","$cond","$group","$sum","$gt","$project","$unwind","$replaceRoot"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the count of restaurants with A, B, and C grades for each borough in NYC, sorted by borough name","dbQuery":"db.restaurants.aggregate([\n  // Unwind the grades array to process each grade individually\n  { $unwind: \"$grades\" },\n  \n  // Filter only for grades A, B, and C\n  { $match: { \"grades.grade\": { $in: [\"A\", \"B\", \"C\"] } } },\n  \n  // Group by borough and grade to get counts\n  { $group: {\n    _id: {\n      borough: \"$borough\",\n      grade: \"$grades.grade\"\n    },\n    count: { $sum: 1 }\n  }},\n  \n  // Reshape data to have one document per borough with grade counts\n  { $group: {\n    _id: \"$_id.borough\",\n    grades: {\n      $push: {\n        grade: \"$_id.grade\",\n        count: \"$count\"\n      }\n    }\n  }},\n  \n  // Project to format the output with separate fields for each grade\n  { $project: {\n    borough: \"$_id\",\n    gradeA: {\n      $ifNull: [\n        { $arrayElemAt: [\n          { $map: {\n            input: { $filter: {\n              input: \"$grades\",\n              as: \"g\",\n              cond: { $eq: [\"$$g.grade\", \"A\"] }\n            }},\n            as: \"grade\",\n            in: \"$$grade.count\"\n          }},\n          0\n        ]},\n        0\n      ]\n    },\n    gradeB: {\n      $ifNull: [\n        { $arrayElemAt: [\n          { $map: {\n            input: { $filter: {\n              input: \"$grades\",\n              as: \"g\",\n              cond: { $eq: [\"$$g.grade\", \"B\"] }\n            }},\n            as: \"grade\",\n            in: \"$$grade.count\"\n          }},\n          0\n        ]},\n        0\n      ]\n    },\n    gradeC: {\n      $ifNull: [\n        { $arrayElemAt: [\n          { $map: {\n            input: { $filter: {\n              input: \"$grades\",\n              as: \"g\",\n              cond: { $eq: [\"$$g.grade\", \"C\"] }\n            }},\n            as: \"grade\",\n            in: \"$$grade.count\"\n          }},\n          0\n        ]},\n        0\n      ]\n    }\n  }},\n  \n  // Sort by borough name alphabetically\n  { $sort: { borough: 1 } }\n])","language":"mongosh","result":[{"_id":"Bronx","borough":"Bronx","gradeA":7022,"gradeB":1112,"gradeC":284},{"_id":"Brooklyn","borough":"Brooklyn","gradeA":17324,"gradeB":3055,"gradeC":811},{"_id":"Manhattan","borough":"Manhattan","gradeA":31175,"gradeB":4985,"gradeC":1306},{"_id":"Missing","borough":"Missing","gradeA":75,"gradeB":2,"gradeC":2},{"_id":"Queens","borough":"Queens","gradeA":16422,"gradeB":3053,"gradeC":660},{"_id":"Staten Island","borough":"Staten Island","gradeA":2638,"gradeB":396,"gradeC":82}],"executionTimeMs":3169,"queryOperators":["$unwind","$match","$in","$group","$sum","$push","$project","$ifNull","$arrayElemAt","$map","$filter","$eq","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find 15 restaurants in Brooklyn that went from an A grade to a C grade in their last two inspections","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Brooklyn\",\n      $expr: {\n        $and: [\n          { $gte: [{ $size: \"$grades\" }, 2] },\n          { $eq: [{ $arrayElemAt: [\"$grades.grade\", 0] }, \"C\"] },\n          { $eq: [{ $arrayElemAt: [\"$grades.grade\", 1] }, \"A\"] }\n        ]\n      }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      address: {\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      previousGrade: { $arrayElemAt: [\"$grades.grade\", 1] },\n      currentGrade: { $arrayElemAt: [\"$grades.grade\", 0] },\n      lastInspectionDate: { $arrayElemAt: [\"$grades.date\", 0] }\n    }\n  },\n  {\n    $limit: 15\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f42e01","address":{"street":"27 Street","zipcode":"11232"},"name":"Quick Stop Restaurant","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-10-22T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f4345a","address":{"street":"48 Street","zipcode":"11219"},"name":"Mesivta Eitz Chaim","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-02-19T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f441c1","address":{"street":"4 Avenue","zipcode":"11220"},"name":"El Yayo Nuevo Restaurant","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-10-08T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f442da","address":{"street":"Avenue K","zipcode":"11210"},"name":"Classic Kosher Catering","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-07-23T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f447ce","address":{"street":"North    6 Street","zipcode":"11249"},"name":"This & That","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-11-20T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f44e30","address":{"street":"Flatbush Avenue","zipcode":"11217"},"name":"Fulton Grill","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-10-09T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f4520b","address":{"street":"Grand Street","zipcode":"11211"},"name":"Curry Heaven","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-11-19T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f45455","address":{"street":"5 Avenue","zipcode":"11220"},"name":"Casa Vieja Restaurant","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-09-23T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f4568a","address":{"street":"Church Avenue","zipcode":"11203"},"name":"Ital Fusion","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-11-14T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f45a01","address":{"street":"5 Avenue","zipcode":"11217"},"name":"Sky Ice","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-09-18T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f45a94","address":{"street":"Bedford Avenue","zipcode":"11216"},"name":"Sushi Tatsu","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-10-01T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f46165","address":{"street":"Flatbush Avenue","zipcode":"11210"},"name":"Fritaye Five Star","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2013-10-17T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f463ae","address":{"street":"Mcdonald Avenue","zipcode":"11218"},"name":"Chili Basil Amma Thai","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-07-29T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f46882","address":{"street":"Jamaica Avenue","zipcode":"11207"},"name":"Macorix Restaurant Bar & Grill","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-06-26T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f468cc","address":{"street":"Coney Island Avenue","zipcode":"11230"},"name":"Bahar Masala","previousGrade":"A","currentGrade":"C","lastInspectionDate":"2014-09-19T00:00:00.000Z"}],"executionTimeMs":2411,"queryOperators":["$match","$expr","$and","$gte","$size","$eq","$arrayElemAt","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the 5 cuisine types with the lowest average health inspection scores in the Bronx, including the number of restaurants and average score for each cuisine","dbQuery":"db.restaurants.aggregate([\n  // Filter for restaurants in the Bronx\n  { $match: { borough: \"Bronx\" } },\n  \n  // Unwind the grades array to access individual inspection scores\n  { $unwind: \"$grades\" },\n  \n  // Group by cuisine to calculate average score and count unique restaurants\n  { $group: {\n    _id: \"$cuisine\",\n    averageScore: { $avg: \"$grades.score\" },\n    restaurantIds: { $addToSet: \"$restaurant_id\" }\n  }},\n  \n  // Calculate the actual restaurant count from unique IDs\n  { $project: {\n    cuisine: \"$_id\",\n    averageScore: { $round: [\"$averageScore\", 2] },\n    restaurantCount: { $size: \"$restaurantIds\" }\n  }},\n  \n  // Sort by average score ascending (lowest scores first)\n  { $sort: { averageScore: 1 } },\n  \n  // Limit to 5 cuisine types with lowest scores\n  { $limit: 5 }\n])","language":"mongosh","result":[{"_id":"Armenian","cuisine":"Armenian","averageScore":3.8,"restaurantCount":2},{"_id":"Not Listed/Not Applicable","cuisine":"Not Listed/Not Applicable","averageScore":6.89,"restaurantCount":2},{"_id":"Juice, Smoothies, Fruit Salads","cuisine":"Juice, Smoothies, Fruit Salads","averageScore":7.8,"restaurantCount":35},{"_id":"Donuts","cuisine":"Donuts","averageScore":7.81,"restaurantCount":68},{"_id":"Ice Cream, Gelato, Yogurt, Ices","cuisine":"Ice Cream, Gelato, Yogurt, Ices","averageScore":7.89,"restaurantCount":27}],"executionTimeMs":2153,"queryOperators":["$match","$unwind","$group","$avg","$addToSet","$project","$round","$size","$sort","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"How many restaurants are there in each borough of New York City?","dbQuery":"db.restaurants.aggregate([\n  {\n    $group: {\n      _id: \"$borough\",\n      count: { $sum: 1 }\n    }\n  },\n  {\n    $sort: { count: -1 }\n  }\n])","language":"mongosh","result":[{"_id":"Manhattan","count":10259},{"_id":"Brooklyn","count":6086},{"_id":"Queens","count":5656},{"_id":"Bronx","count":2338},{"_id":"Staten Island","count":969},{"_id":"Missing","count":51}],"executionTimeMs":1500,"queryOperators":["$group","$sum","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Count the number of Chinese restaurants in each NYC borough and sort them from highest to lowest","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      cuisine: \"Chinese\"\n    }\n  },\n  {\n    $group: {\n      _id: \"$borough\",\n      count: { $sum: 1 }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      borough: \"$_id\",\n      count: 1\n    }\n  },\n  {\n    $sort: {\n      count: -1\n    }\n  }\n])","language":"mongosh","result":[{"count":763,"borough":"Brooklyn"},{"count":728,"borough":"Queens"},{"count":510,"borough":"Manhattan"},{"count":323,"borough":"Bronx"},{"count":88,"borough":"Staten Island"},{"count":6,"borough":"Missing"}],"executionTimeMs":1672,"queryOperators":["$match","$group","$sum","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"What is the latest health inspection grade for Pizza Haven in Manhattan?","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      name: \"Pizza Haven\",\n      borough: \"Manhattan\"\n    }\n  },\n  {\n    $unwind: \"$grades\"\n  },\n  {\n    $sort: {\n      \"grades.date\": -1\n    }\n  },\n  {\n    $limit: 1\n  },\n  {\n    $project: {\n      name: 1,\n      latestGrade: \"$grades.grade\",\n      inspectionDate: \"$grades.date\",\n      score: \"$grades.score\"\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f451d5","name":"Pizza Haven","latestGrade":"A","inspectionDate":"2014-12-31T00:00:00.000Z","score":9}],"executionTimeMs":2203,"queryOperators":["$match","$unwind","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Get the current health grade and inspection date for restaurants with IDs '41436770', '41300619', and '41234567'","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      restaurant_id: { $in: ['41436770', '41300619', '41234567'] }\n    }\n  },\n  {\n    $project: {\n      restaurant_id: 1,\n      name: 1,\n      coord: \"$address.coord\",\n      latestGrade: {\n        $cond: {\n          if: { $gt: [{ $size: { $ifNull: [\"$grades\", []] } }, 0] },\n          then: { $arrayElemAt: [\"$grades\", 0] },\n          else: null\n        }\n      }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      restaurant_id: 1,\n      name: 1,\n      latestGrade: { $ifNull: [\"$latestGrade.grade\", null] },\n      latestScore: { $ifNull: [\"$latestGrade.score\", null] },\n      inspectionDate: { $ifNull: [\"$latestGrade.date\", null] },\n      coord: 1\n    }\n  }\n])","language":"mongosh","result":[{"name":"Amanecer Latino Restaurant","restaurant_id":"41300619","coord":[-73.8664015,40.7425916],"latestGrade":"A","latestScore":8,"inspectionDate":"2014-06-11T00:00:00.000Z"},{"name":"Pizza Haven","restaurant_id":"41436770","coord":[-73.920869,40.8676319],"latestGrade":"A","latestScore":9,"inspectionDate":"2014-12-31T00:00:00.000Z"}],"executionTimeMs":4380,"queryOperators":["$match","$in","$project","$cond","$gt","$size","$ifNull","$arrayElemAt"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Show me just the name, cuisine, and borough for 20 restaurants in Manhattan","dbQuery":"db.restaurants.find(\n  { borough: \"Manhattan\" },\n  { name: 1, cuisine: 1, borough: 1, _id: 0 }\n).limit(20)","language":"mongosh","result":[{"borough":"Manhattan","cuisine":"Chicken","name":"Harriet'S Kitchen"},{"borough":"Manhattan","cuisine":"Pizza","name":"Domino'S Pizza"},{"borough":"Manhattan","cuisine":"Italian","name":"Forlinis Restaurant"},{"borough":"Manhattan","cuisine":"American","name":"Keats Restaurant"},{"borough":"Manhattan","cuisine":"French","name":"Le Perigord"},{"borough":"Manhattan","cuisine":"Italian","name":"Il Vagabondo Restaurant"},{"borough":"Manhattan","cuisine":"Irish","name":"Blarney Rock"},{"borough":"Manhattan","cuisine":"American","name":"Desmond'S Tavern"},{"borough":"Manhattan","cuisine":"Chinese","name":"Shun Lee Palace Restaurant"},{"borough":"Manhattan","cuisine":"American","name":"Finnegan'S Wake"},{"borough":"Manhattan","cuisine":"Irish","name":"Twins Pub"},{"borough":"Manhattan","cuisine":"Spanish","name":"Malaga Restaurant"},{"borough":"Manhattan","cuisine":"Italian","name":"Mimis Restaurant & Bar"},{"borough":"Manhattan","cuisine":"American","name":"Capitol Restaurant"},{"borough":"Manhattan","cuisine":"Seafood","name":"Oyster Bar"},{"borough":"Manhattan","cuisine":"American","name":"Maggies Place"},{"borough":"Manhattan","cuisine":"American","name":"Brady'S Bar"},{"borough":"Manhattan","cuisine":"American","name":"Red Flame Diner"},{"borough":"Manhattan","cuisine":"Japanese","name":"Hatsuhana Restaurant"},{"borough":"Manhattan","cuisine":"American","name":"Mudville Saloon"}],"executionTimeMs":5618,"queryOperators":[],"methods":["find","limit"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Find 10 restaurants with the most health inspection grades and show their name, total number of grades, and the size of their grades array","dbQuery":"db.restaurants.aggregate([\n  {\n    $project: {\n      name: 1,\n      gradeCount: { $size: \"$grades\" },\n      gradesArraySize: { $size: \"$grades\" }\n    }\n  },\n  {\n    $sort: { gradeCount: -1 }\n  },\n  {\n    $limit: 10\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f4488d","name":"Nomado 33","gradeCount":9,"gradesArraySize":9},{"_id":"5eb3d668b31de5d588f44658","name":"Lai Lai Gourmet","gradeCount":9,"gradesArraySize":9},{"_id":"5eb3d669b31de5d588f45fab","name":"Pure Food","gradeCount":9,"gradesArraySize":9},{"_id":"5eb3d669b31de5d588f45195","name":"Silver Krust West Indian Restaurant","gradeCount":9,"gradesArraySize":9},{"_id":"5eb3d668b31de5d588f441c2","name":"S'Mac","gradeCount":9,"gradesArraySize":9},{"_id":"5eb3d669b31de5d588f45859","name":"Breeze Thai-French Kitchen","gradeCount":9,"gradesArraySize":9},{"_id":"5eb3d668b31de5d588f44361","name":"Noodle Station","gradeCount":9,"gradesArraySize":9},{"_id":"5eb3d668b31de5d588f441ef","name":"Benton","gradeCount":9,"gradesArraySize":9},{"_id":"5eb3d668b31de5d588f42bc2","name":"Green Pavilion Restaurant & Sports Lounge","gradeCount":8,"gradesArraySize":8},{"_id":"5eb3d668b31de5d588f42d78","name":"World Cup Cafe","gradeCount":8,"gradesArraySize":8}],"executionTimeMs":5450,"queryOperators":["$project","$size","$sort","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Get all details for the restaurant named 'Pizza Haven' including address, grades, and location coordinates","dbQuery":"db.restaurants.find({ name: \"Pizza Haven\" })","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f451d5","address":{"building":"4942","coord":[-73.920869,40.8676319],"street":"Broadway","zipcode":"10034"},"borough":"Manhattan","cuisine":"Pizza","grades":[{"date":"2014-12-31T00:00:00.000Z","grade":"A","score":9},{"date":"2014-05-22T00:00:00.000Z","grade":"B","score":19},{"date":"2013-10-22T00:00:00.000Z","grade":"A","score":11},{"date":"2013-04-04T00:00:00.000Z","grade":"A","score":13},{"date":"2012-08-27T00:00:00.000Z","grade":"B","score":19}],"name":"Pizza Haven","restaurant_id":"41436770"}],"executionTimeMs":5597,"queryOperators":[],"methods":["find"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Which residential neighborhoods in the outer boroughs have no restaurants within a half-mile radius of their center point?","dbQuery":"db.neighborhoods.aggregate([\n  // Step 1: Calculate centroid for each neighborhood\n  {\n    $addFields: {\n      centerPoint: {\n        $cond: {\n          if: { $eq: [\"$geometry.type\", \"Polygon\"] },\n          then: {\n            $let: {\n              vars: {\n                coords: { $arrayElemAt: [\"$geometry.coordinates\", 0] }\n              },\n              in: {\n                $reduce: {\n                  input: \"$$coords\",\n                  initialValue: { sumLng: 0, sumLat: 0, count: 0 },\n                  in: {\n                    sumLng: { $add: [\"$$value.sumLng\", { $arrayElemAt: [\"$$this\", 0] }] },\n                    sumLat: { $add: [\"$$value.sumLat\", { $arrayElemAt: [\"$$this\", 1] }] },\n                    count: { $add: [\"$$value.count\", 1] }\n                  }\n                }\n              }\n            }\n          },\n          else: {\n            // For MultiPolygon, take the first polygon's centroid\n            $let: {\n              vars: {\n                coords: { $arrayElemAt: [{ $arrayElemAt: [\"$geometry.coordinates\", 0] }, 0] }\n              },\n              in: {\n                $reduce: {\n                  input: \"$$coords\",\n                  initialValue: { sumLng: 0, sumLat: 0, count: 0 },\n                  in: {\n                    sumLng: { $add: [\"$$value.sumLng\", { $arrayElemAt: [\"$$this\", 0] }] },\n                    sumLat: { $add: [\"$$value.sumLat\", { $arrayElemAt: [\"$$this\", 1] }] },\n                    count: { $add: [\"$$value.count\", 1] }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  // Step 2: Calculate actual center coordinates\n  {\n    $addFields: {\n      centerCoords: [\n        { $divide: [\"$centerPoint.sumLng\", \"$centerPoint.count\"] },\n        { $divide: [\"$centerPoint.sumLat\", \"$centerPoint.count\"] }\n      ]\n    }\n  },\n  // Step 3: Lookup restaurants near each neighborhood center\n  {\n    $lookup: {\n      from: \"restaurants\",\n      let: { center: \"$centerCoords\" },\n      pipeline: [\n        {\n          $geoNear: {\n            near: { type: \"Point\", coordinates: \"$$center\" },\n            distanceField: \"distance\",\n            maxDistance: 804.672, // 0.5 miles in meters\n            spherical: true\n          }\n        },\n        { $limit: 1 } // We only need to know if any exist\n      ],\n      as: \"nearbyRestaurants\"\n    }\n  },\n  // Step 4: Also get the nearest restaurant regardless of distance\n  {\n    $lookup: {\n      from: \"restaurants\",\n      let: { center: \"$centerCoords\" },\n      pipeline: [\n        {\n          $geoNear: {\n            near: { type: \"Point\", coordinates: \"$$center\" },\n            distanceField: \"distance\",\n            spherical: true\n          }\n        },\n        { $limit: 1 },\n        { $project: { distance: 1, borough: 1 } }\n      ],\n      as: \"nearestRestaurant\"\n    }\n  },\n  // Step 5: Filter for neighborhoods with no restaurants within 0.5 miles\n  {\n    $match: {\n      nearbyRestaurants: { $size: 0 }\n    }\n  },\n  // Step 6: Extract borough from nearest restaurant and filter outer boroughs\n  {\n    $addFields: {\n      borough: { $arrayElemAt: [\"$nearestRestaurant.borough\", 0] },\n      nearestDistance: { $arrayElemAt: [\"$nearestRestaurant.distance\", 0] }\n    }\n  },\n  // Step 7: Filter to only outer boroughs\n  {\n    $match: {\n      borough: { $in: [\"Brooklyn\", \"Queens\", \"The Bronx\", \"Bronx\", \"Staten Island\"] }\n    }\n  },\n  // Step 8: Project final results\n  {\n    $project: {\n      neighborhood: \"$name\",\n      borough: 1,\n      centerPoint: \"$centerCoords\",\n      nearestRestaurantDistance: { $round: [\"$nearestDistance\", 2] }\n    }\n  }\n])","language":"mongosh","result":[{"_id":"55cb9c666c522cafdb053a36","borough":"Bronx","neighborhood":"Rikers Island","centerPoint":[-73.88070468036213,40.79349222647957],"nearestRestaurantDistance":1179.1},{"_id":"55cb9c666c522cafdb053a66","borough":"Bronx","neighborhood":"Mott Haven-Port Morris","centerPoint":[-73.8977334110589,40.79621642156493],"nearestRestaurantDistance":1090.67},{"_id":"55cb9c666c522cafdb053a98","borough":"Brooklyn","neighborhood":"Lindenwood-Howard Beach","centerPoint":[-73.85789769746654,40.651649828833406],"nearestRestaurantDistance":809.17},{"_id":"55cb9c666c522cafdb053a91","borough":"Staten Island","neighborhood":"park-cemetery-etc-Staten Island","centerPoint":[-74.12997238797954,40.540408328574145],"nearestRestaurantDistance":945.76},{"_id":"55cb9c666c522cafdb053a90","borough":"Queens","neighborhood":"College Point","centerPoint":[-73.86831731226415,40.78700497630344],"nearestRestaurantDistance":1056.14},{"_id":"55cb9c666c522cafdb053a9c","borough":"Staten Island","neighborhood":"Mariner's Harbor-Arlington-Port Ivory-Graniteville","centerPoint":[-74.15939948987445,40.64259694662523],"nearestRestaurantDistance":947.37},{"_id":"55cb9c666c522cafdb053abe","borough":"Staten Island","neighborhood":"Annadale-Huguenot-Prince's Bay-Eltingville","centerPoint":[-74.192500054067,40.52080502952488],"nearestRestaurantDistance":857.7},{"_id":"55cb9c666c522cafdb053ac1","borough":"Queens","neighborhood":"Breezy Point-Belle Harbor-Rockaway Park-Broad Channel","centerPoint":[-73.9075533215092,40.56210010569578],"nearestRestaurantDistance":1140.37}],"executionTimeMs":6603,"queryOperators":["$addFields","$cond","$eq","$let","$arrayElemAt","$reduce","$add","$divide","$lookup","$geoNear","$limit","$project","$match","$size","$in","$round"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"List 15 Chinese restaurants in Queens showing only name, address building and street, and most recent inspection score","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Queens\",\n      cuisine: \"Chinese\"\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      building: \"$address.building\",\n      street: \"$address.street\",\n      recentScore: { $arrayElemAt: [\"$grades.score\", 0] }\n    }\n  },\n  {\n    $limit: 15\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f42999","name":"King Yum Restaurant","building":"181-08","street":"Union Turnpike","recentScore":14},{"_id":"5eb3d668b31de5d588f42947","name":"Ho Mei Restaurant","building":"103-05","street":"37 Avenue","recentScore":10},{"_id":"5eb3d668b31de5d588f429c6","name":"Jardin De China Rest","building":"37-37","street":"Junction Boulevard","recentScore":25},{"_id":"5eb3d668b31de5d588f42c44","name":"Peking Restaurant","building":"5811","street":"Woodside Avenue","recentScore":11},{"_id":"5eb3d668b31de5d588f42c6b","name":"Nueva Villa China Restaurant","building":"3910","street":"103 Street","recentScore":47},{"_id":"5eb3d668b31de5d588f42c0a","name":"Baybridge Szechuan Restaurant","building":"20806","street":"08 Crossisland Pw","recentScore":13},{"_id":"5eb3d668b31de5d588f42ffe","name":"Jj Garden Restaurant","building":"75-21","street":"31 Avenue","recentScore":10},{"_id":"5eb3d668b31de5d588f4302e","name":"New Feng'S Garden","building":"88-26","street":"Parsons Boulevard","recentScore":11},{"_id":"5eb3d668b31de5d588f42fee","name":"No.1 Kitchen Chinese Restaurant","building":"3023","street":"30 Avenue","recentScore":11},{"_id":"5eb3d668b31de5d588f43025","name":"Oriental Star Restaurant","building":"112-17","street":"Farmers Boulevard","recentScore":7},{"_id":"5eb3d668b31de5d588f4308c","name":"Empire Wok Kitchen","building":"11407","street":"Beach Channel Drive","recentScore":16},{"_id":"5eb3d668b31de5d588f4316c","name":"Red Bowl Noodle Shop","building":"4052","street":"Main Street","recentScore":20},{"_id":"5eb3d668b31de5d588f431f8","name":"Hunan ''K'' Chinese Restaurant","building":"6014","street":"Queens Boulevard","recentScore":12},{"_id":"5eb3d668b31de5d588f43392","name":"Nuevo Jardin De China Restaurant","building":"3205","street":"Broadway","recentScore":12},{"_id":"5eb3d668b31de5d588f43408","name":"New Kim'S Restaurant","building":"116-06","street":"Rockaway Beach Boulevard","recentScore":22}],"executionTimeMs":5972,"queryOperators":["$match","$project","$arrayElemAt","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"List the top 10 pizza restaurants in Manhattan that are within 1.5 km of Penn Station and have received only A grades in all their inspections since 2013","dbQuery":"db.restaurants.aggregate([\n  // Stage 1: Initial filter for Manhattan Pizza restaurants\n  {\n    $match: {\n      borough: \"Manhattan\",\n      cuisine: \"Pizza\"\n    }\n  },\n  // Stage 2: Geospatial filter - within 1.5km of Penn Station\n  {\n    $match: {\n      \"address.coord\": {\n        $geoWithin: {\n          $centerSphere: [\n            [-73.9910, 40.7510], // Penn Station coordinates [longitude, latitude]\n            1.5 / 6371 // 1.5km converted to radians (Earth radius ~6371km)\n          ]\n        }\n      }\n    }\n  },\n  // Stage 3: Filter for restaurants with only A grades since 2013\n  {\n    $match: {\n      $and: [\n        // Ensure there's at least one grade\n        { \"grades.0\": { $exists: true } },\n        // All grades must be A\n        { \"grades.grade\": { $not: { $ne: \"A\" } } },\n        // No grades before 2013\n        { \"grades.date\": { $not: { $lt: new Date(\"2013-01-01\") } } }\n      ]\n    }\n  },\n  // Stage 4: Add total inspections count\n  {\n    $addFields: {\n      totalInspections: { $size: \"$grades\" }\n    }\n  },\n  // Stage 5: Calculate average score for sorting\n  {\n    $addFields: {\n      avgScore: { $avg: \"$grades.score\" }\n    }\n  },\n  // Stage 6: Sort by average score (lower is better) and then by total inspections\n  {\n    $sort: {\n      avgScore: 1,\n      totalInspections: -1\n    }\n  },\n  // Stage 7: Limit to top 10\n  {\n    $limit: 10\n  },\n  // Stage 8: Project only required fields\n  {\n    $project: {\n      name: 1,\n      address: {\n        building: 1,\n        street: 1,\n        coord: 1\n      },\n      grades: 1,\n      totalInspections: 1\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f485ae","address":{"building":"370","coord":[-73.9882472,40.7638919],"street":"West 51 Street"},"grades":[{"date":"2014-09-30T00:00:00.000Z","grade":"A","score":0}],"name":"B -Side","totalInspections":1},{"_id":"5eb3d669b31de5d588f4820c","address":{"building":"388","coord":[-73.981234,40.741912],"street":"3 Avenue"},"grades":[{"date":"2014-06-10T00:00:00.000Z","grade":"A","score":5}],"name":"Pastafina Pizza","totalInspections":1},{"_id":"5eb3d669b31de5d588f4742a","address":{"building":"166","coord":[-73.9934628,40.746326],"street":"West   27 Street"},"grades":[{"date":"2014-04-03T00:00:00.000Z","grade":"A","score":2},{"date":"2013-11-08T00:00:00.000Z","grade":"A","score":9}],"name":"99 Cents Best & Fresh Pizza Inc.","totalInspections":2},{"_id":"5eb3d669b31de5d588f474ee","address":{"building":"360","coord":[-73.9923187,40.7580242],"street":"West   42 Street"},"grades":[{"date":"2014-05-05T00:00:00.000Z","grade":"A","score":9},{"date":"2013-09-26T00:00:00.000Z","grade":"A","score":2}],"name":"99 Cent Fresh Pizza Villa Cafe","totalInspections":2},{"_id":"5eb3d669b31de5d588f476a2","address":{"building":"127","coord":[-73.9848403,40.73994640000001],"street":"East   23 Street"},"grades":[{"date":"2014-11-26T00:00:00.000Z","grade":"A","score":5},{"date":"2013-10-22T00:00:00.000Z","grade":"A","score":7}],"name":"Frank'S Express Pizza Inc","totalInspections":2},{"_id":"5eb3d669b31de5d588f47556","address":{"building":"473","coord":[-73.97406409999999,40.7537652],"street":"Lexington Avenue"},"grades":[{"date":"2014-08-27T00:00:00.000Z","grade":"A","score":4},{"date":"2013-09-09T00:00:00.000Z","grade":"A","score":10}],"name":"99 Cent Fresh Pizza","totalInspections":2},{"_id":"5eb3d669b31de5d588f471aa","address":{"building":"30","coord":[-73.984663,40.739963],"street":"Lexington Avenue"},"grades":[{"date":"2014-05-22T00:00:00.000Z","grade":"A","score":10},{"date":"2013-06-04T00:00:00.000Z","grade":"A","score":6}],"name":"Solo Pizza To Go","totalInspections":2},{"_id":"5eb3d669b31de5d588f47594","address":{"building":"151","coord":[-73.97427239999999,40.7516937],"street":"East   43 Street"},"grades":[{"date":"2014-09-08T00:00:00.000Z","grade":"A","score":13},{"date":"2013-09-13T00:00:00.000Z","grade":"A","score":5}],"name":"99 Cent Fresh Pizza","totalInspections":2},{"_id":"5eb3d669b31de5d588f47f94","address":{"building":"642","coord":[-73.990832,40.760329],"street":"9 Avenue"},"grades":[{"date":"2014-11-19T00:00:00.000Z","grade":"A","score":10},{"date":"2014-06-06T00:00:00.000Z","grade":"A","score":8}],"name":"I Heart Pizza Ny","totalInspections":2},{"_id":"5eb3d669b31de5d588f47bf2","address":{"building":"268","coord":[-73.9983379,40.74505740000001],"street":"West   23 Street"},"grades":[{"date":"2014-11-25T00:00:00.000Z","grade":"A","score":9},{"date":"2014-03-14T00:00:00.000Z","grade":"A","score":12}],"name":"Pizza 23","totalInspections":2}],"executionTimeMs":2430,"queryOperators":["$match","$geoWithin","$centerSphere","$and","$exists","$not","$ne","$lt","$addFields","$size","$avg","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Calculate the average number of pizza restaurants per square mile in each NYC borough and sort them from highest to lowest density","dbQuery":"db.restaurants.aggregate([\n  // Match only pizza restaurants\n  {\n    $match: {\n      cuisine: \"Pizza\"\n    }\n  },\n  // Group by borough and count\n  {\n    $group: {\n      _id: \"$borough\",\n      pizzaRestaurantCount: { $sum: 1 }\n    }\n  },\n  // Calculate density per square mile using known borough areas\n  {\n    $project: {\n      borough: \"$_id\",\n      pizzaRestaurantCount: 1,\n      pizzaDensityPerSqMile: {\n        $round: [\n          {\n            $switch: {\n              branches: [\n                { case: { $eq: [\"$_id\", \"Manhattan\"] }, then: { $divide: [\"$pizzaRestaurantCount\", 22.83] } },\n                { case: { $eq: [\"$_id\", \"Brooklyn\"] }, then: { $divide: [\"$pizzaRestaurantCount\", 69.5] } },\n                { case: { $eq: [\"$_id\", \"Queens\"] }, then: { $divide: [\"$pizzaRestaurantCount\", 108.1] } },\n                { case: { $eq: [\"$_id\", \"Bronx\"] }, then: { $divide: [\"$pizzaRestaurantCount\", 42.1] } },\n                { case: { $eq: [\"$_id\", \"Staten Island\"] }, then: { $divide: [\"$pizzaRestaurantCount\", 57.5] } }\n              ],\n              default: 0\n            }\n          },\n          2\n        ]\n      },\n      _id: 0\n    }\n  },\n  // Sort by density from highest to lowest\n  {\n    $sort: {\n      pizzaDensityPerSqMile: -1\n    }\n  }\n])","language":"mongosh","result":[{"pizzaRestaurantCount":339,"borough":"Manhattan","pizzaDensityPerSqMile":14.85},{"pizzaRestaurantCount":197,"borough":"Bronx","pizzaDensityPerSqMile":4.68},{"pizzaRestaurantCount":296,"borough":"Brooklyn","pizzaDensityPerSqMile":4.26},{"pizzaRestaurantCount":277,"borough":"Queens","pizzaDensityPerSqMile":2.56},{"pizzaRestaurantCount":53,"borough":"Staten Island","pizzaDensityPerSqMile":0.92},{"pizzaRestaurantCount":1,"borough":"Missing","pizzaDensityPerSqMile":0}],"executionTimeMs":2219,"queryOperators":["$match","$group","$sum","$project","$round","$switch","$eq","$divide","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Count the total number of pizza restaurants in Manhattan versus Queens","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      cuisine: \"Pizza\",\n      borough: { $in: [\"Manhattan\", \"Queens\"] }\n    }\n  },\n  {\n    $group: {\n      _id: \"$borough\",\n      pizzaCount: { $sum: 1 }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      borough: \"$_id\",\n      pizzaCount: 1\n    }\n  },\n  {\n    $sort: {\n      borough: 1\n    }\n  }\n])","language":"mongosh","result":[{"pizzaCount":339,"borough":"Manhattan"},{"pizzaCount":277,"borough":"Queens"}],"executionTimeMs":1409,"queryOperators":["$match","$in","$group","$sum","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Find the 10 closest restaurants to Times Square that have an A grade, and group them by their cuisine type","dbQuery":"db.restaurants.aggregate([\n  {\n    $geoNear: {\n      near: {\n        type: \"Point\",\n        coordinates: [-73.985130, 40.758896] // Times Square coordinates\n      },\n      distanceField: \"distance\",\n      spherical: true,\n      query: {\n        \"grades.grade\": \"A\" // Filter for restaurants with at least one A grade\n      }\n    }\n  },\n  {\n    $limit: 10 // Get only the 10 closest restaurants\n  },\n  {\n    $group: {\n      _id: \"$cuisine\",\n      restaurants: {\n        $push: {\n          name: \"$name\",\n          distance: \"$distance\",\n          address: {\n            $concat: [\n              \"$address.building\",\n              \" \",\n              \"$address.street\",\n              \", \",\n              \"$borough\",\n              \" \",\n              \"$address.zipcode\"\n            ]\n          }\n        }\n      }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      cuisine: \"$_id\",\n      restaurants: 1\n    }\n  },\n  {\n    $sort: {\n      cuisine: 1 // Sort cuisines alphabetically for consistent output\n    }\n  }\n])","language":"mongosh","result":[{"restaurants":[{"name":"Snack Box","distance":0.13964864337374971,"address":"0 Times Square, Manhattan 10036"},{"name":"The Palace Theater","distance":14.787928322200592,"address":"1564 Broadway, Manhattan 10036"},{"name":"Gingers (Double Tree Hotel)","distance":38.956358490710755,"address":"1568 Broadway, Manhattan 10036"},{"name":"W Times Square","distance":72.81830254951772,"address":"1567 Broadway, Manhattan 10036"},{"name":"Cbre-1540","distance":84.1323625280569,"address":"1540 Broadway, Manhattan 10036"},{"name":"Planet Hollywood","distance":84.1323625280569,"address":"1540 Broadway, Manhattan 10036"},{"name":"Lunt Fontanne Theater","distance":86.3058118294098,"address":"205 West 46 Street, Manhattan 10036"}],"cuisine":"American"},{"restaurants":[{"name":"Mcdonald'S","distance":11.939215711756122,"address":"1560 Broadway, Manhattan 10036"}],"cuisine":"Hamburgers"},{"restaurants":[{"name":"Buca Di Beppo","distance":84.1323625280569,"address":"1540 Broadway, Manhattan 10036"}],"cuisine":"Italian"},{"restaurants":[{"name":"Blue Fin","distance":72.81830254951772,"address":"1567 Broadway, Manhattan 10036"}],"cuisine":"Seafood"}],"executionTimeMs":1521,"queryOperators":["$geoNear","$limit","$group","$push","$concat","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the 10 cuisine types with the highest average inspection scores across all boroughs in NYC","dbQuery":"db.restaurants.aggregate([\n  // Unwind the grades array to access individual inspection scores\n  { $unwind: \"$grades\" },\n  \n  // Group by cuisine type and calculate average score\n  { $group: {\n    _id: \"$cuisine\",\n    averageScore: { $avg: \"$grades.score\" }\n  }},\n  \n  // Sort by average score in descending order (highest/worst scores first)\n  { $sort: { averageScore: -1 }},\n  \n  // Limit to top 10 cuisines with highest average scores\n  { $limit: 10 },\n  \n  // Project to match the desired output format\n  { $project: {\n    cuisine: \"$_id\",\n    averageScore: 1,\n    _id: 0\n  }}\n])","language":"mongosh","result":[{"averageScore":17.125,"cuisine":"Iranian"},{"averageScore":15.545454545454545,"cuisine":"Hawaiian"},{"averageScore":14.866666666666667,"cuisine":"Chinese/Japanese"},{"averageScore":14.6,"cuisine":"Polynesian"},{"averageScore":14.344086021505376,"cuisine":"Creole"},{"averageScore":13.830508474576272,"cuisine":"Chinese/Cuban"},{"averageScore":13.797101449275363,"cuisine":"Bangladeshi"},{"averageScore":13.763157894736842,"cuisine":"African"},{"averageScore":13.699115044247788,"cuisine":"Pakistani"},{"averageScore":13.519762845849803,"cuisine":"Korean"}],"executionTimeMs":2135,"queryOperators":["$unwind","$group","$avg","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"For Chinese restaurants, show me the average inspection score and grade distribution by borough, including the total number of restaurants in each borough","dbQuery":"db.restaurants.aggregate([\n  // Stage 1: Filter for Chinese cuisine restaurants only\n  {\n    $match: {\n      cuisine: \"Chinese\"\n    }\n  },\n  // Stage 2: Unwind grades array to analyze individual inspections\n  {\n    $unwind: \"$grades\"\n  },\n  // Stage 3: Group by borough and grade to calculate statistics\n  {\n    $group: {\n      _id: {\n        borough: \"$borough\",\n        grade: \"$grades.grade\"\n      },\n      gradeCount: { $sum: 1 },\n      totalScore: { $sum: \"$grades.score\" },\n      restaurantIds: { $addToSet: \"$restaurant_id\" }\n    }\n  },\n  // Stage 4: Regroup by borough to build grade distribution\n  {\n    $group: {\n      _id: \"$_id.borough\",\n      gradeDistribution: {\n        $push: {\n          grade: \"$_id.grade\",\n          count: \"$gradeCount\"\n        }\n      },\n      totalScores: { $sum: \"$totalScore\" },\n      totalInspections: { $sum: \"$gradeCount\" },\n      allRestaurantIds: { $push: \"$restaurantIds\" }\n    }\n  },\n  // Stage 5: Calculate unique restaurant count and format output\n  {\n    $project: {\n      _id: 0,\n      borough: \"$_id\",\n      averageScore: {\n        $round: [\n          { $divide: [\"$totalScores\", \"$totalInspections\"] },\n          2\n        ]\n      },\n      totalRestaurants: {\n        $size: {\n          $reduce: {\n            input: \"$allRestaurantIds\",\n            initialValue: [],\n            in: { $setUnion: [\"$$value\", \"$$this\"] }\n          }\n        }\n      },\n      gradeDistribution: {\n        $sortArray: {\n          input: \"$gradeDistribution\",\n          sortBy: { grade: 1 }\n        }\n      }\n    }\n  },\n  // Stage 6: Sort results by borough name\n  {\n    $sort: {\n      borough: 1\n    }\n  }\n])","language":"mongosh","result":[{"borough":"Bronx","averageScore":11.04,"totalRestaurants":323,"gradeDistribution":[{"grade":"A","count":1058},{"grade":"B","count":180},{"grade":"C","count":25},{"grade":"Not Yet Graded","count":3},{"grade":"P","count":19},{"grade":"Z","count":11}]},{"borough":"Brooklyn","averageScore":12.36,"totalRestaurants":763,"gradeDistribution":[{"grade":"A","count":2155},{"grade":"B","count":561},{"grade":"C","count":145},{"grade":"Not Yet Graded","count":11},{"grade":"P","count":67},{"grade":"Z","count":42}]},{"borough":"Manhattan","averageScore":14.44,"totalRestaurants":510,"gradeDistribution":[{"grade":"A","count":1262},{"grade":"B","count":515},{"grade":"C","count":152},{"grade":"Not Yet Graded","count":9},{"grade":"P","count":59},{"grade":"Z","count":61}]},{"borough":"Missing","averageScore":9,"totalRestaurants":6,"gradeDistribution":[{"grade":"A","count":8}]},{"borough":"Queens","averageScore":12.86,"totalRestaurants":726,"gradeDistribution":[{"grade":"A","count":1899},{"grade":"B","count":557},{"grade":"C","count":119},{"grade":"Not Yet Graded","count":32},{"grade":"P","count":61},{"grade":"Z","count":51}]},{"borough":"Staten Island","averageScore":12.45,"totalRestaurants":88,"gradeDistribution":[{"grade":"A","count":205},{"grade":"B","count":58},{"grade":"C","count":11},{"grade":"Not Yet Graded","count":4},{"grade":"P","count":6},{"grade":"Z","count":3}]}],"executionTimeMs":2065,"queryOperators":["$match","$unwind","$group","$sum","$addToSet","$push","$project","$round","$divide","$size","$reduce","$setUnion","$sortArray","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Find Latin restaurants in Queens that received a score above 28 in their last inspection","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Queens\",\n      cuisine: { $regex: /Latin/i }\n    }\n  },\n  {\n    $match: {\n      \"grades.0.score\": { $gt: 28 }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      address: {\n        street: \"$address.street\",\n        building: \"$address.building\"\n      },\n      lastInspectionScore: { $arrayElemAt: [\"$grades.score\", 0] },\n      lastInspectionDate: { $arrayElemAt: [\"$grades.date\", 0] }\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f43d1e","address":{"street":"45 Street","building":"45-53"},"name":"Chipichape Colombian Bakery","lastInspectionScore":32,"lastInspectionDate":"2014-11-21T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f440e0","address":{"street":"44 Avenue","building":"102-03A"},"name":"Catacocha Restaurant","lastInspectionScore":29,"lastInspectionDate":"2014-10-01T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f44ff6","address":{"street":"47 Avenue","building":"45-07"},"name":"Parador Caleno","lastInspectionScore":31,"lastInspectionDate":"2014-12-31T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f450c9","address":{"street":"Jamaica Avenue","building":"218-21"},"name":"El Patio","lastInspectionScore":43,"lastInspectionDate":"2014-05-17T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f457cb","address":{"street":"Roosevelt Avenue","building":"80-04"},"name":"El Canelazo Bar Restaurant","lastInspectionScore":30,"lastInspectionDate":"2014-08-19T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f46703","address":{"street":"Roosevelt Avenue","building":"81-20"},"name":"La Gata Golosa/Yogurtberry","lastInspectionScore":46,"lastInspectionDate":"2014-12-24T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f4764e","address":{"street":"Roosevelt Avenue","building":"95-02"},"name":"Chiflez","lastInspectionScore":30,"lastInspectionDate":"2014-09-26T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f47995","address":{"street":"Greenpoint Avenue","building":"46-12"},"name":"El Potrero Sport Bar","lastInspectionScore":49,"lastInspectionDate":"2014-08-20T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f48160","address":{"street":"Seneca Avenue","building":"689"},"name":"Jorge'S Restaurant","lastInspectionScore":30,"lastInspectionDate":"2014-12-17T00:00:00.000Z"}],"executionTimeMs":1441,"queryOperators":["$match","$regex","$gt","$project","$arrayElemAt"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Which Manhattan restaurants have a C grade or score over 28 in their latest inspection? Show me the first 10 with their complete addresses","dbQuery":"db.restaurants.aggregate([\n  // Filter for Manhattan restaurants only\n  {\n    $match: {\n      borough: \"Manhattan\"\n    }\n  },\n  // Add field for latest inspection (first element in grades array)\n  {\n    $addFields: {\n      latestInspection: { $arrayElemAt: [\"$grades\", 0] }\n    }\n  },\n  // Filter for restaurants with C grade or score > 28 in latest inspection\n  {\n    $match: {\n      $and: [\n        { latestInspection: { $exists: true } }, // Ensure grades exist\n        {\n          $or: [\n            { \"latestInspection.grade\": \"C\" },\n            { \"latestInspection.score\": { $gt: 28 } }\n          ]\n        }\n      ]\n    }\n  },\n  // Project the required fields\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      restaurant_id: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      latestGrade: \"$latestInspection.grade\",\n      latestScore: \"$latestInspection.score\",\n      inspectionDate: \"$latestInspection.date\"\n    }\n  },\n  // Limit to first 10 results\n  {\n    $limit: 10\n  }\n])","language":"mongosh","result":[{"address":{"building":"97","street":"Macdougal Street","zipcode":"10012"},"name":"Monte'S","restaurant_id":"40379149","latestGrade":"Z","latestScore":33,"inspectionDate":"2014-11-05T00:00:00.000Z"},{"address":{"building":"910","street":"Seventh Avenue","zipcode":"10019"},"name":"La Parisienne Diner","restaurant_id":"40365633","latestGrade":"Z","latestScore":35,"inspectionDate":"2015-01-08T00:00:00.000Z"},{"address":{"building":"201","street":"West   83 Street","zipcode":"10024"},"name":"Cafe Lalo","restaurant_id":"40387357","latestGrade":"Z","latestScore":50,"inspectionDate":"2014-09-24T00:00:00.000Z"},{"address":{"building":"130","street":"Madison Avenue","zipcode":"10016"},"name":"Bella Napoli","restaurant_id":"40393488","latestGrade":"Z","latestScore":31,"inspectionDate":"2014-12-24T00:00:00.000Z"},{"address":{"building":"256","street":"West   52 Street","zipcode":"10019"},"name":"Russian Samovar","restaurant_id":"40383825","latestGrade":"Z","latestScore":40,"inspectionDate":"2014-12-30T00:00:00.000Z"},{"address":{"building":"532","street":"9 Avenue","zipcode":"10018"},"name":"Holland Bar","restaurant_id":"40388225","latestGrade":"Z","latestScore":47,"inspectionDate":"2014-10-31T00:00:00.000Z"},{"address":{"building":"10","street":"West 4 Street","zipcode":"10012"},"name":"Dojo Restaurant","restaurant_id":"40392685","latestGrade":"Z","latestScore":40,"inspectionDate":"2014-08-14T00:00:00.000Z"},{"address":{"building":"242","street":"Mott Street","zipcode":"10012"},"name":"Cafe Gitane","restaurant_id":"40400039","latestGrade":"Z","latestScore":33,"inspectionDate":"2014-12-09T00:00:00.000Z"},{"address":{"building":"145","street":"West   72 Street","zipcode":"10023"},"name":"Dinastia China","restaurant_id":"40398572","latestGrade":"C","latestScore":31,"inspectionDate":"2014-10-28T00:00:00.000Z"},{"address":{"building":"14","street":"Stuyvesant Street","zipcode":"10003"},"name":"Sharaku Japanese Restaurant","restaurant_id":"40397520","latestGrade":"Z","latestScore":37,"inspectionDate":"2015-01-13T00:00:00.000Z"}],"executionTimeMs":1645,"queryOperators":["$match","$addFields","$arrayElemAt","$and","$exists","$or","$gt","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Give me a breakdown of Manhattan restaurants by number of inspections, specifically showing how many have 0, 1, or 2 inspections","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Manhattan\"\n    }\n  },\n  {\n    $project: {\n      inspectionCount: {\n        $size: { $ifNull: [\"$grades\", []] }\n      }\n    }\n  },\n  {\n    $match: {\n      inspectionCount: { $in: [0, 1, 2] }\n    }\n  },\n  {\n    $group: {\n      _id: \"$inspectionCount\",\n      restaurantCount: { $sum: 1 }\n    }\n  },\n  {\n    $project: {\n      inspectionCount: \"$_id\",\n      restaurantCount: 1,\n      _id: 0\n    }\n  },\n  {\n    $sort: {\n      inspectionCount: 1\n    }\n  }\n])","language":"mongosh","result":[{"restaurantCount":272,"inspectionCount":0},{"restaurantCount":1338,"inspectionCount":1},{"restaurantCount":950,"inspectionCount":2}],"executionTimeMs":1497,"queryOperators":["$match","$project","$size","$ifNull","$in","$group","$sum","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Get the 12 restaurants with the highest inspection scores (above 28) or C grades from their latest inspection, ordered by score descending","dbQuery":"db.restaurants.aggregate([\n  {\n    $addFields: {\n      latestGrade: { $arrayElemAt: [\"$grades\", 0] }\n    }\n  },\n  {\n    $match: {\n      $or: [\n        { \"latestGrade.score\": { $gt: 28 } },\n        { \"latestGrade.grade\": \"C\" }\n      ]\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      restaurant_id: 1,\n      borough: 1,\n      fullAddress: {\n        $concat: [\n          \"$address.building\",\n          \" \",\n          \"$address.street\",\n          \", \",\n          \"$borough\",\n          \", NY \",\n          \"$address.zipcode\"\n        ]\n      },\n      latestScore: \"$latestGrade.score\",\n      latestGrade: \"$latestGrade.grade\",\n      daysSinceInspection: {\n        $floor: {\n          $divide: [\n            { $subtract: [new Date(\"2025-06-29\"), \"$latestGrade.date\"] },\n            1000 * 60 * 60 * 24\n          ]\n        }\n      }\n    }\n  },\n  {\n    $sort: { latestScore: -1 }\n  },\n  {\n    $limit: 12\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f44c00","borough":"Manhattan","name":"Concrete Restaurant","restaurant_id":"41363541","fullAddress":"320 West   37 Street, Manhattan, NY 10018","latestScore":90,"latestGrade":"C","daysSinceInspection":3939},{"_id":"5eb3d668b31de5d588f434f5","borough":"Manhattan","name":"West 79Th Street Boat Basin Cafe","restaurant_id":"40756344","fullAddress":" Hudson River, Manhattan, NY 10282","latestScore":89,"latestGrade":"C","daysSinceInspection":4020},{"_id":"5eb3d669b31de5d588f471f7","borough":"Brooklyn","name":"D & Y Restaurant","restaurant_id":"50000040","fullAddress":"5616 7 Avenue, Brooklyn, NY 11220","latestScore":86,"latestGrade":"C","daysSinceInspection":3870},{"_id":"5eb3d668b31de5d588f43a69","borough":"Manhattan","name":"Bistro Caterers","restaurant_id":"40987023","fullAddress":"466 Lexington Avenue, Manhattan, NY 10017","latestScore":84,"latestGrade":"C","daysSinceInspection":3911},{"_id":"5eb3d669b31de5d588f460be","borough":"Queens","name":"Gal Bi Ma Eul","restaurant_id":"41608854","fullAddress":"194-03 Northern Boulevard, Queens, NY 11358","latestScore":78,"latestGrade":"C","daysSinceInspection":3939},{"_id":"5eb3d669b31de5d588f48751","borough":"Brooklyn","name":"Juice It Health Bar","restaurant_id":"50015959","fullAddress":"1068 Fulton Street, Brooklyn, NY 11238","latestScore":75,"latestGrade":"Not Yet Graded","daysSinceInspection":3813},{"_id":"5eb3d669b31de5d588f46ff8","borough":"Bronx","name":"Zymi Bar & Grill","restaurant_id":"41712791","fullAddress":"726 Astor Avenue, Bronx, NY 10467","latestScore":75,"latestGrade":"C","daysSinceInspection":3946},{"_id":"5eb3d669b31de5d588f4897e","borough":"Bronx","name":"Golden Dragon Cuisine","restaurant_id":"50017374","fullAddress":"2166 Westchester Avenue, Bronx, NY 10462","latestScore":73,"latestGrade":"Not Yet Graded","daysSinceInspection":3813},{"_id":"5eb3d669b31de5d588f46e88","borough":"Brooklyn","name":"Felfla","restaurant_id":"41706169","fullAddress":"6906 3 Avenue, Brooklyn, NY 11209","latestScore":71,"latestGrade":"Z","daysSinceInspection":4000},{"_id":"5eb3d669b31de5d588f46aba","borough":"Queens","name":"Nanking","restaurant_id":"41686535","fullAddress":"134-07 Rockaway Boulevard, Queens, NY 11420","latestScore":69,"latestGrade":"C","daysSinceInspection":3905},{"_id":"5eb3d669b31de5d588f48b4a","borough":"Brooklyn","name":"Chelsea'S Juice Factory","restaurant_id":"50018457","fullAddress":"1305 38Th St, Brooklyn, NY 11218","latestScore":69,"latestGrade":"Not Yet Graded","daysSinceInspection":3813},{"_id":"5eb3d669b31de5d588f4866b","borough":"Bronx","name":"Palombo Pastry Shop","restaurant_id":"50015245","fullAddress":"2400 Arthur Avenue, Bronx, NY 10458","latestScore":69,"latestGrade":"C","daysSinceInspection":3866}],"executionTimeMs":2385,"queryOperators":["$addFields","$arrayElemAt","$match","$or","$gt","$project","$concat","$floor","$divide","$subtract","$sort","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Show me all the inspection grades and dates for 'Amanecer Latino Restaurant' in Queens","dbQuery":"db.restaurants.find(\n  {\n    name: \"Amanecer Latino Restaurant\",\n    borough: \"Queens\"\n  },\n  {\n    name: 1,\n    grades: 1,\n    _id: 0\n  }\n)","language":"mongosh","result":[{"grades":[{"date":"2014-06-11T00:00:00.000Z","grade":"A","score":8},{"date":"2014-01-09T00:00:00.000Z","grade":"C","score":33},{"date":"2013-06-11T00:00:00.000Z","grade":"A","score":12},{"date":"2012-12-31T00:00:00.000Z","grade":"A","score":12},{"date":"2011-11-23T00:00:00.000Z","grade":"A","score":11}],"name":"Amanecer Latino Restaurant"}],"executionTimeMs":2586,"queryOperators":[],"methods":["find"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Find all Chinese restaurants in Manhattan within 500 meters of the coordinates [-73.9851, 40.7589], showing their names, addresses, and most recent inspection grades","dbQuery":"db.restaurants.aggregate([\n  {\n    $geoNear: {\n      near: {\n        type: \"Point\",\n        coordinates: [-73.9851, 40.7589]\n      },\n      distanceField: \"distance\",\n      maxDistance: 500,\n      spherical: true,\n      query: {\n        borough: \"Manhattan\",\n        cuisine: \"Chinese\"\n      }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\"\n      },\n      distance: 1,\n      latestGrade: {\n        $cond: {\n          if: { $gt: [{ $size: \"$grades\" }, 0] },\n          then: { $arrayElemAt: [\"$grades.grade\", 0] },\n          else: null\n        }\n      },\n      latestInspectionDate: {\n        $cond: {\n          if: { $gt: [{ $size: \"$grades\" }, 0] },\n          then: { $arrayElemAt: [\"$grades.date\", 0] },\n          else: null\n        }\n      }\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f46eec","address":{"building":"144","street":"West 46 Street"},"name":"John'S Shanghai","distance":134.29552484553267,"latestGrade":"A","latestInspectionDate":"2015-01-02T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f47a1d","address":{"building":"811","street":"8 Avenue"},"name":"Kung Fu Little Stemed Buns Ramen Inc","distance":323.3156356442102,"latestGrade":"A","latestInspectionDate":"2014-01-23T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f46718","address":{"building":"311","street":"West   43 Street"},"name":"Hakkasan","distance":414.0861935962676,"latestGrade":"A","latestInspectionDate":"2014-12-02T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f43637","address":{"building":"36","street":"West   48 Street"},"name":"Wu Liang Ye Restaurant","distance":452.46753557294903,"latestGrade":"Z","latestInspectionDate":"2014-12-12T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f45ff4","address":{"building":"858","street":"8 Avenue"},"name":"Peking Roast Duck","distance":470.7680072162196,"latestGrade":"A","latestInspectionDate":"2014-07-07T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f43c6f","address":{"building":"566","street":"7 Avenue"},"name":"Midtown Buffet","distance":478.49368452566006,"latestGrade":"A","latestInspectionDate":"2014-09-23T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f48895","address":{"building":"368","street":"West   46 Street"},"name":"China Green Dim Sum Restaurant","distance":485.10094173629756,"latestGrade":"A","latestInspectionDate":"2014-11-18T00:00:00.000Z"}],"executionTimeMs":2703,"queryOperators":["$geoNear","$project","$cond","$gt","$size","$arrayElemAt"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find 15 restaurants in Brooklyn where the most recent grade is worse than the grade from two inspections ago","dbQuery":"db.restaurants.aggregate([\n  // Filter for Brooklyn restaurants\n  {\n    $match: {\n      borough: \"Brooklyn\"\n    }\n  },\n  // Only consider restaurants with at least 3 grades\n  {\n    $match: {\n      $expr: { $gte: [{ $size: \"$grades\" }, 3] }\n    }\n  },\n  // Add fields for grade comparison\n  {\n    $addFields: {\n      mostRecentGrade: { $arrayElemAt: [\"$grades.grade\", 0] },\n      twoInspectionsAgoGrade: { $arrayElemAt: [\"$grades.grade\", 2] }\n    }\n  },\n  // Filter where most recent grade is worse than two inspections ago\n  {\n    $match: {\n      $expr: {\n        $gt: [\n          {\n            $switch: {\n              branches: [\n                { case: { $eq: [\"$mostRecentGrade\", \"A\"] }, then: 1 },\n                { case: { $eq: [\"$mostRecentGrade\", \"B\"] }, then: 2 },\n                { case: { $eq: [\"$mostRecentGrade\", \"C\"] }, then: 3 },\n                { case: { $eq: [\"$mostRecentGrade\", \"D\"] }, then: 4 },\n                { case: { $eq: [\"$mostRecentGrade\", \"F\"] }, then: 5 }\n              ],\n              default: 6\n            }\n          },\n          {\n            $switch: {\n              branches: [\n                { case: { $eq: [\"$twoInspectionsAgoGrade\", \"A\"] }, then: 1 },\n                { case: { $eq: [\"$twoInspectionsAgoGrade\", \"B\"] }, then: 2 },\n                { case: { $eq: [\"$twoInspectionsAgoGrade\", \"C\"] }, then: 3 },\n                { case: { $eq: [\"$twoInspectionsAgoGrade\", \"D\"] }, then: 4 },\n                { case: { $eq: [\"$twoInspectionsAgoGrade\", \"F\"] }, then: 5 }\n              ],\n              default: 6\n            }\n          }\n        ]\n      }\n    }\n  },\n  // Project required fields\n  {\n    $project: {\n      name: 1,\n      cuisine: 1,\n      recentGrades: { $slice: [\"$grades\", 3] }\n    }\n  },\n  // Limit to 15 results\n  {\n    $limit: 15\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f429b0","cuisine":"American","name":"Fifth Avenue Bingo","recentGrades":[{"date":"2014-12-04T00:00:00.000Z","grade":"B","score":22},{"date":"2014-04-19T00:00:00.000Z","grade":"A","score":3},{"date":"2013-02-14T00:00:00.000Z","grade":"A","score":13}]},{"_id":"5eb3d668b31de5d588f42990","cuisine":"Donuts","name":"Nostrand Donut Shop","recentGrades":[{"date":"2014-10-21T00:00:00.000Z","grade":"B","score":16},{"date":"2014-05-21T00:00:00.000Z","grade":"A","score":5},{"date":"2013-05-02T00:00:00.000Z","grade":"A","score":10}]},{"_id":"5eb3d668b31de5d588f42aef","cuisine":"Italian","name":"Red Rose","recentGrades":[{"date":"2015-01-02T00:00:00.000Z","grade":"Z","score":24},{"date":"2013-07-18T00:00:00.000Z","grade":"A","score":12},{"date":"2013-02-20T00:00:00.000Z","grade":"A","score":4}]},{"_id":"5eb3d668b31de5d588f42b1e","cuisine":"Seafood","name":"Pete'S Clam Stop","recentGrades":[{"date":"2014-06-20T00:00:00.000Z","grade":"B","score":23},{"date":"2013-06-12T00:00:00.000Z","grade":"B","score":24},{"date":"2012-06-11T00:00:00.000Z","grade":"A","score":6}]},{"_id":"5eb3d668b31de5d588f42cce","cuisine":"Italian","name":"Tuscany Grill","recentGrades":[{"date":"2014-07-30T00:00:00.000Z","grade":"B","score":19},{"date":"2013-05-10T00:00:00.000Z","grade":"A","score":12},{"date":"2012-10-03T00:00:00.000Z","grade":"A","score":12}]},{"_id":"5eb3d668b31de5d588f42cf1","cuisine":"Mexican","name":"Mezcal'S Dos Restaurant","recentGrades":[{"date":"2014-10-14T00:00:00.000Z","grade":"B","score":14},{"date":"2013-09-05T00:00:00.000Z","grade":"A","score":5},{"date":"2012-09-17T00:00:00.000Z","grade":"A","score":7}]},{"_id":"5eb3d668b31de5d588f42b7a","cuisine":"American","name":"200 Fifth Avenue Restaurant & Sports Bar","recentGrades":[{"date":"2014-07-03T00:00:00.000Z","grade":"B","score":26},{"date":"2013-10-30T00:00:00.000Z","grade":"A","score":12},{"date":"2013-03-21T00:00:00.000Z","grade":"A","score":13}]},{"_id":"5eb3d668b31de5d588f42b84","cuisine":"American","name":"Grand Canyon","recentGrades":[{"date":"2014-12-16T00:00:00.000Z","grade":"Z","score":23},{"date":"2014-06-23T00:00:00.000Z","grade":"A","score":11},{"date":"2013-11-12T00:00:00.000Z","grade":"B","score":18}]},{"_id":"5eb3d668b31de5d588f42ce5","cuisine":"American","name":"My Three Sons Restaurant","recentGrades":[{"date":"2014-12-26T00:00:00.000Z","grade":"Z","score":21},{"date":"2014-07-08T00:00:00.000Z","grade":"A","score":10},{"date":"2014-01-29T00:00:00.000Z","grade":"A","score":12}]},{"_id":"5eb3d668b31de5d588f42b62","cuisine":"Indian","name":"India Passage Restaurant","recentGrades":[{"date":"2014-12-17T00:00:00.000Z","grade":"Z","score":15},{"date":"2014-06-19T00:00:00.000Z","grade":"A","score":9},{"date":"2013-10-02T00:00:00.000Z","grade":"B","score":16}]},{"_id":"5eb3d668b31de5d588f42ba7","cuisine":"Pizza/Italian","name":"Rocco'S Pizzeria","recentGrades":[{"date":"2014-12-04T00:00:00.000Z","grade":"B","score":15},{"date":"2014-04-16T00:00:00.000Z","grade":"B","score":18},{"date":"2013-03-14T00:00:00.000Z","grade":"A","score":13}]},{"_id":"5eb3d668b31de5d588f42d71","cuisine":"Jewish/Kosher","name":"Pavillion Caterers","recentGrades":[{"date":"2014-12-24T00:00:00.000Z","grade":"Z","score":19},{"date":"2014-06-25T00:00:00.000Z","grade":"C","score":4},{"date":"2013-12-17T00:00:00.000Z","grade":"A","score":11}]},{"_id":"5eb3d668b31de5d588f42e01","cuisine":"American","name":"Quick Stop Restaurant","recentGrades":[{"date":"2014-10-22T00:00:00.000Z","grade":"C","score":31},{"date":"2014-05-16T00:00:00.000Z","grade":"A","score":7},{"date":"2013-11-20T00:00:00.000Z","grade":"A","score":7}]},{"_id":"5eb3d668b31de5d588f42f05","cuisine":"Pizza/Italian","name":"Vincent'S Pizzeria","recentGrades":[{"date":"2014-08-15T00:00:00.000Z","grade":"B","score":19},{"date":"2014-02-12T00:00:00.000Z","grade":"C","score":30},{"date":"2013-01-08T00:00:00.000Z","grade":"A","score":10}]},{"_id":"5eb3d668b31de5d588f42e41","cuisine":"American","name":"Henry St. Ale House","recentGrades":[{"date":"2014-12-02T00:00:00.000Z","grade":"Z","score":17},{"date":"2014-04-09T00:00:00.000Z","grade":"A","score":7},{"date":"2013-10-02T00:00:00.000Z","grade":"A","score":9}]}],"executionTimeMs":1964,"queryOperators":["$match","$expr","$gte","$size","$addFields","$arrayElemAt","$gt","$switch","$eq","$project","$slice","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"List the 15 pizza restaurants with the lowest health inspection scores from their latest inspections, grouped by borough","dbQuery":"db.restaurants.aggregate([\n  // Match only pizza restaurants\n  {\n    $match: {\n      cuisine: \"Pizza\",\n      grades: { $exists: true, $ne: [] } // Ensure grades array exists and is not empty\n    }\n  },\n  // Add field for latest inspection score\n  {\n    $addFields: {\n      latestGrade: { $arrayElemAt: [\"$grades\", -1] }\n    }\n  },\n  // Extract the score from the latest grade\n  {\n    $addFields: {\n      latestScore: \"$latestGrade.score\"\n    }\n  },\n  // Sort by latest score (ascending for lowest scores)\n  {\n    $sort: {\n      latestScore: 1\n    }\n  },\n  // Limit to 15 restaurants\n  {\n    $limit: 15\n  },\n  // Group by borough\n  {\n    $group: {\n      _id: \"$borough\",\n      restaurants: {\n        $push: {\n          name: \"$name\",\n          latestScore: \"$latestScore\",\n          address: {\n            street: \"$address.street\",\n            building: \"$address.building\"\n          }\n        }\n      }\n    }\n  },\n  // Sort boroughs alphabetically for consistent output\n  {\n    $sort: {\n      _id: 1\n    }\n  }\n])","language":"mongosh","result":[{"_id":"Bronx","restaurants":[{"name":"Pizza Hut# 28256","latestScore":0,"address":{"street":"Westchester Avenue","building":"2013"}}]},{"_id":"Brooklyn","restaurants":[{"name":"Avlee Greek Kitchen","latestScore":0,"address":{"street":"Atlantic Avenue","building":"620"}},{"name":"N & D Pizza","latestScore":0,"address":{"street":"Avenue U","building":"2823"}},{"name":"Pizzahut","latestScore":0,"address":{"street":"Flatlands Ave","building":"11114"}},{"name":"Vinnie'S Pizzeria","latestScore":0,"address":{"street":"Nassau Avenue","building":"253"}},{"name":"Little Caesars","latestScore":0,"address":{"street":"Fulton Street","building":"2874"}},{"name":"Papa John'S","latestScore":0,"address":{"street":"86 Street","building":"1654"}}]},{"_id":"Manhattan","restaurants":[{"name":"Little Caesers","latestScore":0,"address":{"street":"West  207 Street","building":"525"}},{"name":"Casa Nonna","latestScore":0,"address":{"street":"Pennsylvania Plaza","building":"4"}},{"name":"Domino'S Pizza","latestScore":0,"address":{"street":"3 Avenue","building":"464"}},{"name":"Ny Fresh Pizza","latestScore":0,"address":{"street":"9 Avenue","building":"787"}},{"name":"2 Bros Pizza","latestScore":0,"address":{"street":"6 Avenue","building":"319"}},{"name":"Little Caesar'S Pizza","latestScore":0,"address":{"street":"Saint Nicholas Avenue","building":"1332"}}]},{"_id":"Queens","restaurants":[{"name":"Pizza Hut","latestScore":0,"address":{"street":"Northern Boulevard","building":"144-19"}},{"name":"Papa John'S","latestScore":0,"address":{"street":"Rockaway Boulevard","building":"94-11"}}]}],"executionTimeMs":1813,"queryOperators":["$match","$exists","$ne","$addFields","$arrayElemAt","$sort","$limit","$group","$push"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find the top 5 Mexican restaurants in Queens and Brooklyn that have shown the most improvement in their average inspection scores between their first two inspections and their last two inspections","dbQuery":"db.restaurants.aggregate([\n  // Stage 1: Match Mexican restaurants in Queens or Brooklyn\n  {\n    $match: {\n      cuisine: \"Mexican\",\n      borough: { $in: [\"Queens\", \"Brooklyn\"] }\n    }\n  },\n  // Stage 2: Filter restaurants with at least 4 inspections\n  {\n    $match: {\n      $expr: { $gte: [{ $size: \"$grades\" }, 4] }\n    }\n  },\n  // Stage 3: Sort grades by date and calculate averages\n  {\n    $addFields: {\n      sortedGrades: {\n        $sortArray: {\n          input: \"$grades\",\n          sortBy: { date: 1 }\n        }\n      }\n    }\n  },\n  // Stage 4: Calculate early and recent average scores\n  {\n    $addFields: {\n      inspectionCount: { $size: \"$grades\" },\n      earlyAvgScore: {\n        $avg: [\n          { $arrayElemAt: [\"$sortedGrades.score\", 0] },\n          { $arrayElemAt: [\"$sortedGrades.score\", 1] }\n        ]\n      },\n      recentAvgScore: {\n        $avg: [\n          { $arrayElemAt: [\"$sortedGrades.score\", -1] },\n          { $arrayElemAt: [\"$sortedGrades.score\", -2] }\n        ]\n      }\n    }\n  },\n  // Stage 5: Calculate improvement (early - recent, since lower is better)\n  {\n    $addFields: {\n      improvement: { $subtract: [\"$earlyAvgScore\", \"$recentAvgScore\"] }\n    }\n  },\n  // Stage 6: Sort by improvement (highest improvement first)\n  {\n    $sort: { improvement: -1 }\n  },\n  // Stage 7: Limit to top 5\n  {\n    $limit: 5\n  },\n  // Stage 8: Project only required fields\n  {\n    $project: {\n      name: 1,\n      borough: 1,\n      earlyAvgScore: 1,\n      recentAvgScore: 1,\n      improvement: 1,\n      inspectionCount: 1,\n      _id: 0\n    }\n  }\n])","language":"mongosh","result":[{"borough":"Queens","name":"Coatzingo Restaurant","inspectionCount":8,"earlyAvgScore":40,"recentAvgScore":8.5,"improvement":31.5},{"borough":"Brooklyn","name":"Mi Pequena Cholula Deli Restaurante","inspectionCount":7,"earlyAvgScore":30,"recentAvgScore":8,"improvement":22},{"borough":"Brooklyn","name":"Nuevo Mexico Mexican Restaurant","inspectionCount":5,"earlyAvgScore":26,"recentAvgScore":7,"improvement":19},{"borough":"Brooklyn","name":"Palma Tacos Deli","inspectionCount":4,"earlyAvgScore":26,"recentAvgScore":8.5,"improvement":17.5},{"borough":"Brooklyn","name":"Azteca Maya Restaurant","inspectionCount":5,"earlyAvgScore":27.5,"recentAvgScore":10,"improvement":17.5}],"executionTimeMs":2367,"queryOperators":["$match","$in","$expr","$gte","$size","$addFields","$sortArray","$avg","$arrayElemAt","$subtract","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Show me 10 restaurants in Queens that have maintained an 'A' grade for at least 3 consecutive inspections since 2012","dbQuery":"db.restaurants.aggregate([\n  // Match restaurants in Queens\n  { $match: { borough: \"Queens\" } },\n  \n  // Process grades array\n  {\n    $addFields: {\n      // Filter grades from 2012 onwards and sort by date descending\n      recentGrades: {\n        $sortArray: {\n          input: {\n            $filter: {\n              input: \"$grades\",\n              cond: { $gte: [\"$$this.date\", new Date(\"2012-01-01\")] }\n            }\n          },\n          sortBy: { date: -1 }\n        }\n      }\n    }\n  },\n  \n  // Find consecutive A grades\n  {\n    $addFields: {\n      consecutiveAGrades: {\n        $reduce: {\n          input: \"$recentGrades\",\n          initialValue: { consecutive: [], current: [], maxConsecutive: 0 },\n          in: {\n            $cond: {\n              if: { $eq: [\"$$this.grade\", \"A\"] },\n              then: {\n                consecutive: {\n                  $cond: {\n                    if: { $gt: [{ $size: { $concatArrays: [\"$$value.current\", [\"$$this\"]] } }, \"$$value.maxConsecutive\"] },\n                    then: { $concatArrays: [\"$$value.current\", [\"$$this\"]] },\n                    else: \"$$value.consecutive\"\n                  }\n                },\n                current: { $concatArrays: [\"$$value.current\", [\"$$this\"]] },\n                maxConsecutive: {\n                  $max: [\"$$value.maxConsecutive\", { $size: { $concatArrays: [\"$$value.current\", [\"$$this\"]] } }]\n                }\n              },\n              else: {\n                consecutive: \"$$value.consecutive\",\n                current: [],\n                maxConsecutive: \"$$value.maxConsecutive\"\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \n  // Extract the consecutive A grades array\n  {\n    $addFields: {\n      consecutiveAGrades: \"$consecutiveAGrades.consecutive\"\n    }\n  },\n  \n  // Filter restaurants with at least 3 consecutive A grades\n  {\n    $match: {\n      $expr: { $gte: [{ $size: \"$consecutiveAGrades\" }, 3] }\n    }\n  },\n  \n  // Project required fields\n  {\n    $project: {\n      name: 1,\n      cuisine: 1,\n      consecutiveAGrades: {\n        $map: {\n          input: \"$consecutiveAGrades\",\n          as: \"grade\",\n          in: {\n            date: \"$$grade.date\",\n            score: \"$$grade.score\"\n          }\n        }\n      }\n    }\n  },\n  \n  // Limit to 10 results\n  { $limit: 10 }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f4295a","cuisine":"American","name":"Terminal Cafe/Yankee Clipper","consecutiveAGrades":[{"date":"2014-05-16T00:00:00.000Z","score":9},{"date":"2013-05-10T00:00:00.000Z","score":10},{"date":"2012-05-15T00:00:00.000Z","score":9}]},{"_id":"5eb3d668b31de5d588f4297b","cuisine":"American","name":"Douglaston Club","consecutiveAGrades":[{"date":"2013-12-04T00:00:00.000Z","score":13},{"date":"2013-06-13T00:00:00.000Z","score":13},{"date":"2012-12-06T00:00:00.000Z","score":9},{"date":"2012-04-12T00:00:00.000Z","score":2}]},{"_id":"5eb3d668b31de5d588f429a7","cuisine":"American","name":"Nancy'S Fire Side","consecutiveAGrades":[{"date":"2014-01-16T00:00:00.000Z","score":4},{"date":"2013-06-20T00:00:00.000Z","score":11},{"date":"2012-10-04T00:00:00.000Z","score":13}]},{"_id":"5eb3d668b31de5d588f429ab","cuisine":"American","name":"Lavelle'S Admiral'S Club","consecutiveAGrades":[{"date":"2013-12-04T00:00:00.000Z","score":9},{"date":"2013-05-02T00:00:00.000Z","score":8},{"date":"2012-03-15T00:00:00.000Z","score":11}]},{"_id":"5eb3d668b31de5d588f429c2","cuisine":"Irish","name":"Irish Cottage","consecutiveAGrades":[{"date":"2014-09-23T00:00:00.000Z","score":12},{"date":"2013-12-28T00:00:00.000Z","score":10},{"date":"2013-04-10T00:00:00.000Z","score":12}]},{"_id":"5eb3d668b31de5d588f429e1","cuisine":"American","name":"Charlies Sports Bar","consecutiveAGrades":[{"date":"2014-02-20T00:00:00.000Z","score":4},{"date":"2013-02-08T00:00:00.000Z","score":11},{"date":"2012-02-15T00:00:00.000Z","score":10}]},{"_id":"5eb3d668b31de5d588f429f4","cuisine":"Seafood","name":"Lenny'S Clam Bar","consecutiveAGrades":[{"date":"2014-03-26T00:00:00.000Z","score":12},{"date":"2013-08-22T00:00:00.000Z","score":11},{"date":"2012-04-25T00:00:00.000Z","score":7}]},{"_id":"5eb3d668b31de5d588f429f9","cuisine":"Hamburgers","name":"Mcdonald'S","consecutiveAGrades":[{"date":"2014-09-30T00:00:00.000Z","score":2},{"date":"2014-05-15T00:00:00.000Z","score":7},{"date":"2013-11-20T00:00:00.000Z","score":9},{"date":"2013-06-11T00:00:00.000Z","score":13},{"date":"2012-05-24T00:00:00.000Z","score":11}]},{"_id":"5eb3d668b31de5d588f42a23","cuisine":"Café/Coffee/Tea","name":"Steve'S Coffee Shop","consecutiveAGrades":[{"date":"2014-04-16T00:00:00.000Z","score":11},{"date":"2013-04-16T00:00:00.000Z","score":10},{"date":"2012-04-17T00:00:00.000Z","score":10}]},{"_id":"5eb3d668b31de5d588f42930","cuisine":"American","name":"Brunos On The Boulevard","consecutiveAGrades":[{"date":"2014-05-02T00:00:00.000Z","score":10},{"date":"2013-03-02T00:00:00.000Z","score":7},{"date":"2012-02-10T00:00:00.000Z","score":13}]}],"executionTimeMs":2280,"queryOperators":["$match","$addFields","$sortArray","$filter","$gte","$reduce","$cond","$eq","$gt","$size","$concatArrays","$max","$expr","$project","$map","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Show me 12 restaurants that had more than 4 inspections between 2011 and 2014, calculating the average days between inspections and whether shorter inspection intervals correlate with better grades","dbQuery":"db.restaurants.aggregate([\n  // First, add a field with only grades from 2011-2014\n  {\n    $addFields: {\n      gradesInPeriod: {\n        $filter: {\n          input: \"$grades\",\n          cond: {\n            $and: [\n              { $gte: [\"$$this.date\", new Date(\"2011-01-01\")] },\n              { $lte: [\"$$this.date\", new Date(\"2014-12-31\")] }\n            ]\n          }\n        }\n      }\n    }\n  },\n  // Filter restaurants with more than 4 inspections in the period\n  {\n    $match: {\n      $expr: { $gt: [{ $size: \"$gradesInPeriod\" }, 4] }\n    }\n  },\n  // Calculate average days between inspections and grade distribution\n  {\n    $addFields: {\n      // Sort grades by date for calculating intervals\n      sortedGrades: {\n        $sortArray: {\n          input: \"$gradesInPeriod\",\n          sortBy: { date: 1 }\n        }\n      }\n    }\n  },\n  {\n    $addFields: {\n      // Calculate days between consecutive inspections\n      daysBetweenInspections: {\n        $map: {\n          input: { $range: [1, { $size: \"$sortedGrades\" }] },\n          as: \"idx\",\n          in: {\n            $divide: [\n              {\n                $subtract: [\n                  { $arrayElemAt: [\"$sortedGrades.date\", \"$$idx\"] },\n                  { $arrayElemAt: [\"$sortedGrades.date\", { $subtract: [\"$$idx\", 1] }] }\n                ]\n              },\n              86400000 // Convert milliseconds to days\n            ]\n          }\n        }\n      },\n      // Count grade distribution\n      gradeA: {\n        $size: {\n          $filter: {\n            input: \"$gradesInPeriod\",\n            cond: { $eq: [\"$$this.grade\", \"A\"] }\n          }\n        }\n      },\n      gradeB: {\n        $size: {\n          $filter: {\n            input: \"$gradesInPeriod\",\n            cond: { $eq: [\"$$this.grade\", \"B\"] }\n          }\n        }\n      },\n      gradeC: {\n        $size: {\n          $filter: {\n            input: \"$gradesInPeriod\",\n            cond: { $eq: [\"$$this.grade\", \"C\"] }\n          }\n        }\n      }\n    }\n  },\n  // Project final output\n  {\n    $project: {\n      name: 1,\n      cuisine: 1,\n      avgDaysBetweenInspections: { $avg: \"$daysBetweenInspections\" },\n      totalInspections: { $size: \"$gradesInPeriod\" },\n      gradeDistribution: {\n        A: \"$gradeA\",\n        B: \"$gradeB\",\n        C: \"$gradeC\"\n      }\n    }\n  },\n  // Sort by average days between inspections to see correlation patterns\n  {\n    $sort: { avgDaysBetweenInspections: 1 }\n  },\n  // Limit to 12 results\n  {\n    $limit: 12\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f46fff","cuisine":"Indian","name":"Paradise Biryani Pointe And Gramercy Pizza Pasta","avgDaysBetweenInspections":93.25,"totalInspections":5,"gradeDistribution":{"A":0,"B":2,"C":1}},{"_id":"5eb3d668b31de5d588f43930","cuisine":"Chinese","name":"New Good Taste Chinese Restaurant","avgDaysBetweenInspections":108.66666666666667,"totalInspections":7,"gradeDistribution":{"A":4,"B":1,"C":0}},{"_id":"5eb3d669b31de5d588f46ce3","cuisine":"Spanish","name":"D'Milton Restaurant","avgDaysBetweenInspections":111.5,"totalInspections":5,"gradeDistribution":{"A":3,"B":1,"C":0}},{"_id":"5eb3d669b31de5d588f47044","cuisine":"Mexican","name":"Deli El Bigotes","avgDaysBetweenInspections":112.2,"totalInspections":6,"gradeDistribution":{"A":4,"B":0,"C":0}},{"_id":"5eb3d668b31de5d588f43732","cuisine":"Japanese","name":"Cafe Zaiya","avgDaysBetweenInspections":113.33333333333333,"totalInspections":7,"gradeDistribution":{"A":4,"B":0,"C":1}},{"_id":"5eb3d669b31de5d588f46d43","cuisine":"Spanish","name":"Pollos Dona Maria","avgDaysBetweenInspections":114.6,"totalInspections":6,"gradeDistribution":{"A":3,"B":0,"C":1}},{"_id":"5eb3d669b31de5d588f46825","cuisine":"Creole","name":"Nous Les Amis Restaurant & Bakery","avgDaysBetweenInspections":115.83333333333333,"totalInspections":7,"gradeDistribution":{"A":1,"B":4,"C":0}},{"_id":"5eb3d669b31de5d588f470b9","cuisine":"Caribbean","name":"Soldiers Caribbean Restaurant","avgDaysBetweenInspections":118,"totalInspections":5,"gradeDistribution":{"A":1,"B":2,"C":1}},{"_id":"5eb3d669b31de5d588f46ff3","cuisine":"Chicken","name":"Crown Fried Chicken And Pizza","avgDaysBetweenInspections":118.5,"totalInspections":5,"gradeDistribution":{"A":4,"B":0,"C":0}},{"_id":"5eb3d669b31de5d588f4755f","cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Puerto Rico Pizzeria Restaurant","avgDaysBetweenInspections":120.25,"totalInspections":5,"gradeDistribution":{"A":2,"B":1,"C":0}},{"_id":"5eb3d669b31de5d588f46e74","cuisine":"Mexican","name":"Rancho Estrella Restaurant","avgDaysBetweenInspections":120.5,"totalInspections":5,"gradeDistribution":{"A":4,"B":0,"C":0}},{"_id":"5eb3d669b31de5d588f456db","cuisine":"Middle Eastern","name":"Healthy Halal Restaurant","avgDaysBetweenInspections":121.42857142857143,"totalInspections":8,"gradeDistribution":{"A":2,"B":3,"C":1}}],"executionTimeMs":2807,"queryOperators":["$addFields","$filter","$and","$gte","$lte","$match","$expr","$gt","$size","$sortArray","$map","$range","$divide","$subtract","$arrayElemAt","$eq","$project","$avg","$sort","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Get the complete health inspection history for these 3 restaurants: 'Joe's Pizza', 'Pizza Haven', and 'Tony's Pizzeria'","dbQuery":"db.restaurants.find(\n  {\n    name: { \n      $in: [\"Joe's Pizza\", \"Pizza Haven\", \"Tony's Pizzeria\"] \n    }\n  },\n  {\n    name: 1,\n    grades: 1,\n    _id: 0\n  }\n)","language":"mongosh","result":[{"grades":[{"date":"2014-12-31T00:00:00.000Z","grade":"A","score":9},{"date":"2014-05-22T00:00:00.000Z","grade":"B","score":19},{"date":"2013-10-22T00:00:00.000Z","grade":"A","score":11},{"date":"2013-04-04T00:00:00.000Z","grade":"A","score":13},{"date":"2012-08-27T00:00:00.000Z","grade":"B","score":19}],"name":"Pizza Haven"}],"executionTimeMs":1358,"queryOperators":["$in"],"methods":["find"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"What are all the health grades and inspection dates for 'Pizza Haven' restaurant?","dbQuery":"db.restaurants.find(\n  { name: \"Pizza Haven\" },\n  { name: 1, grades: 1, _id: 0 }\n)","language":"mongosh","result":[{"grades":[{"date":"2014-12-31T00:00:00.000Z","grade":"A","score":9},{"date":"2014-05-22T00:00:00.000Z","grade":"B","score":19},{"date":"2013-10-22T00:00:00.000Z","grade":"A","score":11},{"date":"2013-04-04T00:00:00.000Z","grade":"A","score":13},{"date":"2012-08-27T00:00:00.000Z","grade":"B","score":19}],"name":"Pizza Haven"}],"executionTimeMs":1918,"queryOperators":[],"methods":["find"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the health grades over time for 'Amanecer Latino Restaurant' and 'Corona Pizza' sorted by inspection date","dbQuery":"db.restaurants.find(\n  {\n    name: { $in: [\"Amanecer Latino Restaurant\", \"Corona Pizza\"] }\n  },\n  {\n    name: 1,\n    grades: 1,\n    _id: 0\n  }\n).map(restaurant => ({\n  name: restaurant.name,\n  grades: restaurant.grades.sort((a, b) => new Date(a.date) - new Date(b.date))\n}))","language":"mongosh","result":[{"name":"Amanecer Latino Restaurant","grades":[{"date":"2011-11-23T00:00:00.000Z","grade":"A","score":11},{"date":"2012-12-31T00:00:00.000Z","grade":"A","score":12},{"date":"2013-06-11T00:00:00.000Z","grade":"A","score":12},{"date":"2014-01-09T00:00:00.000Z","grade":"C","score":33},{"date":"2014-06-11T00:00:00.000Z","grade":"A","score":8}]},{"name":"Corona Pizza","grades":[{"date":"2011-06-09T00:00:00.000Z","grade":"A","score":12},{"date":"2012-06-01T00:00:00.000Z","grade":"P","score":12},{"date":"2012-06-22T00:00:00.000Z","grade":"C","score":4},{"date":"2012-12-12T00:00:00.000Z","grade":"A","score":12},{"date":"2013-05-14T00:00:00.000Z","grade":"A","score":7},{"date":"2014-05-22T00:00:00.000Z","grade":"A","score":11}]},{"name":"Corona Pizza","grades":[{"date":"2012-01-26T00:00:00.000Z","grade":"A","score":5},{"date":"2013-02-26T00:00:00.000Z","grade":"A","score":10},{"date":"2014-04-23T00:00:00.000Z","grade":"A","score":10},{"date":"2014-09-15T00:00:00.000Z","grade":"A","score":12}]}],"executionTimeMs":2751,"queryOperators":["$in"],"methods":["find","sort"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Compare the most recent 3 inspections versus the oldest 3 inspections for 'Pizza Haven', 'Joe's Original', and 'Tony's Place' to see if their grades improved or declined","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      name: { $in: [\"Pizza Haven\", \"Joe's Original\", \"Tony's Place\"] }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      recentInspections: {\n        $slice: [\n          {\n            $sortArray: {\n              input: \"$grades\",\n              sortBy: { date: -1 }\n            }\n          },\n          3\n        ]\n      },\n      oldestInspections: {\n        $slice: [\n          {\n            $sortArray: {\n              input: \"$grades\",\n              sortBy: { date: 1 }\n            }\n          },\n          3\n        ]\n      }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      recentInspections: 1,\n      oldestInspections: 1\n    }\n  }\n])","language":"mongosh","result":[{"name":"Pizza Haven","recentInspections":[{"date":"2014-12-31T00:00:00.000Z","grade":"A","score":9},{"date":"2014-05-22T00:00:00.000Z","grade":"B","score":19},{"date":"2013-10-22T00:00:00.000Z","grade":"A","score":11}],"oldestInspections":[{"date":"2012-08-27T00:00:00.000Z","grade":"B","score":19},{"date":"2013-04-04T00:00:00.000Z","grade":"A","score":13},{"date":"2013-10-22T00:00:00.000Z","grade":"A","score":11}]}],"executionTimeMs":2544,"queryOperators":["$match","$in","$project","$slice","$sortArray"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Get me 10 restaurants in Queens with A grades that scored exactly 13 points","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Queens\",\n      grades: {\n        $elemMatch: {\n          grade: \"A\",\n          score: 13\n        }\n      }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      restaurant_id: 1,\n      address: {\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      score: { $literal: 13 }\n    }\n  },\n  {\n    $limit: 10\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f4597e","address":{"street":"Hillside Avenue","zipcode":"11004"},"name":"Afghan Kebob House","restaurant_id":"41535706","score":13},{"_id":"5eb3d669b31de5d588f45bac","address":{"street":"Fresh Meadow Lane","zipcode":"11365"},"name":"Bakhter Afghan Halal Kabab","restaurant_id":"41559771","score":13},{"_id":"5eb3d669b31de5d588f45cb6","address":{"street":"Main Street","zipcode":"11355"},"name":"Choopan Kabab Restaurant","restaurant_id":"41569155","score":13},{"_id":"5eb3d669b31de5d588f47ddd","address":{"street":"31St St","zipcode":"11105"},"name":"Balkh Shish Kabab House","restaurant_id":"50007432","score":13},{"_id":"5eb3d668b31de5d588f4358d","address":{"street":"Liberty Avenue","zipcode":"11435"},"name":"Africana Restaurant","restaurant_id":"40798504","score":13},{"_id":"5eb3d669b31de5d588f456dc","address":{"street":"Jamaica Avenue","zipcode":"11435"},"name":"Mataheko African Restaurant And Lounge","restaurant_id":"41495376","score":13},{"_id":"5eb3d669b31de5d588f46daa","address":{"street":"Guy R Brewer Boulevard","zipcode":"11433"},"name":"Maima Liberian Bistro","restaurant_id":"41702915","score":13},{"_id":"5eb3d668b31de5d588f4297b","address":{"street":"West Drive","zipcode":"11363"},"name":"Douglaston Club","restaurant_id":"40364858","score":13},{"_id":"5eb3d668b31de5d588f429a7","address":{"street":"Jamaica Avenue","zipcode":"11001"},"name":"Nancy'S Fire Side","restaurant_id":"40365938","score":13},{"_id":"5eb3d668b31de5d588f42930","address":{"street":"Astoria Boulevard","zipcode":"11369"},"name":"Brunos On The Boulevard","restaurant_id":"40356151","score":13}],"executionTimeMs":1696,"queryOperators":["$match","$elemMatch","$project","$literal","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Find the complete inspection history for 'Pizza Haven' restaurant including all grades, scores, dates, and full address details","dbQuery":"db.restaurants.find(\n  { name: \"Pizza Haven\" },\n  {\n    name: 1,\n    cuisine: 1,\n    \"address.building\": 1,\n    \"address.street\": 1,\n    \"address.zipcode\": 1,\n    grades: 1,\n    _id: 0\n  }\n)","language":"mongosh","result":[{"address":{"building":"4942","street":"Broadway","zipcode":"10034"},"cuisine":"Pizza","grades":[{"date":"2014-12-31T00:00:00.000Z","grade":"A","score":9},{"date":"2014-05-22T00:00:00.000Z","grade":"B","score":19},{"date":"2013-10-22T00:00:00.000Z","grade":"A","score":11},{"date":"2013-04-04T00:00:00.000Z","grade":"A","score":13},{"date":"2012-08-27T00:00:00.000Z","grade":"B","score":19}],"name":"Pizza Haven"}],"executionTimeMs":1542,"queryOperators":[],"methods":["find"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the 12 restaurants in Manhattan with A grades scoring 10-13 points, sorted by oldest inspection date first","dbQuery":"db.restaurants.aggregate([\n  // Match restaurants in Manhattan\n  {\n    $match: {\n      borough: \"Manhattan\"\n    }\n  },\n  // Filter for restaurants with grades array not empty\n  {\n    $match: {\n      grades: { $exists: true, $ne: [] }\n    }\n  },\n  // Add a field for the most recent grade (first in array)\n  {\n    $addFields: {\n      mostRecentGrade: { $arrayElemAt: [\"$grades\", 0] }\n    }\n  },\n  // Filter for A grades with scores between 10-13\n  {\n    $match: {\n      \"mostRecentGrade.grade\": \"A\",\n      \"mostRecentGrade.score\": { $gte: 10, $lte: 13 }\n    }\n  },\n  // Project the required fields\n  {\n    $project: {\n      name: 1,\n      restaurant_id: 1,\n      address: {\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      lastInspectionDate: \"$mostRecentGrade.date\",\n      score: \"$mostRecentGrade.score\"\n    }\n  },\n  // Sort by inspection date ascending (oldest first)\n  {\n    $sort: {\n      lastInspectionDate: 1\n    }\n  },\n  // Limit to 12 results\n  {\n    $limit: 12\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f46373","address":{"street":"West  125 Street","zipcode":"10027"},"name":"Ethio Restaurant","restaurant_id":"41630096","lastInspectionDate":"2012-03-06T00:00:00.000Z","score":13},{"_id":"5eb3d669b31de5d588f46fd4","address":{"street":"West 39 Street","zipcode":"10018"},"name":"Szechuan Gourmet","restaurant_id":"41711975","lastInspectionDate":"2013-06-05T00:00:00.000Z","score":12},{"_id":"5eb3d669b31de5d588f460b4","address":{"street":"8 Avenue","zipcode":"10011"},"name":"El Cid Tapas Bar & Restaurant","restaurant_id":"41610200","lastInspectionDate":"2013-07-02T00:00:00.000Z","score":12},{"_id":"5eb3d668b31de5d588f4501f","address":{"street":"West   40 Street","zipcode":"10018"},"name":"Fashion 40","restaurant_id":"41413340","lastInspectionDate":"2013-07-08T00:00:00.000Z","score":10},{"_id":"5eb3d668b31de5d588f44b03","address":{"street":"East Houston Street","zipcode":"10002"},"name":"Macondo","restaurant_id":"41347049","lastInspectionDate":"2013-07-23T00:00:00.000Z","score":12},{"_id":"5eb3d669b31de5d588f4759f","address":{"street":"Avenue A","zipcode":"10009"},"name":"Nino'S Pizza","restaurant_id":"50001668","lastInspectionDate":"2013-08-28T00:00:00.000Z","score":13},{"_id":"5eb3d669b31de5d588f45677","address":{"street":"Hudson Street","zipcode":"10014"},"name":"Hudson Clearwater","restaurant_id":"41489751","lastInspectionDate":"2013-09-05T00:00:00.000Z","score":12},{"_id":"5eb3d668b31de5d588f439aa","address":{"street":"Wards Island/2Fl","zipcode":"10057"},"name":"Fratelli'S Market Place","restaurant_id":"40959339","lastInspectionDate":"2013-09-10T00:00:00.000Z","score":12},{"_id":"5eb3d668b31de5d588f42f6d","address":{"street":"Broadway","zipcode":"10025"},"name":"Tap-A-Keg","restaurant_id":"40530791","lastInspectionDate":"2013-09-12T00:00:00.000Z","score":10},{"_id":"5eb3d668b31de5d588f44709","address":{"street":"Chrystie Street","zipcode":"10002"},"name":"The Box","restaurant_id":"41281111","lastInspectionDate":"2013-09-13T00:00:00.000Z","score":13},{"_id":"5eb3d669b31de5d588f47581","address":{"street":"East   65 Street","zipcode":"10065"},"name":"The East Pole","restaurant_id":"50001649","lastInspectionDate":"2013-09-26T00:00:00.000Z","score":10},{"_id":"5eb3d669b31de5d588f46cac","address":{"street":"5 Avenue","zipcode":"10001"},"name":"L&W Oyster Co.","restaurant_id":"41698063","lastInspectionDate":"2013-10-01T00:00:00.000Z","score":13}],"executionTimeMs":2263,"queryOperators":["$match","$exists","$ne","$addFields","$arrayElemAt","$gte","$lte","$project","$sort","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find restaurants within 1 kilometer of coordinates [-73.920869, 40.867632] that have A grades with scores between 10 and 13, limited to 15 results","dbQuery":"db.restaurants.aggregate([\n  {\n    $geoNear: {\n      near: {\n        type: \"Point\",\n        coordinates: [-73.920869, 40.867632]\n      },\n      distanceField: \"distance\",\n      maxDistance: 1000,\n      spherical: true\n    }\n  },\n  {\n    $unwind: \"$grades\"\n  },\n  {\n    $match: {\n      \"grades.grade\": \"A\",\n      \"grades.score\": { $gte: 10, $lte: 13 }\n    }\n  },\n  {\n    $sort: {\n      \"_id\": 1,\n      \"grades.date\": -1\n    }\n  },\n  {\n    $group: {\n      _id: \"$_id\",\n      name: { $first: \"$name\" },\n      address: { $first: \"$address\" },\n      distance: { $first: \"$distance\" },\n      latestScore: { $first: \"$grades.score\" }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\",\n        coord: \"$address.coord\"\n      },\n      distance: 1,\n      latestScore: 1\n    }\n  },\n  {\n    $limit: 15\n  }\n])","language":"mongosh","result":[{"name":"Pizza Haven","address":{"building":"4942","street":"Broadway","coord":[-73.920869,40.8676319]},"distance":0.011131885371896032,"latestScore":11},{"name":"Betel Party Supply Bakery","address":{"building":"74","street":"Sherman Avenue","coord":[-73.926784,40.8635826]},"distance":671.6792520612305,"latestScore":12},{"name":"Mcdonald'S","address":{"building":"208","street":"Dyckman Street","coord":[-73.9273139,40.8651344]},"distance":609.6438651731969,"latestScore":11},{"name":"Restaurante Ecuatoriano Genesis","address":{"building":"538","street":"West 207 Street","coord":[-73.9200467,40.8655438]},"distance":242.5443074486102,"latestScore":13},{"name":"Mama Sushi","address":{"building":"237","street":"Dyckman Street","coord":[-73.9277123,40.8662549]},"distance":596.1353591249937,"latestScore":13},{"name":"Little Caesers","address":{"building":"525","street":"West  207 Street","coord":[-73.919409,40.8654038]},"distance":276.82205737970463,"latestScore":10},{"name":"Dunkin Donuts, Baskins Robbins","address":{"building":"130","street":"Dyckman Street","coord":[-73.92564610000001,40.86259949999999]},"distance":689.6163758262338,"latestScore":13},{"name":"Junior'S Tacos","address":{"building":"253257","street":"Sherman Avenue","coord":[-73.9219079,40.8651443]},"distance":290.41004813693746,"latestScore":12},{"name":"Opus","address":{"building":"417","street":"West  202 Street","coord":[-73.9200652,40.86105999999999]},"distance":734.7103225942664,"latestScore":13},{"name":"The Tulcingo Azteca","address":{"building":"3861","street":"10 Avenue","coord":[-73.9191847,40.8641073]},"distance":417.1995878558377,"latestScore":10},{"name":"Floridita Restaurant Uptown 2 Inc","address":{"building":"3856","street":"10 Avenue","coord":[-73.919561,40.8639994]},"distance":419.10080595166323,"latestScore":11},{"name":"Gallery Bar","address":{"building":"10561058","street":"Broadway","coord":[-73.92589,40.86606440000001]},"distance":457.28741005868085,"latestScore":12},{"name":"El Viejo Jobo Restaurant","address":{"building":"231","street":"Sherman Avenue","coord":[-73.919539,40.865658]},"distance":246.62320981803563,"latestScore":12},{"name":"Dyckman Bakery","address":{"building":"176","street":"Dyckman Street","coord":[-73.92675849999999,40.8641472]},"distance":629.5275259205157,"latestScore":13},{"name":"Sao Restaurant","address":{"building":"251","street":"Dyckman Street","coord":[-73.9283028,40.8664495]},"distance":639.4915933561239,"latestScore":13}],"executionTimeMs":1737,"queryOperators":["$geoNear","$unwind","$match","$gte","$lte","$sort","$group","$first","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Show me 15 Latin restaurants in Manhattan that have received only A grades in all their inspections, with their addresses and inspection dates","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Manhattan\",\n      cuisine: \"Latin (Cuban, Dominican, Puerto Rican, South & Central American)\",\n      grades: {\n        $exists: true,\n        $ne: [],\n        $not: {\n          $elemMatch: {\n            grade: { $ne: \"A\" }\n          }\n        }\n      }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      cuisine: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      grades: 1\n    }\n  },\n  {\n    $limit: 15\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f42a95","address":{"building":"236","street":"West   52 Street","zipcode":"10019"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-12-16T00:00:00.000Z","grade":"A","score":9},{"date":"2014-05-12T00:00:00.000Z","grade":"A","score":7},{"date":"2013-04-01T00:00:00.000Z","grade":"A","score":9},{"date":"2012-01-18T00:00:00.000Z","grade":"A","score":12}],"name":"Victor'S Cafe"},{"_id":"5eb3d668b31de5d588f42976","address":{"building":"62","street":"Charles Street","zipcode":"10014"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-05-02T00:00:00.000Z","grade":"A","score":11},{"date":"2013-05-20T00:00:00.000Z","grade":"A","score":11},{"date":"2012-05-24T00:00:00.000Z","grade":"A","score":7},{"date":"2012-01-18T00:00:00.000Z","grade":"A","score":13},{"date":"2011-10-03T00:00:00.000Z","grade":"A","score":10}],"name":"Seville Restaurant"},{"_id":"5eb3d668b31de5d588f42bfa","address":{"building":"67","street":"First Avenue","zipcode":"10003"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-03-06T00:00:00.000Z","grade":"A","score":7},{"date":"2013-09-19T00:00:00.000Z","grade":"A","score":10},{"date":"2012-12-05T00:00:00.000Z","grade":"A","score":13},{"date":"2011-10-21T00:00:00.000Z","grade":"A","score":0}],"name":"Guayoyo"},{"_id":"5eb3d668b31de5d588f42bf3","address":{"building":"113","street":"Rivington Street","zipcode":"10002"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-08-26T00:00:00.000Z","grade":"A","score":7},{"date":"2014-03-22T00:00:00.000Z","grade":"A","score":12},{"date":"2013-09-18T00:00:00.000Z","grade":"A","score":2},{"date":"2012-08-29T00:00:00.000Z","grade":"A","score":10},{"date":"2011-09-20T00:00:00.000Z","grade":"A","score":11}],"name":"El Castillo De Jagua Rest"},{"_id":"5eb3d668b31de5d588f42d9f","address":{"building":"3892","street":"Broadway","zipcode":"10032"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-07-11T00:00:00.000Z","grade":"A","score":11},{"date":"2014-02-03T00:00:00.000Z","grade":"A","score":9},{"date":"2013-05-28T00:00:00.000Z","grade":"A","score":12},{"date":"2012-11-16T00:00:00.000Z","grade":"A","score":10},{"date":"2012-06-14T00:00:00.000Z","grade":"A","score":8},{"date":"2012-02-01T00:00:00.000Z","grade":"A","score":4}],"name":"La Barca Restaurant"},{"_id":"5eb3d668b31de5d588f42f9f","address":{"building":"13","street":"West 46 Street","zipcode":"10036"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-10-01T00:00:00.000Z","grade":"A","score":9},{"date":"2014-04-14T00:00:00.000Z","grade":"A","score":11},{"date":"2013-03-14T00:00:00.000Z","grade":"A","score":10},{"date":"2012-09-18T00:00:00.000Z","grade":"A","score":13},{"date":"2012-02-27T00:00:00.000Z","grade":"A","score":12}],"name":"Ipanema Restaurant"},{"_id":"5eb3d668b31de5d588f4303b","address":{"building":"764","street":"Amsterdam Avenue","zipcode":"10025"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2015-01-12T00:00:00.000Z","grade":"A","score":4},{"date":"2014-01-15T00:00:00.000Z","grade":"A","score":12},{"date":"2013-02-13T00:00:00.000Z","grade":"A","score":7},{"date":"2012-02-21T00:00:00.000Z","grade":"A","score":12}],"name":"El Malecon Restaurant"},{"_id":"5eb3d668b31de5d588f42fd0","address":{"building":"154","street":"Post Avenue","zipcode":"10034"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-10-15T00:00:00.000Z","grade":"A","score":9},{"date":"2014-04-28T00:00:00.000Z","grade":"A","score":12},{"date":"2013-03-18T00:00:00.000Z","grade":"A","score":9},{"date":"2012-02-01T00:00:00.000Z","grade":"A","score":11}],"name":"Post Billiards Cafe"},{"_id":"5eb3d668b31de5d588f43059","address":{"building":"96","street":"8 Avenue","zipcode":"10011"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-10-03T00:00:00.000Z","grade":"A","score":10},{"date":"2014-03-06T00:00:00.000Z","grade":"A","score":10},{"date":"2013-07-22T00:00:00.000Z","grade":"A","score":9},{"date":"2013-01-24T00:00:00.000Z","grade":"A","score":13},{"date":"2012-01-10T00:00:00.000Z","grade":"A","score":5}],"name":"La Taza De Oro Restaurant"},{"_id":"5eb3d668b31de5d588f430f5","address":{"building":"2244","street":"Amsterdam Avenue","zipcode":"10032"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2013-11-01T00:00:00.000Z","grade":"A","score":9},{"date":"2013-01-25T00:00:00.000Z","grade":"A","score":8},{"date":"2011-06-10T00:00:00.000Z","grade":"A","score":7}],"name":"El Nuevo Conquistador"},{"_id":"5eb3d668b31de5d588f43479","address":{"building":"29","street":"West   26 Street","zipcode":"10010"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-07-30T00:00:00.000Z","grade":"A","score":12},{"date":"2014-02-27T00:00:00.000Z","grade":"A","score":12},{"date":"2013-08-08T00:00:00.000Z","grade":"A","score":0},{"date":"2013-01-22T00:00:00.000Z","grade":"A","score":12},{"date":"2011-12-21T00:00:00.000Z","grade":"A","score":11}],"name":"Latin American Restaurant"},{"_id":"5eb3d668b31de5d588f435c3","address":{"building":"4488","street":"Broadway","zipcode":"10040"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-06-06T00:00:00.000Z","grade":"A","score":11},{"date":"2013-10-12T00:00:00.000Z","grade":"A","score":11},{"date":"2012-01-06T00:00:00.000Z","grade":"A","score":11}],"name":"Arka Lounge"},{"_id":"5eb3d668b31de5d588f439ea","address":{"building":"91","street":"East 7 Street","zipcode":"10009"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-11-05T00:00:00.000Z","grade":"A","score":3},{"date":"2014-02-18T00:00:00.000Z","grade":"A","score":9},{"date":"2013-05-29T00:00:00.000Z","grade":"A","score":9},{"date":"2012-04-18T00:00:00.000Z","grade":"A","score":7}],"name":"Caracas Arepa /To Go"},{"_id":"5eb3d668b31de5d588f438e7","address":{"building":"64","street":"Fulton Street","zipcode":"10038"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-08-15T00:00:00.000Z","grade":"A","score":7},{"date":"2013-08-16T00:00:00.000Z","grade":"A","score":4},{"date":"2012-08-24T00:00:00.000Z","grade":"A","score":8},{"date":"2011-09-15T00:00:00.000Z","grade":"A","score":4}],"name":"Ruben'S Empanadas"},{"_id":"5eb3d668b31de5d588f43b20","address":{"building":"1249","street":"St Nicholas Avenue","zipcode":"10032"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2014-06-09T00:00:00.000Z","grade":"A","score":11},{"date":"2013-06-11T00:00:00.000Z","grade":"A","score":9},{"date":"2012-07-09T00:00:00.000Z","grade":"A","score":12},{"date":"2012-02-14T00:00:00.000Z","grade":"A","score":5}],"name":"Elsa La Reyna Del Chicharron"}],"executionTimeMs":1872,"queryOperators":["$match","$exists","$ne","$not","$elemMatch","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"List 10 restaurants in Queens where the inspection scores have increased in at least 3 consecutive inspections, showing their name, cuisine type, and complete grade history","dbQuery":"db.restaurants.aggregate([\n  // Match restaurants in Queens\n  { $match: { borough: \"Queens\" } },\n  \n  // Ensure grades array exists and has at least 3 elements\n  { $match: { \n    grades: { $exists: true },\n    $expr: { $gte: [{ $size: \"$grades\" }, 3] }\n  }},\n  \n  // Add a field to track consecutive score increases\n  { $addFields: {\n    consecutiveIncreases: {\n      $let: {\n        vars: {\n          sortedGrades: { $sortArray: { input: \"$grades\", sortBy: { date: 1 } } }\n        },\n        in: {\n          $reduce: {\n            input: { $range: [1, { $size: \"$$sortedGrades\" }] },\n            initialValue: {\n              maxConsecutive: 0,\n              currentConsecutive: 0,\n              prevScore: { $arrayElemAt: [\"$$sortedGrades.score\", 0] }\n            },\n            in: {\n              $let: {\n                vars: {\n                  currentScore: { $arrayElemAt: [\"$$sortedGrades.score\", \"$$this\"] }\n                },\n                in: {\n                  maxConsecutive: {\n                    $cond: {\n                      if: { $gt: [\"$$currentScore\", \"$$value.prevScore\"] },\n                      then: { $max: [\"$$value.maxConsecutive\", { $add: [\"$$value.currentConsecutive\", 1] }] },\n                      else: \"$$value.maxConsecutive\"\n                    }\n                  },\n                  currentConsecutive: {\n                    $cond: {\n                      if: { $gt: [\"$$currentScore\", \"$$value.prevScore\"] },\n                      then: { $add: [\"$$value.currentConsecutive\", 1] },\n                      else: 0\n                    }\n                  },\n                  prevScore: \"$$currentScore\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }},\n  \n  // Filter restaurants with at least 3 consecutive score increases\n  { $match: { \"consecutiveIncreases.maxConsecutive\": { $gte: 2 } } },\n  \n  // Project the required fields\n  { $project: {\n    name: 1,\n    cuisine: 1,\n    address: {\n      building: \"$address.building\",\n      street: \"$address.street\",\n      zipcode: \"$address.zipcode\"\n    },\n    grades: 1\n  }},\n  \n  // Limit to 10 results\n  { $limit: 10 }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f4297b","address":{"building":"600","street":"West Drive","zipcode":"11363"},"cuisine":"American","grades":[{"date":"2013-12-04T00:00:00.000Z","grade":"A","score":13},{"date":"2013-06-13T00:00:00.000Z","grade":"A","score":13},{"date":"2012-12-06T00:00:00.000Z","grade":"A","score":9},{"date":"2012-04-12T00:00:00.000Z","grade":"A","score":2},{"date":"2011-07-30T00:00:00.000Z","grade":"B","score":23}],"name":"Douglaston Club"},{"_id":"5eb3d668b31de5d588f429ab","address":{"building":"45-15","street":"Broadway","zipcode":"11103"},"cuisine":"American","grades":[{"date":"2013-12-04T00:00:00.000Z","grade":"A","score":9},{"date":"2013-05-02T00:00:00.000Z","grade":"A","score":8},{"date":"2012-03-15T00:00:00.000Z","grade":"A","score":11},{"date":"2011-07-12T00:00:00.000Z","grade":"A","score":9},{"date":"2011-02-16T00:00:00.000Z","grade":"A","score":7}],"name":"Lavelle'S Admiral'S Club"},{"_id":"5eb3d668b31de5d588f429e1","address":{"building":"4408","street":"60Th St. - Store","zipcode":"11377"},"cuisine":"American","grades":[{"date":"2014-02-20T00:00:00.000Z","grade":"A","score":4},{"date":"2013-02-08T00:00:00.000Z","grade":"A","score":11},{"date":"2012-02-15T00:00:00.000Z","grade":"A","score":10},{"date":"2011-03-02T00:00:00.000Z","grade":"A","score":2}],"name":"Charlies Sports Bar"},{"_id":"5eb3d668b31de5d588f429f4","address":{"building":"16103","street":"Crossbay Boulevard","zipcode":"11414"},"cuisine":"Seafood","grades":[{"date":"2014-10-29T00:00:00.000Z","grade":"B","score":16},{"date":"2014-03-26T00:00:00.000Z","grade":"A","score":12},{"date":"2013-08-22T00:00:00.000Z","grade":"A","score":11},{"date":"2012-04-25T00:00:00.000Z","grade":"A","score":7},{"date":"2011-11-03T00:00:00.000Z","grade":"A","score":12}],"name":"Lenny'S Clam Bar"},{"_id":"5eb3d668b31de5d588f42a52","address":{"building":"6815","street":"Northern Boulevard","zipcode":"11377"},"cuisine":"Hamburgers","grades":[{"date":"2014-03-12T00:00:00.000Z","grade":"A","score":10},{"date":"2013-09-10T00:00:00.000Z","grade":"B","score":27},{"date":"2012-08-22T00:00:00.000Z","grade":"A","score":10},{"date":"2011-09-07T00:00:00.000Z","grade":"A","score":4},{"date":"2011-04-23T00:00:00.000Z","grade":"A","score":5}],"name":"Burger King"},{"_id":"5eb3d668b31de5d588f42930","address":{"building":"8825","street":"Astoria Boulevard","zipcode":"11369"},"cuisine":"American","grades":[{"date":"2014-11-15T00:00:00.000Z","grade":"Z","score":38},{"date":"2014-05-02T00:00:00.000Z","grade":"A","score":10},{"date":"2013-03-02T00:00:00.000Z","grade":"A","score":7},{"date":"2012-02-10T00:00:00.000Z","grade":"A","score":13}],"name":"Brunos On The Boulevard"},{"_id":"5eb3d668b31de5d588f4293e","address":{"building":"129-08","street":"20 Avenue","zipcode":"11356"},"cuisine":"Delicatessen","grades":[{"date":"2014-08-16T00:00:00.000Z","grade":"A","score":12},{"date":"2013-08-27T00:00:00.000Z","grade":"A","score":9},{"date":"2012-09-20T00:00:00.000Z","grade":"A","score":7},{"date":"2011-09-29T00:00:00.000Z","grade":"A","score":10}],"name":"Sal'S Deli"},{"_id":"5eb3d668b31de5d588f4293f","address":{"building":"3406","street":"10 Street","zipcode":"11106"},"cuisine":"Delicatessen","grades":[{"date":"2014-03-19T00:00:00.000Z","grade":"A","score":3},{"date":"2013-03-13T00:00:00.000Z","grade":"A","score":12},{"date":"2012-03-27T00:00:00.000Z","grade":"A","score":8},{"date":"2011-04-05T00:00:00.000Z","grade":"A","score":7}],"name":"Steve Chu'S Deli & Grocery"},{"_id":"5eb3d668b31de5d588f42999","address":{"building":"181-08","street":"Union Turnpike","zipcode":"11366"},"cuisine":"Chinese","grades":[{"date":"2014-10-22T00:00:00.000Z","grade":"B","score":14},{"date":"2014-04-09T00:00:00.000Z","grade":"A","score":13},{"date":"2013-07-13T00:00:00.000Z","grade":"A","score":10},{"date":"2013-01-02T00:00:00.000Z","grade":"A","score":13},{"date":"2012-12-13T00:00:00.000Z","grade":"P","score":2},{"date":"2012-06-19T00:00:00.000Z","grade":"C","score":36}],"name":"King Yum Restaurant"},{"_id":"5eb3d668b31de5d588f42a1b","address":{"building":"18925","street":"Union Turnpike","zipcode":"11366"},"cuisine":"American","grades":[{"date":"2014-09-25T00:00:00.000Z","grade":"A","score":7},{"date":"2013-07-24T00:00:00.000Z","grade":"A","score":11},{"date":"2012-08-13T00:00:00.000Z","grade":"A","score":4},{"date":"2012-04-02T00:00:00.000Z","grade":"A","score":2},{"date":"2011-10-24T00:00:00.000Z","grade":"A","score":12}],"name":"P.J.' S"}],"executionTimeMs":1997,"queryOperators":["$match","$exists","$expr","$gte","$size","$addFields","$let","$sortArray","$reduce","$range","$arrayElemAt","$cond","$gt","$max","$add","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Find 10 restaurants in Brooklyn where the difference between their highest and lowest inspection scores is greater than 20 points, including their cuisine type and full grade history","dbQuery":"db.restaurants.aggregate([\n  // Stage 1: Filter for Brooklyn restaurants\n  { $match: { borough: \"Brooklyn\" } },\n  \n  // Stage 2: Filter out restaurants without grades\n  { $match: { grades: { $exists: true, $ne: [], $type: \"array\" } } },\n  \n  // Stage 3: Add fields to calculate score variation\n  {\n    $addFields: {\n      scoreVariation: {\n        $subtract: [\n          { $max: \"$grades.score\" },\n          { $min: \"$grades.score\" }\n        ]\n      }\n    }\n  },\n  \n  // Stage 4: Filter restaurants with score variation > 20\n  { $match: { scoreVariation: { $gt: 20 } } },\n  \n  // Stage 5: Project the required fields\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      cuisine: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      grades: 1,\n      scoreVariation: 1\n    }\n  },\n  \n  // Stage 6: Limit to 10 results\n  { $limit: 10 }\n])","language":"mongosh","result":[{"address":{"building":"261","street":"Driggs Avenue","zipcode":"11222"},"cuisine":"Polish","grades":[{"date":"2014-05-31T00:00:00.000Z","grade":"A","score":2},{"date":"2013-05-10T00:00:00.000Z","grade":"A","score":3},{"date":"2012-02-17T00:00:00.000Z","grade":"A","score":6},{"date":"2011-10-14T00:00:00.000Z","grade":"C","score":54}],"name":"Polish National Home","scoreVariation":52},{"address":{"building":"1","street":"Bouck Court","zipcode":"11223"},"cuisine":"American","grades":[{"date":"2014-12-10T00:00:00.000Z","grade":"A","score":2},{"date":"2014-06-25T00:00:00.000Z","grade":"A","score":9},{"date":"2013-10-23T00:00:00.000Z","grade":"C","score":28},{"date":"2013-03-21T00:00:00.000Z","grade":"C","score":29},{"date":"2012-06-15T00:00:00.000Z","grade":"A","score":10}],"name":"Shell Lanes","scoreVariation":27},{"address":{"building":"617","street":"Vanderbilt Avenue","zipcode":"11238"},"cuisine":"Soul Food","grades":[{"date":"2014-08-28T00:00:00.000Z","grade":"A","score":9},{"date":"2014-03-27T00:00:00.000Z","grade":"C","score":2},{"date":"2013-07-17T00:00:00.000Z","grade":"B","score":25},{"date":"2012-05-17T00:00:00.000Z","grade":"A","score":13},{"date":"2011-12-21T00:00:00.000Z","grade":"A","score":8}],"name":"Mitchell'S Restaurant","scoreVariation":23},{"address":{"building":"2301","street":"Flatbush Avenue","zipcode":"11234"},"cuisine":"American","grades":[{"date":"2014-02-20T00:00:00.000Z","grade":"A","score":10},{"date":"2013-07-01T00:00:00.000Z","grade":"B","score":15},{"date":"2013-01-10T00:00:00.000Z","grade":"B","score":15},{"date":"2012-07-23T00:00:00.000Z","grade":"A","score":11},{"date":"2012-01-04T00:00:00.000Z","grade":"A","score":7},{"date":"2011-09-19T00:00:00.000Z","grade":"C","score":34},{"date":"2011-04-11T00:00:00.000Z","grade":"B","score":16}],"name":"New Floridian Diner","scoreVariation":27},{"address":{"building":"2716","street":"Gerritsen Avenue","zipcode":"11229"},"cuisine":"Pizza","grades":[{"date":"2014-11-26T00:00:00.000Z","grade":"A","score":12},{"date":"2014-04-09T00:00:00.000Z","grade":"B","score":24},{"date":"2013-09-19T00:00:00.000Z","grade":"B","score":27},{"date":"2012-12-27T00:00:00.000Z","grade":"B","score":23},{"date":"2012-05-21T00:00:00.000Z","grade":"C","score":68}],"name":"Victoria Pizza","scoreVariation":56},{"address":{"building":"1366","street":"Pennsylvania Avenue","zipcode":"11239"},"cuisine":"Pizza","grades":[{"date":"2014-09-16T00:00:00.000Z","grade":"A","score":2},{"date":"2014-03-01T00:00:00.000Z","grade":"B","score":25},{"date":"2013-05-21T00:00:00.000Z","grade":"B","score":18},{"date":"2012-05-25T00:00:00.000Z","grade":"A","score":11},{"date":"2011-11-01T00:00:00.000Z","grade":"B","score":19}],"name":"Armando'S Pizza","scoreVariation":23},{"address":{"building":"1223","street":"Avenue J","zipcode":"11230"},"cuisine":"Jewish/Kosher","grades":[{"date":"2014-05-08T00:00:00.000Z","grade":"A","score":12},{"date":"2013-04-24T00:00:00.000Z","grade":"A","score":12},{"date":"2012-08-16T00:00:00.000Z","grade":"B","score":27},{"date":"2012-02-23T00:00:00.000Z","grade":"C","score":44},{"date":"2011-11-23T00:00:00.000Z","grade":"P","score":40},{"date":"2011-05-31T00:00:00.000Z","grade":"A","score":10}],"name":"Kosher Delight","scoreVariation":34},{"address":{"building":"1269","street":"Sutter Avenue","zipcode":"11208"},"cuisine":"Chinese","grades":[{"date":"2014-09-16T00:00:00.000Z","grade":"B","score":21},{"date":"2013-08-28T00:00:00.000Z","grade":"A","score":7},{"date":"2013-04-02T00:00:00.000Z","grade":"C","score":56},{"date":"2012-08-15T00:00:00.000Z","grade":"B","score":27},{"date":"2012-03-28T00:00:00.000Z","grade":"B","score":27}],"name":"May May Kitchen","scoreVariation":49},{"address":{"building":"1701","street":"Foster Avenue","zipcode":"11230"},"cuisine":"Italian","grades":[{"date":"2014-05-13T00:00:00.000Z","grade":"A","score":12},{"date":"2013-05-09T00:00:00.000Z","grade":"A","score":7},{"date":"2012-10-17T00:00:00.000Z","grade":"B","score":27},{"date":"2012-08-28T00:00:00.000Z","grade":"P","score":4},{"date":"2012-03-07T00:00:00.000Z","grade":"A","score":12}],"name":"Mama Lucia","scoreVariation":23},{"address":{"building":"709","street":"Kings Highway","zipcode":"11223"},"cuisine":"Jewish/Kosher","grades":[{"date":"2014-08-15T00:00:00.000Z","grade":"A","score":7},{"date":"2014-03-17T00:00:00.000Z","grade":"A","score":5},{"date":"2013-01-31T00:00:00.000Z","grade":"A","score":12},{"date":"2012-08-07T00:00:00.000Z","grade":"C","score":56},{"date":"2011-12-28T00:00:00.000Z","grade":"A","score":10}],"name":"Kosher Hut Of Brooklyn","scoreVariation":51}],"executionTimeMs":1891,"queryOperators":["$match","$exists","$ne","$type","$addFields","$subtract","$max","$min","$gt","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"List the top 10 restaurants within 2 miles of Central Park that have only 'A' grades, sorted by their most recent inspection date, and show me their complete grade history","dbQuery":"db.restaurants.aggregate([\n  {\n    $geoNear: {\n      near: {\n        type: \"Point\",\n        coordinates: [-73.965355, 40.782865]\n      },\n      distanceField: \"distance\",\n      maxDistance: 3218.69,\n      spherical: true\n    }\n  },\n  {\n    $match: {\n      grades: {\n        $not: {\n          $elemMatch: {\n            grade: { $ne: \"A\" }\n          }\n        }\n      },\n      \"grades.0\": { $exists: true }\n    }\n  },\n  {\n    $addFields: {\n      mostRecentInspection: { $arrayElemAt: [\"$grades.date\", 0] }\n    }\n  },\n  {\n    $sort: {\n      mostRecentInspection: -1\n    }\n  },\n  {\n    $limit: 10\n  },\n  {\n    $project: {\n      name: 1,\n      cuisine: 1,\n      address: {\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      },\n      mostRecentInspection: 1,\n      totalInspections: { $size: \"$grades\" },\n      grades: 1\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f46538","address":{"street":"West   79 Street","zipcode":"10024"},"cuisine":"Café/Coffee/Tea","grades":[{"date":"2015-01-16T00:00:00.000Z","grade":"A","score":13},{"date":"2014-08-22T00:00:00.000Z","grade":"A","score":11},{"date":"2014-03-04T00:00:00.000Z","grade":"A","score":6},{"date":"2013-08-09T00:00:00.000Z","grade":"A","score":5},{"date":"2013-02-21T00:00:00.000Z","grade":"A","score":4},{"date":"2012-06-22T00:00:00.000Z","grade":"A","score":7}],"name":"Irving Farm","mostRecentInspection":"2015-01-16T00:00:00.000Z","totalInspections":6},{"_id":"5eb3d668b31de5d588f44714","address":{"street":"Columbus Avenue","zipcode":"10023"},"cuisine":"Bakery","grades":[{"date":"2015-01-16T00:00:00.000Z","grade":"A","score":12},{"date":"2014-01-31T00:00:00.000Z","grade":"A","score":7},{"date":"2013-01-18T00:00:00.000Z","grade":"A","score":12},{"date":"2012-01-25T00:00:00.000Z","grade":"A","score":0}],"name":"Magnolia Bakery","mostRecentInspection":"2015-01-16T00:00:00.000Z","totalInspections":4},{"_id":"5eb3d669b31de5d588f487b7","address":{"street":"3Rd Ave","zipcode":"10022"},"cuisine":"Bakery","grades":[{"date":"2015-01-16T00:00:00.000Z","grade":"A","score":0}],"name":"Crumbs Bake Shop","mostRecentInspection":"2015-01-16T00:00:00.000Z","totalInspections":1},{"_id":"5eb3d668b31de5d588f445b7","address":{"street":"Lincoln Center Plaza","zipcode":"10023"},"cuisine":"American","grades":[{"date":"2015-01-16T00:00:00.000Z","grade":"A","score":7},{"date":"2014-07-01T00:00:00.000Z","grade":"A","score":6},{"date":"2013-06-21T00:00:00.000Z","grade":"A","score":4},{"date":"2012-07-02T00:00:00.000Z","grade":"A","score":11},{"date":"2012-02-13T00:00:00.000Z","grade":"A","score":3}],"name":"Metropolitan Opera","mostRecentInspection":"2015-01-16T00:00:00.000Z","totalInspections":5},{"_id":"5eb3d669b31de5d588f4609a","address":{"street":"Columbus Avenue","zipcode":"10024"},"cuisine":"Café/Coffee/Tea","grades":[{"date":"2015-01-16T00:00:00.000Z","grade":"A","score":2},{"date":"2014-08-22T00:00:00.000Z","grade":"A","score":9},{"date":"2014-02-12T00:00:00.000Z","grade":"A","score":2},{"date":"2012-12-18T00:00:00.000Z","grade":"A","score":10}],"name":"Momofuko Milk Bar Uws","mostRecentInspection":"2015-01-16T00:00:00.000Z","totalInspections":4},{"_id":"5eb3d668b31de5d588f44238","address":{"street":"7 Avenue","zipcode":"10019"},"cuisine":"American","grades":[{"date":"2015-01-16T00:00:00.000Z","grade":"A","score":13},{"date":"2014-01-21T00:00:00.000Z","grade":"A","score":11},{"date":"2013-01-17T00:00:00.000Z","grade":"A","score":3}],"name":"Park Cafe","mostRecentInspection":"2015-01-16T00:00:00.000Z","totalInspections":3},{"_id":"5eb3d668b31de5d588f43b54","address":{"street":"East   52 Street","zipcode":"10022"},"cuisine":"Mexican","grades":[{"date":"2015-01-16T00:00:00.000Z","grade":"A","score":9},{"date":"2014-08-25T00:00:00.000Z","grade":"A","score":10},{"date":"2014-03-20T00:00:00.000Z","grade":"A","score":9},{"date":"2013-01-14T00:00:00.000Z","grade":"A","score":6}],"name":"Chipotle Mexican Grill","mostRecentInspection":"2015-01-16T00:00:00.000Z","totalInspections":4},{"_id":"5eb3d668b31de5d588f441cf","address":{"street":"5 Avenue","zipcode":"10111"},"cuisine":"American","grades":[{"date":"2015-01-16T00:00:00.000Z","grade":"A","score":2},{"date":"2014-08-01T00:00:00.000Z","grade":"A","score":10},{"date":"2014-01-31T00:00:00.000Z","grade":"A","score":4},{"date":"2012-12-28T00:00:00.000Z","grade":"A","score":2},{"date":"2012-07-17T00:00:00.000Z","grade":"A","score":12}],"name":"Bessemer Trust Co","mostRecentInspection":"2015-01-16T00:00:00.000Z","totalInspections":5},{"_id":"5eb3d669b31de5d588f45d84","address":{"street":"East  103 Street","zipcode":"10029"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","grades":[{"date":"2015-01-16T00:00:00.000Z","grade":"A","score":9},{"date":"2014-08-22T00:00:00.000Z","grade":"A","score":7},{"date":"2014-03-07T00:00:00.000Z","grade":"A","score":9},{"date":"2013-01-14T00:00:00.000Z","grade":"A","score":13},{"date":"2012-01-18T00:00:00.000Z","grade":"A","score":8}],"name":"Lechonera Tropical & Grill","mostRecentInspection":"2015-01-16T00:00:00.000Z","totalInspections":5},{"_id":"5eb3d669b31de5d588f46d1f","address":{"street":"York Avenue","zipcode":"10028"},"cuisine":"Donuts","grades":[{"date":"2015-01-16T00:00:00.000Z","grade":"A","score":12},{"date":"2014-01-27T00:00:00.000Z","grade":"A","score":2},{"date":"2013-01-31T00:00:00.000Z","grade":"A","score":0}],"name":"Dunkin Donuts","mostRecentInspection":"2015-01-16T00:00:00.000Z","totalInspections":3}],"executionTimeMs":2072,"queryOperators":["$geoNear","$match","$not","$elemMatch","$ne","$exists","$addFields","$arrayElemAt","$sort","$limit","$project","$size"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"List 10 restaurants in Brooklyn that still have A grades but their scores have been climbing over the past 4 inspections","dbQuery":"db.restaurants.aggregate([\n  // Filter for Brooklyn restaurants\n  {\n    $match: {\n      borough: \"Brooklyn\"\n    }\n  },\n  // Only consider restaurants with at least 4 inspections\n  {\n    $match: {\n      $expr: { $gte: [{ $size: \"$grades\" }, 4] }\n    }\n  },\n  // Get the last 4 inspections\n  {\n    $addFields: {\n      last4Grades: { $slice: [\"$grades\", 0, 4] }\n    }\n  },\n  // Ensure all last 4 grades are 'A'\n  {\n    $match: {\n      $expr: {\n        $eq: [\n          { $size: {\n            $filter: {\n              input: \"$last4Grades\",\n              cond: { $eq: [\"$$this.grade\", \"A\"] }\n            }\n          }},\n          4\n        ]\n      }\n    }\n  },\n  // Calculate score differences to identify upward trends\n  {\n    $addFields: {\n      scoreChanges: {\n        $map: {\n          input: { $range: [1, 4] },\n          as: \"i\",\n          in: {\n            $subtract: [\n              { $arrayElemAt: [\"$last4Grades.score\", \"$$i\"] },\n              { $arrayElemAt: [\"$last4Grades.score\", { $subtract: [\"$$i\", 1] }] }\n            ]\n          }\n        }\n      }\n    }\n  },\n  // Count how many score increases there are\n  {\n    $addFields: {\n      increaseCount: {\n        $size: {\n          $filter: {\n            input: \"$scoreChanges\",\n            cond: { $gt: [\"$$this\", 0] }\n          }\n        }\n      }\n    }\n  },\n  // Filter for restaurants with at least 2 score increases (indicating a trend)\n  {\n    $match: {\n      increaseCount: { $gte: 2 }\n    }\n  },\n  // Project the required fields\n  {\n    $project: {\n      _id: 0,\n      name: 1,\n      restaurant_id: 1,\n      cuisine: 1,\n      score_trend: {\n        $map: {\n          input: \"$last4Grades\",\n          in: {\n            date: \"$$this.date\",\n            grade: \"$$this.grade\",\n            score: \"$$this.score\"\n          }\n        }\n      }\n    }\n  },\n  // Limit to 10 results\n  {\n    $limit: 10\n  }\n])","language":"mongosh","result":[{"cuisine":"American","name":"Riviera Caterer","restaurant_id":"40356018","score_trend":[{"date":"2014-06-10T00:00:00.000Z","grade":"A","score":5},{"date":"2013-06-05T00:00:00.000Z","grade":"A","score":7},{"date":"2012-04-13T00:00:00.000Z","grade":"A","score":12},{"date":"2011-10-12T00:00:00.000Z","grade":"A","score":12}]},{"cuisine":"American","name":"Brennan & Carr","restaurant_id":"40366487","score_trend":[{"date":"2014-10-30T00:00:00.000Z","grade":"A","score":7},{"date":"2013-10-16T00:00:00.000Z","grade":"A","score":11},{"date":"2013-06-04T00:00:00.000Z","grade":"A","score":11},{"date":"2012-06-04T00:00:00.000Z","grade":"A","score":12}]},{"cuisine":"American","name":"Narrows Coffee Shop","restaurant_id":"40367183","score_trend":[{"date":"2014-07-24T00:00:00.000Z","grade":"A","score":7},{"date":"2014-02-04T00:00:00.000Z","grade":"A","score":11},{"date":"2013-02-04T00:00:00.000Z","grade":"A","score":4},{"date":"2012-02-10T00:00:00.000Z","grade":"A","score":9}]},{"cuisine":"Hamburgers","name":"White Castle","restaurant_id":"40369667","score_trend":[{"date":"2014-03-06T00:00:00.000Z","grade":"A","score":10},{"date":"2013-03-01T00:00:00.000Z","grade":"A","score":12},{"date":"2012-03-03T00:00:00.000Z","grade":"A","score":6},{"date":"2011-03-17T00:00:00.000Z","grade":"A","score":7}]},{"cuisine":"Jewish/Kosher","name":"Seuda Foods","restaurant_id":"40360045","score_trend":[{"date":"2014-11-10T00:00:00.000Z","grade":"A","score":11},{"date":"2013-10-10T00:00:00.000Z","grade":"A","score":13},{"date":"2012-10-04T00:00:00.000Z","grade":"A","score":7},{"date":"2012-05-21T00:00:00.000Z","grade":"A","score":9}]},{"cuisine":"Caribbean","name":"Shashemene Int'L Restaura","restaurant_id":"40362869","score_trend":[{"date":"2014-05-13T00:00:00.000Z","grade":"A","score":2},{"date":"2013-05-08T00:00:00.000Z","grade":"A","score":7},{"date":"2012-09-22T00:00:00.000Z","grade":"A","score":11},{"date":"2011-06-06T00:00:00.000Z","grade":"A","score":12}]},{"cuisine":"American","name":"Roll-N-Roaster","restaurant_id":"40366471","score_trend":[{"date":"2014-11-17T00:00:00.000Z","grade":"A","score":5},{"date":"2013-12-21T00:00:00.000Z","grade":"A","score":10},{"date":"2013-06-25T00:00:00.000Z","grade":"A","score":7},{"date":"2012-06-18T00:00:00.000Z","grade":"A","score":13}]},{"cuisine":"Hamburgers","name":"Burger King","restaurant_id":"40370917","score_trend":[{"date":"2014-12-02T00:00:00.000Z","grade":"A","score":10},{"date":"2014-06-25T00:00:00.000Z","grade":"A","score":5},{"date":"2013-05-14T00:00:00.000Z","grade":"A","score":9},{"date":"2012-11-30T00:00:00.000Z","grade":"A","score":13}]},{"cuisine":"Pizza/Italian","name":"Korner Pizzeria","restaurant_id":"40373160","score_trend":[{"date":"2014-09-11T00:00:00.000Z","grade":"A","score":2},{"date":"2014-03-03T00:00:00.000Z","grade":"A","score":12},{"date":"2012-11-29T00:00:00.000Z","grade":"A","score":6},{"date":"2011-11-29T00:00:00.000Z","grade":"A","score":8}]},{"cuisine":"Italian","name":"Villa Fiorita","restaurant_id":"40375929","score_trend":[{"date":"2014-01-29T00:00:00.000Z","grade":"A","score":6},{"date":"2012-12-19T00:00:00.000Z","grade":"A","score":5},{"date":"2012-04-25T00:00:00.000Z","grade":"A","score":7},{"date":"2011-07-11T00:00:00.000Z","grade":"A","score":9}]}],"executionTimeMs":5648,"queryOperators":["$match","$expr","$gte","$size","$addFields","$slice","$eq","$filter","$map","$range","$subtract","$arrayElemAt","$gt","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Get me 15 Manhattan restaurants that received a C grade on their last inspection and haven't been checked since November 2024, with their addresses and coordinates","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Manhattan\"\n    }\n  },\n  {\n    $addFields: {\n      lastInspection: { $arrayElemAt: [\"$grades\", 0] }\n    }\n  },\n  {\n    $match: {\n      \"lastInspection.grade\": \"C\",\n      \"lastInspection.date\": { $lt: new Date(\"2024-11-01\") }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\",\n        coord: \"$address.coord\"\n      },\n      lastInspection: {\n        date: \"$lastInspection.date\",\n        grade: \"$lastInspection.grade\",\n        score: \"$lastInspection.score\"\n      }\n    }\n  },\n  {\n    $limit: 15\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f42d72","address":{"building":"145","street":"West   72 Street","coord":[-73.980223,40.77832799999999]},"name":"Dinastia China","lastInspection":{"date":"2014-10-28T00:00:00.000Z","grade":"C","score":31}},{"_id":"5eb3d668b31de5d588f42e62","address":{"building":"60","street":"Pine Street","coord":[-74.0081545,40.7067097]},"name":"Down Town Association","lastInspection":{"date":"2014-10-08T00:00:00.000Z","grade":"C","score":33}},{"_id":"5eb3d668b31de5d588f42e2c","address":{"building":"261","street":"Columbus Ave Store #2","coord":[-78.0810058,36.9083866]},"name":"Columbus Gourmet Food","lastInspection":{"date":"2014-12-15T00:00:00.000Z","grade":"C","score":31}},{"_id":"5eb3d668b31de5d588f4305c","address":{"building":"549","street":"Main Street","coord":[-73.94970920000002,40.7619141]},"name":"Trellis","lastInspection":{"date":"2014-07-02T00:00:00.000Z","grade":"C","score":28}},{"_id":"5eb3d668b31de5d588f431b4","address":{"building":"734","street":"Amsterdam Avenue","coord":[-73.9707385,40.7940122]},"name":"Famous Famiglia Pizza","lastInspection":{"date":"2014-10-14T00:00:00.000Z","grade":"C","score":29}},{"_id":"5eb3d668b31de5d588f433ea","address":{"building":"121","street":"West 125 Street","coord":[-73.9465567,40.8085797]},"name":"Golden Krust Caribbean Bakery & Grill","lastInspection":{"date":"2014-11-14T00:00:00.000Z","grade":"C","score":29}},{"_id":"5eb3d668b31de5d588f434d1","address":{"building":"1535","street":"Broadway","coord":[-73.9862536,40.7585799]},"name":"View Lounge","lastInspection":{"date":"2014-07-02T00:00:00.000Z","grade":"C","score":28}},{"_id":"5eb3d668b31de5d588f4335b","address":{"building":"71","street":"West   71 Street","coord":[-73.9787535,40.7767208]},"name":"Bello Giardino","lastInspection":{"date":"2014-08-22T00:00:00.000Z","grade":"C","score":30}},{"_id":"5eb3d668b31de5d588f435bf","address":{"building":"525","street":"Lexington Ave","coord":[-73.9728136,40.75546629999999]},"name":"525 Lex Restaurant & Bar","lastInspection":{"date":"2014-07-22T00:00:00.000Z","grade":"C","score":41}},{"_id":"5eb3d668b31de5d588f434f5","address":{"building":"","street":"Hudson River","coord":[-74.0163793,40.7167671]},"name":"West 79Th Street Boat Basin Cafe","lastInspection":{"date":"2014-06-27T00:00:00.000Z","grade":"C","score":89}},{"_id":"5eb3d668b31de5d588f43624","address":{"building":"249","street":"East 49 Street","coord":[-73.9694147,40.7545605]},"name":"Seo Japanese Restaurant","lastInspection":{"date":"2014-07-08T00:00:00.000Z","grade":"C","score":45}},{"_id":"5eb3d668b31de5d588f439cd","address":{"building":"1450","street":"Broadway","coord":[-73.9864939,40.7547571]},"name":"Cafe Duke","lastInspection":{"date":"2014-07-22T00:00:00.000Z","grade":"C","score":35}},{"_id":"5eb3d668b31de5d588f439b7","address":{"building":"344","street":"West 46 Street","coord":[-73.989693,40.760276]},"name":"Meson Sevilla Restaurant","lastInspection":{"date":"2014-08-21T00:00:00.000Z","grade":"C","score":29}},{"_id":"5eb3d668b31de5d588f43913","address":{"building":"135","street":"Columbus Avenue","coord":[-73.98135049999999,40.7734944]},"name":"Europan Bakery And Cafe","lastInspection":{"date":"2014-11-24T00:00:00.000Z","grade":"C","score":28}},{"_id":"5eb3d668b31de5d588f43a69","address":{"building":"466","street":"Lexington Avenue","coord":[-73.9747277,40.7536114]},"name":"Bistro Caterers","lastInspection":{"date":"2014-10-14T00:00:00.000Z","grade":"C","score":84}}],"executionTimeMs":4601,"queryOperators":["$match","$addFields","$arrayElemAt","$lt","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"What are the 10 nearest restaurants to coordinates [-73.9856, 40.7580] in Midtown and what were their most recent health inspection grades?","dbQuery":"db.restaurants.aggregate([\n  {\n    $geoNear: {\n      near: {\n        type: \"Point\",\n        coordinates: [-73.9856, 40.7580]\n      },\n      distanceField: \"distanceInMeters\",\n      spherical: true,\n      query: { borough: \"Manhattan\" }\n    }\n  },\n  {\n    $limit: 10\n  },\n  {\n    $project: {\n      name: 1,\n      address: {\n        building: \"$address.building\",\n        street: \"$address.street\"\n      },\n      cuisine: 1,\n      latestGrade: {\n        $cond: {\n          if: { $gt: [{ $size: \"$grades\" }, 0] },\n          then: {\n            grade: { $arrayElemAt: [\"$grades.grade\", 0] },\n            date: { $arrayElemAt: [\"$grades.date\", 0] }\n          },\n          else: null\n        }\n      },\n      distanceInMeters: 1\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f42ecc","address":{"building":"200","street":"West   45 Street"},"cuisine":"American","name":"Minskoff Theater","distanceInMeters":38.94730757430194,"latestGrade":{"grade":"A","date":"2014-06-10T00:00:00.000Z"}},{"_id":"5eb3d668b31de5d588f4417c","address":{"building":"1515","street":"Broadway"},"cuisine":"American","name":"Junior'S Restaurant","distanceInMeters":40.040809343023085,"latestGrade":{"grade":"Z","date":"2014-12-18T00:00:00.000Z"}},{"_id":"5eb3d668b31de5d588f44322","address":{"building":"1515","street":"Broadway"},"cuisine":"American","name":"Best Buy Theater","distanceInMeters":40.040809343023085,"latestGrade":{"grade":"A","date":"2014-06-19T00:00:00.000Z"}},{"_id":"5eb3d668b31de5d588f44b93","address":{"building":"1515","street":"Broadway"},"cuisine":"Café/Coffee/Tea","name":"Refresh Cafe","distanceInMeters":40.040809343023085,"latestGrade":{"grade":"A","date":"2014-12-31T00:00:00.000Z"}},{"_id":"5eb3d668b31de5d588f44b87","address":{"building":"1515","street":"Broadway"},"cuisine":"American","name":"Viacom Cafeteria","distanceInMeters":40.040809343023085,"latestGrade":{"grade":"A","date":"2014-09-16T00:00:00.000Z"}},{"_id":"5eb3d668b31de5d588f44b8d","address":{"building":"1515","street":"Broadway"},"cuisine":"American","name":"Viacom Executive Dining Room","distanceInMeters":40.040809343023085,"latestGrade":{"grade":"A","date":"2014-02-21T00:00:00.000Z"}},{"_id":"5eb3d669b31de5d588f45425","address":{"building":"1540","street":"Broadway"},"cuisine":"American","name":"Cbre-1540","distanceInMeters":48.226677948045406,"latestGrade":{"grade":"A","date":"2014-03-28T00:00:00.000Z"}},{"_id":"5eb3d669b31de5d588f47041","address":{"building":"1540","street":"Broadway"},"cuisine":"Italian","name":"Buca Di Beppo","distanceInMeters":48.226677948045406,"latestGrade":{"grade":"Z","date":"2014-12-30T00:00:00.000Z"}},{"_id":"5eb3d669b31de5d588f4703a","address":{"building":"1540","street":"Broadway"},"cuisine":"American","name":"Planet Hollywood","distanceInMeters":48.226677948045406,"latestGrade":{"grade":"A","date":"2014-12-01T00:00:00.000Z"}},{"_id":"5eb3d668b31de5d588f43ce5","address":{"building":"1530","street":"Broadway"},"cuisine":"Café/Coffee/Tea","name":"Starbucks Coffee","distanceInMeters":69.5624342680329,"latestGrade":{"grade":"A","date":"2014-04-02T00:00:00.000Z"}}],"executionTimeMs":1458,"queryOperators":["$geoNear","$limit","$project","$cond","$gt","$size","$arrayElemAt"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"What is the average score for Mexican restaurants that received each grade (A, B, C)?","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      cuisine: \"Mexican\"\n    }\n  },\n  {\n    $unwind: \"$grades\"\n  },\n  {\n    $match: {\n      \"grades.grade\": { $exists: true },\n      \"grades.score\": { $exists: true }\n    }\n  },\n  {\n    $group: {\n      _id: \"$grades.grade\",\n      averageScore: { $avg: \"$grades.score\" },\n      restaurantCount: { $sum: 1 }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      grade: \"$_id\",\n      averageScore: { $round: [\"$averageScore\", 2] },\n      restaurantCount: 1\n    }\n  },\n  {\n    $sort: { grade: 1 }\n  }\n])","language":"mongosh","result":[{"restaurantCount":2178,"grade":"A","averageScore":9.42},{"restaurantCount":543,"grade":"B","averageScore":20.13},{"restaurantCount":139,"grade":"C","averageScore":29.35},{"restaurantCount":8,"grade":"Not Yet Graded","averageScore":20.62},{"restaurantCount":45,"grade":"P","averageScore":5.18},{"restaurantCount":60,"grade":"Z","averageScore":23.07}],"executionTimeMs":2026,"queryOperators":["$match","$unwind","$exists","$group","$avg","$sum","$project","$round","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the average, minimum, and maximum scores for each letter grade (A, B, C) across all restaurants, and identify the score ranges where grades typically change from A to B and B to C","dbQuery":"db.restaurants.aggregate([\n  // Unwind the grades array to work with individual grade entries\n  { $unwind: \"$grades\" },\n  \n  // Group by grade letter to calculate statistics\n  {\n    $group: {\n      _id: \"$grades.grade\",\n      avgScore: { $avg: \"$grades.score\" },\n      minScore: { $min: \"$grades.score\" },\n      maxScore: { $max: \"$grades.score\" }\n    }\n  },\n  \n  // Sort by grade letter for consistent ordering\n  { $sort: { _id: 1 } },\n  \n  // Project the final format\n  {\n    $project: {\n      grade: \"$_id\",\n      avgScore: { $round: [\"$avgScore\", 2] },\n      minScore: 1,\n      maxScore: 1,\n      scoreRange: {\n        $concat: [\n          { $toString: \"$minScore\" },\n          \" - \",\n          { $toString: \"$maxScore\" }\n        ]\n      }\n    }\n  }\n])","language":"mongosh","result":[{"_id":"A","minScore":0,"maxScore":27,"grade":"A","avgScore":9.02,"scoreRange":"0 - 27"},{"_id":"B","minScore":-1,"maxScore":57,"grade":"B","avgScore":20,"scoreRange":"-1 - 57"},{"_id":"C","minScore":-1,"maxScore":131,"grade":"C","avgScore":30.7,"scoreRange":"-1 - 131"},{"_id":"Not Yet Graded","minScore":0,"maxScore":75,"grade":"Not Yet Graded","avgScore":15.85,"scoreRange":"0 - 75"},{"_id":"P","minScore":0,"maxScore":43,"grade":"P","avgScore":5.51,"scoreRange":"0 - 43"},{"_id":"Z","minScore":-1,"maxScore":71,"grade":"Z","avgScore":23.7,"scoreRange":"-1 - 71"}],"executionTimeMs":2117,"queryOperators":["$unwind","$group","$avg","$min","$max","$sort","$project","$round","$concat","$toString"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"What are the 5 most frequent exact scores for restaurants receiving B grades?","dbQuery":"db.restaurants.aggregate([\n  // Unwind the grades array to work with individual grade entries\n  { $unwind: \"$grades\" },\n  \n  // Filter for only B grades\n  { $match: { \"grades.grade\": \"B\" } },\n  \n  // Group by score and count frequency\n  { $group: {\n    _id: \"$grades.score\",\n    frequency: { $sum: 1 }\n  }},\n  \n  // Sort by frequency in descending order\n  { $sort: { frequency: -1 } },\n  \n  // Limit to top 5 results\n  { $limit: 5 },\n  \n  // Project to match the required schema\n  { $project: {\n    _id: 0,\n    score: \"$_id\",\n    frequency: 1\n  }}\n])","language":"mongosh","result":[{"frequency":1184,"score":17},{"frequency":1112,"score":19},{"frequency":1011,"score":18},{"frequency":999,"score":20},{"frequency":992,"score":15}],"executionTimeMs":2100,"queryOperators":["$unwind","$match","$group","$sum","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"For restaurants in Queens and Brooklyn that had inspections in 2014, show me the score distribution for each grade and the percentage of restaurants in each grade category","dbQuery":"db.restaurants.aggregate([\n  // Match restaurants in Queens and Brooklyn\n  {\n    $match: {\n      borough: { $in: [\"Queens\", \"Brooklyn\"] }\n    }\n  },\n  // Unwind the grades array to work with individual grades\n  {\n    $unwind: \"$grades\"\n  },\n  // Filter for inspections in 2014\n  {\n    $match: {\n      \"grades.date\": {\n        $gte: new Date(\"2014-01-01\"),\n        $lt: new Date(\"2015-01-01\")\n      }\n    }\n  },\n  // Group by borough and grade to calculate statistics\n  {\n    $group: {\n      _id: {\n        borough: \"$borough\",\n        grade: \"$grades.grade\"\n      },\n      averageScore: { $avg: \"$grades.score\" },\n      minScore: { $min: \"$grades.score\" },\n      maxScore: { $max: \"$grades.score\" },\n      restaurantCount: { $sum: 1 }\n    }\n  },\n  // Calculate total count per borough for percentage calculation\n  {\n    $group: {\n      _id: \"$_id.borough\",\n      grades: {\n        $push: {\n          grade: \"$_id.grade\",\n          averageScore: \"$averageScore\",\n          minScore: \"$minScore\",\n          maxScore: \"$maxScore\",\n          restaurantCount: \"$restaurantCount\"\n        }\n      },\n      totalCount: { $sum: \"$restaurantCount\" }\n    }\n  },\n  // Unwind grades again to calculate percentages\n  {\n    $unwind: \"$grades\"\n  },\n  // Project final format with percentage calculation\n  {\n    $project: {\n      borough: \"$_id\",\n      grade: \"$grades.grade\",\n      averageScore: { $round: [\"$grades.averageScore\", 2] },\n      minScore: \"$grades.minScore\",\n      maxScore: \"$grades.maxScore\",\n      restaurantCount: \"$grades.restaurantCount\",\n      percentage: {\n        $round: [\n          {\n            $multiply: [\n              { $divide: [\"$grades.restaurantCount\", \"$totalCount\"] },\n              100\n            ]\n          },\n          2\n        ]\n      }\n    }\n  },\n  // Sort by borough and grade\n  {\n    $sort: {\n      borough: 1,\n      grade: 1\n    }\n  }\n])","language":"mongosh","result":[{"_id":"Brooklyn","borough":"Brooklyn","grade":"A","averageScore":8.76,"minScore":0,"maxScore":18,"restaurantCount":6486,"percentage":82.31},{"_id":"Brooklyn","borough":"Brooklyn","grade":"B","averageScore":19.92,"minScore":-1,"maxScore":28,"restaurantCount":947,"percentage":12.02},{"_id":"Brooklyn","borough":"Brooklyn","grade":"C","averageScore":28.54,"minScore":-1,"maxScore":86,"restaurantCount":168,"percentage":2.13},{"_id":"Brooklyn","borough":"Brooklyn","grade":"P","averageScore":5.37,"minScore":0,"maxScore":17,"restaurantCount":76,"percentage":0.96},{"_id":"Brooklyn","borough":"Brooklyn","grade":"Z","averageScore":23.09,"minScore":-1,"maxScore":71,"restaurantCount":203,"percentage":2.58},{"_id":"Queens","borough":"Queens","grade":"A","averageScore":8.99,"minScore":0,"maxScore":27,"restaurantCount":6021,"percentage":81.47},{"_id":"Queens","borough":"Queens","grade":"B","averageScore":19.95,"minScore":-1,"maxScore":27,"restaurantCount":904,"percentage":12.23},{"_id":"Queens","borough":"Queens","grade":"C","averageScore":30.16,"minScore":0,"maxScore":78,"restaurantCount":184,"percentage":2.49},{"_id":"Queens","borough":"Queens","grade":"Not Yet Graded","averageScore":11,"minScore":11,"maxScore":11,"restaurantCount":1,"percentage":0.01},{"_id":"Queens","borough":"Queens","grade":"P","averageScore":3.87,"minScore":0,"maxScore":11,"restaurantCount":52,"percentage":0.7},{"_id":"Queens","borough":"Queens","grade":"Z","averageScore":23.68,"minScore":0,"maxScore":62,"restaurantCount":228,"percentage":3.09}],"executionTimeMs":1426,"queryOperators":["$match","$in","$unwind","$gte","$lt","$group","$avg","$min","$max","$sum","$push","$project","$round","$multiply","$divide","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find all restaurants within a 1-kilometer radius of coordinates [-73.9856, 40.7484] that have maintained an A grade for their last 3 inspections, limited to 20 results","dbQuery":"db.restaurants.aggregate([\n  {\n    $geoNear: {\n      near: { type: \"Point\", coordinates: [-73.9856, 40.7484] },\n      distanceField: \"distance\",\n      maxDistance: 1000,\n      spherical: true\n    }\n  },\n  {\n    $match: {\n      $expr: {\n        $and: [\n          { $gte: [{ $size: \"$grades\" }, 3] },\n          { $eq: [{ $arrayElemAt: [\"$grades.grade\", 0] }, \"A\"] },\n          { $eq: [{ $arrayElemAt: [\"$grades.grade\", 1] }, \"A\"] },\n          { $eq: [{ $arrayElemAt: [\"$grades.grade\", 2] }, \"A\"] }\n        ]\n      }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      cuisine: 1,\n      distance: 1,\n      lastThreeGrades: { $slice: [\"$grades.grade\", 3] },\n      address: {\n        street: \"$address.street\",\n        building: \"$address.building\"\n      }\n    }\n  },\n  {\n    $limit: 20\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f42da8","address":{"street":"West   33 Street","building":"18"},"cuisine":"Irish","name":"Foley'S N.Y. Pub And Restaurant","distance":61.16167312316828,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f43401","address":{"street":"5 Avenue","building":"334"},"cuisine":"Café/Coffee/Tea","name":"Starbucks Coffee","distance":70.97478218891514,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f4379f","address":{"street":"West   32 Street","building":"9"},"cuisine":"Korean","name":"Kunjip Restaurant","distance":85.72591755759164,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d669b31de5d588f4639b","address":{"street":"West   32 Street","building":"17"},"cuisine":"Other","name":"Vu Bar","distance":93.86037820618469,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f446ce","address":{"street":"West   34 Street","building":"22"},"cuisine":"American","name":"Paul'S Restaurant","distance":95.80454338499057,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d669b31de5d588f46b9c","address":{"street":"West   34 Street","building":"22"},"cuisine":"Pizza/Italian","name":"Sbarro","distance":95.80454338499057,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f43a94","address":{"street":"5 Avenue","building":"335"},"cuisine":"Hamburgers","name":"Wendy'S","distance":102.86996917149841,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f44d31","address":{"street":"5 Avenue","building":"341"},"cuisine":"Hamburgers","name":"Mcdonald'S","distance":104.49763233599701,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f43f51","address":{"street":"West   35 Street","building":"2"},"cuisine":"Sandwiches","name":"Subway","distance":106.6366763962713,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d669b31de5d588f4658a","address":{"street":"5 Avenue","building":"366"},"cuisine":"Sandwiches/Salads/Mixed Buffet","name":"Potbelly Sandwich Shop","distance":110.21950287643713,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f44211","address":{"street":"West 32 Street","building":"25"},"cuisine":"Korean","name":"Chorus Music Studio/ Chorus Karaoke Lounge Bar","distance":110.59222486302299,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f438f0","address":{"street":"West   33 Street","building":"36"},"cuisine":"Irish","name":"Jack Demsey'S Pub","distance":114.36876595375543,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d669b31de5d588f458bb","address":{"street":"West   32 Street","building":"7"},"cuisine":"Ice Cream, Gelato, Yogurt, Ices","name":"Pinkberry","distance":116.96260262911139,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d669b31de5d588f4575a","address":{"street":"West   32 Street","building":"10"},"cuisine":"Korean","name":"Miss Korea","distance":135.26018088154464,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f44f73","address":{"street":"West   32 Street","building":"10"},"cuisine":"Asian","name":"Karaoke Wow","distance":135.26018088154464,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d669b31de5d588f4706e","address":{"street":"West   32 Street","building":"10"},"cuisine":"American","name":"Boss Bar & Lounge","distance":135.26018088154464,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f4339a","address":{"street":"Fifth Avenue","building":"365"},"cuisine":"American","name":"C.U.N.Y Cafe","distance":137.16115228846215,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d669b31de5d588f45b5e","address":{"street":"5 Avenue","building":"316"},"cuisine":"Juice, Smoothies, Fruit Salads","name":"Small Peace Soup & Smoothie","distance":138.6709443399366,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d669b31de5d588f456b1","address":{"street":"West   35 Street","building":"34"},"cuisine":"Latin (Cuban, Dominican, Puerto Rican, South & Central American)","name":"Lena","distance":140.5275005242176,"lastThreeGrades":["A","A","A"]},{"_id":"5eb3d668b31de5d588f44701","address":{"street":"West 32 Street","building":"12"},"cuisine":"Korean","name":"Woorijip","distance":142.07200465929893,"lastThreeGrades":["A","A","A"]}],"executionTimeMs":1502,"queryOperators":["$geoNear","$match","$expr","$and","$gte","$size","$eq","$arrayElemAt","$project","$slice","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the top 10 neighborhoods with the most Chinese restaurants","dbQuery":"db.temp_neighborhood_counts.find(\n  {},\n  { name: 1, chineseCount: 1, _id: 0 }\n).sort({ chineseCount: -1 }).limit(10)","language":"mongosh","result":[{"name":"Sunset Park East","chineseCount":26},{"name":"Bensonhurst West","chineseCount":13},{"name":"Stuyvesant Heights","chineseCount":10},{"name":"East New York","chineseCount":10},{"name":"Prospect Lefferts Gardens-Wingate","chineseCount":6},{"name":"Madison","chineseCount":6},{"name":"Crown Heights North","chineseCount":6},{"name":"Flatlands","chineseCount":6},{"name":"Rugby-Remsen Village","chineseCount":5},{"name":"Dyker Heights","chineseCount":5}],"executionTimeMs":1669,"queryOperators":[],"methods":["find","sort","limit"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Which 5 neighborhoods have the highest number of Mexican restaurants?","dbQuery":"db.temp_neighborhood_counts.find(\n  {}, \n  { name: 1, mexicanCount: 1, _id: 0 }\n).sort({ mexicanCount: -1 }).limit(5)","language":"mongosh","result":[{"name":"Bushwick North","mexicanCount":9},{"name":"Park Slope-Gowanus","mexicanCount":9},{"name":"Sunset Park West","mexicanCount":9},{"name":"Sunset Park East","mexicanCount":7},{"name":"East Williamsburg","mexicanCount":5}],"executionTimeMs":1576,"queryOperators":[],"methods":["find","sort","limit"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"List the top 15 neighborhoods that have both Chinese and Mexican restaurants, sorted by total restaurant count","dbQuery":"db.temp_neighborhood_counts.find({\n  $and: [\n    { chineseCount: { $gt: 0 } },\n    { mexicanCount: { $gt: 0 } }\n  ]\n}, {\n  _id: 0,\n  name: 1,\n  chineseCount: 1,\n  mexicanCount: 1,\n  count: 1\n}).sort({ count: -1 }).limit(15)","language":"mongosh","result":[{"name":"Sunset Park East","chineseCount":26,"count":33,"mexicanCount":7},{"name":"Sunset Park West","chineseCount":5,"count":14,"mexicanCount":9},{"name":"Park Slope-Gowanus","chineseCount":5,"count":14,"mexicanCount":9},{"name":"Bushwick North","chineseCount":3,"count":12,"mexicanCount":9},{"name":"Bay Ridge","chineseCount":5,"count":10,"mexicanCount":5},{"name":"Flatbush","chineseCount":5,"count":10,"mexicanCount":5},{"name":"East Williamsburg","chineseCount":4,"count":9,"mexicanCount":5},{"name":"DUMBO-Vinegar Hill-Downtown Brooklyn-Boerum Hill","chineseCount":4,"count":7,"mexicanCount":3},{"name":"Carroll Gardens-Columbia Street-Red Hook","chineseCount":4,"count":7,"mexicanCount":3},{"name":"Prospect Lefferts Gardens-Wingate","chineseCount":6,"count":7,"mexicanCount":1},{"name":"Clinton Hill","chineseCount":3,"count":6,"mexicanCount":3},{"name":"North Side-South Side","chineseCount":3,"count":6,"mexicanCount":3},{"name":"Cypress Hills-City Line","chineseCount":4,"count":6,"mexicanCount":2},{"name":"Bensonhurst East","chineseCount":4,"count":6,"mexicanCount":2},{"name":"Kensington-Ocean Parkway","chineseCount":4,"count":5,"mexicanCount":1}],"executionTimeMs":1541,"queryOperators":["$and","$gt"],"methods":["find","sort","limit"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Find the top 5 zip codes with the most restaurants that have gaps longer than 18 months between their last two health inspections","dbQuery":"db.restaurants.aggregate([\n  // Stage 1: Filter restaurants with at least 2 inspections\n  {\n    $match: {\n      $expr: { $gte: [{ $size: \"$grades\" }, 2] }\n    }\n  },\n  // Stage 2: Project to get the last two inspection dates\n  {\n    $project: {\n      zipcode: \"$address.zipcode\",\n      lastInspection: { $arrayElemAt: [\"$grades.date\", 0] },\n      secondLastInspection: { $arrayElemAt: [\"$grades.date\", 1] }\n    }\n  },\n  // Stage 3: Calculate the gap in milliseconds and convert to days\n  {\n    $project: {\n      zipcode: 1,\n      gapInDays: {\n        $divide: [\n          { $subtract: [\"$lastInspection\", \"$secondLastInspection\"] },\n          1000 * 60 * 60 * 24 // Convert milliseconds to days\n        ]\n      }\n    }\n  },\n  // Stage 4: Filter for gaps greater than 18 months (approximately 548 days)\n  {\n    $match: {\n      gapInDays: { $gt: 548 }\n    }\n  },\n  // Stage 5: Group by zipcode and count restaurants\n  {\n    $group: {\n      _id: \"$zipcode\",\n      restaurantCount: { $sum: 1 }\n    }\n  },\n  // Stage 6: Sort by count in descending order\n  {\n    $sort: { restaurantCount: -1 }\n  },\n  // Stage 7: Limit to top 5\n  {\n    $limit: 5\n  },\n  // Stage 8: Format output\n  {\n    $project: {\n      zipcode: \"$_id\",\n      restaurantCount: 1,\n      _id: 0\n    }\n  }\n])","language":"mongosh","result":[{"restaurantCount":6,"zipcode":"10013"},{"restaurantCount":4,"zipcode":"10036"},{"restaurantCount":3,"zipcode":"10003"},{"restaurantCount":3,"zipcode":"10002"},{"restaurantCount":2,"zipcode":"11235"}],"executionTimeMs":2248,"queryOperators":["$match","$expr","$gte","$size","$project","$arrayElemAt","$divide","$subtract","$gt","$group","$sum","$sort","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"For restaurants in Brooklyn zip codes 11201 through 11205, calculate what percentage had regular inspections (at least once per year) between 2022 and 2024","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Brooklyn\",\n      \"address.zipcode\": { $in: [\"11201\", \"11202\", \"11203\", \"11204\", \"11205\"] }\n    }\n  },\n  {\n    $addFields: {\n      inspectionYears: {\n        $map: {\n          input: \"$grades\",\n          as: \"grade\",\n          in: { $year: \"$$grade.date\" }\n        }\n      }\n    }\n  },\n  {\n    $addFields: {\n      hasInspection2022: { $in: [2022, \"$inspectionYears\"] },\n      hasInspection2023: { $in: [2023, \"$inspectionYears\"] },\n      hasInspection2024: { $in: [2024, \"$inspectionYears\"] }\n    }\n  },\n  {\n    $addFields: {\n      regularlyInspected: {\n        $and: [\"$hasInspection2022\", \"$hasInspection2023\", \"$hasInspection2024\"]\n      }\n    }\n  },\n  {\n    $group: {\n      _id: \"$address.zipcode\",\n      totalRestaurants: { $sum: 1 },\n      regularlyInspected: {\n        $sum: { $cond: [\"$regularlyInspected\", 1, 0] }\n      }\n    }\n  },\n  {\n    $project: {\n      zipcode: \"$_id\",\n      totalRestaurants: 1,\n      regularlyInspected: 1,\n      survivalRate: {\n        $round: [\n          {\n            $multiply: [\n              { $divide: [\"$regularlyInspected\", \"$totalRestaurants\"] },\n              100\n            ]\n          },\n          2\n        ]\n      }\n    }\n  },\n  {\n    $sort: { zipcode: 1 }\n  }\n])","language":"mongosh","result":[{"_id":"11201","totalRestaurants":342,"regularlyInspected":0,"zipcode":"11201","survivalRate":0},{"_id":"11203","totalRestaurants":136,"regularlyInspected":0,"zipcode":"11203","survivalRate":0},{"_id":"11204","totalRestaurants":121,"regularlyInspected":0,"zipcode":"11204","survivalRate":0},{"_id":"11205","totalRestaurants":139,"regularlyInspected":0,"zipcode":"11205","survivalRate":0}],"executionTimeMs":1503,"queryOperators":["$match","$in","$addFields","$map","$year","$and","$group","$sum","$cond","$project","$round","$multiply","$divide","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Compare the number of restaurants in Manhattan zip codes 10001, 10002, and 10003 that had inspections in 2025 versus those whose last inspection was before 2024","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: \"Manhattan\",\n      \"address.zipcode\": { $in: [\"10001\", \"10002\", \"10003\"] }\n    }\n  },\n  {\n    $addFields: {\n      lastInspectionDate: { $max: \"$grades.date\" },\n      has2025Inspection: {\n        $gt: [\n          {\n            $size: {\n              $filter: {\n                input: \"$grades\",\n                cond: {\n                  $and: [\n                    { $gte: [\"$$this.date\", new Date(\"2025-01-01\")] },\n                    { $lt: [\"$$this.date\", new Date(\"2026-01-01\")] }\n                  ]\n                }\n              }\n            }\n          },\n          0\n        ]\n      }\n    }\n  },\n  {\n    $addFields: {\n      category: {\n        $cond: {\n          if: \"$has2025Inspection\",\n          then: \"recentlyInspected\",\n          else: {\n            $cond: {\n              if: { $lt: [\"$lastInspectionDate\", new Date(\"2024-01-01\")] },\n              then: \"notRecentlyInspected\",\n              else: \"other\"\n            }\n          }\n        }\n      }\n    }\n  },\n  {\n    $match: {\n      category: { $in: [\"recentlyInspected\", \"notRecentlyInspected\"] }\n    }\n  },\n  {\n    $group: {\n      _id: {\n        zipcode: \"$address.zipcode\",\n        category: \"$category\"\n      },\n      count: { $sum: 1 }\n    }\n  },\n  {\n    $group: {\n      _id: \"$_id.zipcode\",\n      categories: {\n        $push: {\n          category: \"$_id.category\",\n          count: \"$count\"\n        }\n      }\n    }\n  },\n  {\n    $project: {\n      zipcode: \"$_id\",\n      recentlyInspected: {\n        $ifNull: [\n          {\n            $arrayElemAt: [\n              {\n                $map: {\n                  input: {\n                    $filter: {\n                      input: \"$categories\",\n                      cond: { $eq: [\"$$this.category\", \"recentlyInspected\"] }\n                    }\n                  },\n                  in: \"$$this.count\"\n                }\n              },\n              0\n            ]\n          },\n          0\n        ]\n      },\n      notRecentlyInspected: {\n        $ifNull: [\n          {\n            $arrayElemAt: [\n              {\n                $map: {\n                  input: {\n                    $filter: {\n                      input: \"$categories\",\n                      cond: { $eq: [\"$$this.category\", \"notRecentlyInspected\"] }\n                    }\n                  },\n                  in: \"$$this.count\"\n                }\n              },\n              0\n            ]\n          },\n          0\n        ]\n      }\n    }\n  },\n  {\n    $addFields: {\n      turnoverRate: {\n        $round: [\n          {\n            $multiply: [\n              {\n                $divide: [\n                  \"$notRecentlyInspected\",\n                  { $add: [\"$recentlyInspected\", \"$notRecentlyInspected\"] }\n                ]\n              },\n              100\n            ]\n          },\n          2\n        ]\n      }\n    }\n  },\n  {\n    $sort: { zipcode: 1 }\n  }\n])","language":"mongosh","result":[{"_id":"10001","zipcode":"10001","recentlyInspected":0,"notRecentlyInspected":519,"turnoverRate":100},{"_id":"10002","zipcode":"10002","recentlyInspected":0,"notRecentlyInspected":469,"turnoverRate":100},{"_id":"10003","zipcode":"10003","recentlyInspected":0,"notRecentlyInspected":684,"turnoverRate":100}],"executionTimeMs":1807,"queryOperators":["$match","$in","$addFields","$max","$gt","$size","$filter","$and","$gte","$lt","$cond","$group","$sum","$push","$project","$ifNull","$arrayElemAt","$map","$eq","$round","$multiply","$divide","$add","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"List the 10 most recent Mexican restaurants in Queens that received an A grade on their first inspection","dbQuery":"db.restaurants.aggregate([\n  // Filter for Mexican restaurants in Queens\n  {\n    $match: {\n      borough: \"Queens\",\n      cuisine: \"Mexican\"\n    }\n  },\n  // Sort grades by date and extract first inspection\n  {\n    $addFields: {\n      sortedGrades: {\n        $sortArray: {\n          input: \"$grades\",\n          sortBy: { date: 1 }\n        }\n      }\n    }\n  },\n  {\n    $addFields: {\n      firstInspection: { $arrayElemAt: [\"$sortedGrades\", 0] }\n    }\n  },\n  // Filter for restaurants with first inspection grade \"A\"\n  {\n    $match: {\n      \"firstInspection.grade\": \"A\"\n    }\n  },\n  // Sort by first inspection date descending (most recent first)\n  {\n    $sort: {\n      \"firstInspection.date\": -1\n    }\n  },\n  // Limit to 10 results\n  {\n    $limit: 10\n  },\n  // Project the required fields\n  {\n    $project: {\n      name: 1,\n      restaurant_id: 1,\n      firstInspectionDate: \"$firstInspection.date\",\n      address: {\n        street: \"$address.street\",\n        zipcode: \"$address.zipcode\"\n      }\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f48256","address":{"street":"36 Avenue","zipcode":"11106"},"name":"Chela & Garnacha","restaurant_id":"50011525","firstInspectionDate":"2015-01-16T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f48a5c","address":{"street":"Forest Ave","zipcode":"11385"},"name":"Mexican Apple Bbq","restaurant_id":"50017954","firstInspectionDate":"2015-01-06T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f4848b","address":{"street":"31 Avenue","zipcode":"11103"},"name":"Acapulco","restaurant_id":"50013678","firstInspectionDate":"2014-12-26T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f488ed","address":{"street":"30Th Ave","zipcode":"11103"},"name":"Mezquite","restaurant_id":"50017063","firstInspectionDate":"2014-12-26T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f48707","address":{"street":"89 Avenue","zipcode":"11435"},"name":"El Rinconcito De Los Sabores","restaurant_id":"50015706","firstInspectionDate":"2014-12-24T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f48584","address":{"street":"Austin St","zipcode":"11375"},"name":"El Coyote","restaurant_id":"50014424","firstInspectionDate":"2014-12-10T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f48666","address":{"street":"36 Street","zipcode":"11106"},"name":"Tacuba Cantiina Mexicana","restaurant_id":"50015229","firstInspectionDate":"2014-11-06T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f48458","address":{"street":"Broadway","zipcode":"11103"},"name":"Cuatomate","restaurant_id":"50013432","firstInspectionDate":"2014-10-30T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f48612","address":{"street":"Corona Avenue","zipcode":"11368"},"name":"Lomazoyatl Deli Grocery","restaurant_id":"50015008","firstInspectionDate":"2014-10-21T00:00:00.000Z"},{"_id":"5eb3d669b31de5d588f486af","address":{"street":"37 Avenue","zipcode":"11368"},"name":"Rinconcito Mexicano Restaurant","restaurant_id":"50015454","firstInspectionDate":"2014-10-16T00:00:00.000Z"}],"executionTimeMs":1646,"queryOperators":["$match","$addFields","$sortArray","$arrayElemAt","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Create a Q2 2025 performance summary for Maria Rodriguez's three Mexican restaurants showing average inspection scores, grade distribution, and percentage change from Q1 2025","dbQuery":"db.restaurants.aggregate([\n  // Match Mexican restaurants with \"Maria Rodriguez\" in the name\n  {\n    $match: {\n      name: { $regex: \"Maria Rodriguez\", $options: \"i\" },\n      cuisine: \"Mexican\"\n    }\n  },\n  // Unwind grades array to process individual inspections\n  {\n    $unwind: \"$grades\"\n  },\n  // Add quarter information to each grade\n  {\n    $addFields: {\n      quarter: {\n        $cond: [\n          {\n            $and: [\n              { $gte: [\"$grades.date\", new Date(\"2025-04-01\")] },\n              { $lte: [\"$grades.date\", new Date(\"2025-06-30\")] }\n            ]\n          },\n          \"Q2_2025\",\n          {\n            $cond: [\n              {\n                $and: [\n                  { $gte: [\"$grades.date\", new Date(\"2025-01-01\")] },\n                  { $lte: [\"$grades.date\", new Date(\"2025-03-31\")] }\n                ]\n              },\n              \"Q1_2025\",\n              \"other\"\n            ]\n          }\n        ]\n      }\n    }\n  },\n  // Filter only Q1 and Q2 2025 data\n  {\n    $match: {\n      quarter: { $in: [\"Q1_2025\", \"Q2_2025\"] }\n    }\n  },\n  // Sort by date descending to get most recent grades first\n  {\n    $sort: { \"grades.date\": -1 }\n  },\n  // Group by restaurant and quarter to get metrics\n  {\n    $group: {\n      _id: {\n        restaurant_id: \"$restaurant_id\",\n        name: \"$name\",\n        borough: \"$borough\",\n        quarter: \"$quarter\"\n      },\n      avgScore: { $avg: \"$grades.score\" },\n      latestGrade: { $first: \"$grades.grade\" },\n      allScores: { $push: \"$grades.score\" },\n      allGrades: { $push: \"$grades.grade\" }\n    }\n  },\n  // Group by restaurant to combine Q1 and Q2 data\n  {\n    $group: {\n      _id: {\n        restaurant_id: \"$_id.restaurant_id\",\n        name: \"$_id.name\",\n        borough: \"$_id.borough\"\n      },\n      quarters: {\n        $push: {\n          quarter: \"$_id.quarter\",\n          avgScore: \"$avgScore\",\n          latestGrade: \"$latestGrade\",\n          allScores: \"$allScores\",\n          allGrades: \"$allGrades\"\n        }\n      }\n    }\n  },\n  // Reshape data to separate Q1 and Q2 metrics\n  {\n    $project: {\n      name: \"$_id.name\",\n      borough: \"$_id.borough\",\n      q2Data: {\n        $filter: {\n          input: \"$quarters\",\n          cond: { $eq: [\"$$this.quarter\", \"Q2_2025\"] }\n        }\n      },\n      q1Data: {\n        $filter: {\n          input: \"$quarters\",\n          cond: { $eq: [\"$$this.quarter\", \"Q1_2025\"] }\n        }\n      }\n    }\n  },\n  // Extract Q1 and Q2 metrics and calculate percentage change\n  {\n    $project: {\n      name: 1,\n      borough: 1,\n      q2_avgScore: { $round: [{ $arrayElemAt: [\"$q2Data.avgScore\", 0] }, 2] },\n      q2_grade: { $arrayElemAt: [\"$q2Data.latestGrade\", 0] },\n      q1_avgScore: { \n        $round: [{ $arrayElemAt: [\"$q1Data.avgScore\", 0] }, 2] \n      },\n      q1_grade: { $arrayElemAt: [\"$q1Data.latestGrade\", 0] },\n      q2_allGrades: { $arrayElemAt: [\"$q2Data.allGrades\", 0] }\n    }\n  },\n  // Calculate percentage change\n  {\n    $addFields: {\n      percentageChange: {\n        $cond: [\n          { $and: [\n            { $ne: [\"$q1_avgScore\", null] },\n            { $ne: [\"$q1_avgScore\", 0] }\n          ]},\n          {\n            $round: [\n              {\n                $multiply: [\n                  {\n                    $divide: [\n                      { $subtract: [\"$q2_avgScore\", \"$q1_avgScore\"] },\n                      \"$q1_avgScore\"\n                    ]\n                  },\n                  100\n                ]\n              },\n              2\n            ]\n          },\n          null\n        ]\n      }\n    }\n  },\n  // Use facet to create both restaurant details and overall metrics\n  {\n    $facet: {\n      restaurants: [\n        {\n          $project: {\n            name: 1,\n            borough: 1,\n            q2_avgScore: 1,\n            q2_grade: 1,\n            q1_avgScore: 1,\n            q1_grade: 1,\n            percentageChange: 1\n          }\n        }\n      ],\n      overallMetrics: [\n        {\n          $group: {\n            _id: null,\n            avgScoreAllLocations: { $avg: \"$q2_avgScore\" },\n            allQ2Grades: { $push: \"$q2_allGrades\" }\n          }\n        },\n        {\n          $project: {\n            avgScoreAllLocations: { $round: [\"$avgScoreAllLocations\", 2] },\n            flatGrades: {\n              $reduce: {\n                input: \"$allQ2Grades\",\n                initialValue: [],\n                in: { $concatArrays: [\"$$value\", \"$$this\"] }\n              }\n            }\n          }\n        },\n        {\n          $unwind: \"$flatGrades\"\n        },\n        {\n          $group: {\n            _id: \"$flatGrades\",\n            count: { $sum: 1 },\n            avgScore: { $first: \"$avgScoreAllLocations\" }\n          }\n        },\n        {\n          $group: {\n            _id: null,\n            avgScoreAllLocations: { $first: \"$avgScore\" },\n            gradeDistribution: {\n              $push: {\n                k: \"$_id\",\n                v: \"$count\"\n              }\n            }\n          }\n        },\n        {\n          $project: {\n            avgScoreAllLocations: 1,\n            gradeDistribution: { $arrayToObject: \"$gradeDistribution\" }\n          }\n        }\n      ]\n    }\n  },\n  // Final formatting\n  {\n    $project: {\n      quarter: \"Q2 2025\",\n      restaurants: 1,\n      overallMetrics: { $arrayElemAt: [\"$overallMetrics\", 0] }\n    }\n  }\n])","language":"mongosh","result":[{"restaurants":[],"quarter":"Q2 2025"}],"executionTimeMs":1709,"queryOperators":["$match","$regex","$options","$unwind","$addFields","$cond","$and","$gte","$lte","$in","$sort","$group","$avg","$first","$push","$project","$filter","$eq","$round","$arrayElemAt","$ne","$multiply","$divide","$subtract","$facet","$reduce","$concatArrays","$sum","$arrayToObject"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"What are the 15 restaurants in Queens and Brooklyn with at least 4 A grades in a row?","dbQuery":"db.restaurants.aggregate([\n  // Filter for restaurants in Queens and Brooklyn\n  {\n    $match: {\n      borough: { $in: [\"Queens\", \"Brooklyn\"] }\n    }\n  },\n  // Calculate consecutive A grades\n  {\n    $addFields: {\n      consecutiveAGrades: {\n        $reduce: {\n          input: \"$grades\",\n          initialValue: { maxConsecutive: 0, currentConsecutive: 0 },\n          in: {\n            $cond: {\n              if: { $eq: [\"$$this.grade\", \"A\"] },\n              then: {\n                maxConsecutive: {\n                  $max: [\n                    \"$$value.maxConsecutive\",\n                    { $add: [\"$$value.currentConsecutive\", 1] }\n                  ]\n                },\n                currentConsecutive: { $add: [\"$$value.currentConsecutive\", 1] }\n              },\n              else: {\n                maxConsecutive: \"$$value.maxConsecutive\",\n                currentConsecutive: 0\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  // Extract the maximum consecutive count\n  {\n    $addFields: {\n      consecutiveAGrades: \"$consecutiveAGrades.maxConsecutive\"\n    }\n  },\n  // Filter for restaurants with at least 4 consecutive A grades\n  {\n    $match: {\n      consecutiveAGrades: { $gte: 4 }\n    }\n  },\n  // Project only required fields\n  {\n    $project: {\n      name: 1,\n      borough: 1,\n      cuisine: 1,\n      consecutiveAGrades: 1\n    }\n  },\n  // Limit to 15 results\n  {\n    $limit: 15\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f4292a","borough":"Brooklyn","cuisine":"American","name":"Riviera Caterer","consecutiveAGrades":4},{"_id":"5eb3d668b31de5d588f4293c","borough":"Brooklyn","cuisine":"American","name":"The Movable Feast","consecutiveAGrades":4},{"_id":"5eb3d668b31de5d588f42971","borough":"Brooklyn","cuisine":"American","name":"Junior'S","consecutiveAGrades":4},{"_id":"5eb3d668b31de5d588f429a4","borough":"Brooklyn","cuisine":"Italian","name":"Gargiulo'S Restaurant","consecutiveAGrades":4},{"_id":"5eb3d668b31de5d588f429cf","borough":"Brooklyn","cuisine":"American","name":"Brennan & Carr","consecutiveAGrades":5},{"_id":"5eb3d668b31de5d588f429df","borough":"Brooklyn","cuisine":"American","name":"Narrows Coffee Shop","consecutiveAGrades":4},{"_id":"5eb3d668b31de5d588f42a3a","borough":"Brooklyn","cuisine":"Hamburgers","name":"White Castle","consecutiveAGrades":4},{"_id":"5eb3d668b31de5d588f42966","borough":"Brooklyn","cuisine":"Steak","name":"Peter Luger Steakhouse","consecutiveAGrades":5},{"_id":"5eb3d668b31de5d588f4298d","borough":"Brooklyn","cuisine":"Italian","name":"New Corner","consecutiveAGrades":5},{"_id":"5eb3d668b31de5d588f4299e","borough":"Brooklyn","cuisine":"Pizza","name":"J&V Famous Pizza","consecutiveAGrades":5},{"_id":"5eb3d668b31de5d588f429b2","borough":"Brooklyn","cuisine":"Italian","name":"Michael'S Restaurant","consecutiveAGrades":4},{"_id":"5eb3d668b31de5d588f42a72","borough":"Brooklyn","cuisine":"Jewish/Kosher","name":"Dairy Luncheonette","consecutiveAGrades":5},{"_id":"5eb3d668b31de5d588f42a79","borough":"Brooklyn","cuisine":"American","name":"Mariner Inn","consecutiveAGrades":4},{"_id":"5eb3d668b31de5d588f42ab1","borough":"Brooklyn","cuisine":"Hamburgers","name":"Mcdonald'S","consecutiveAGrades":6},{"_id":"5eb3d668b31de5d588f42acb","borough":"Brooklyn","cuisine":"American","name":"Vegas Diner","consecutiveAGrades":6}],"executionTimeMs":4163,"queryOperators":["$match","$in","$addFields","$reduce","$cond","$eq","$max","$add","$gte","$project","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Which 15 Latin restaurants in Brooklyn have the longest consecutive streak of A grades, and what are their average scores?","dbQuery":"db.restaurants.aggregate([\n  // Stage 1: Filter for Latin restaurants in Brooklyn\n  {\n    $match: {\n      borough: \"Brooklyn\",\n      cuisine: \"Latin (Cuban, Dominican, Puerto Rican, South & Central American)\"\n    }\n  },\n  \n  // Stage 2: Calculate consecutive A grades and statistics\n  {\n    $addFields: {\n      // Calculate consecutive A grades from the beginning\n      consecutiveAGrades: {\n        $reduce: {\n          input: \"$grades\",\n          initialValue: { count: 0, maxCount: 0, currentStreak: 0 },\n          in: {\n            $cond: {\n              if: { $eq: [\"$$this.grade\", \"A\"] },\n              then: {\n                count: { $add: [\"$$value.count\", 1] },\n                maxCount: { $max: [{ $add: [\"$$value.currentStreak\", 1] }, \"$$value.maxCount\"] },\n                currentStreak: { $add: [\"$$value.currentStreak\", 1] }\n              },\n              else: {\n                count: \"$$value.count\",\n                maxCount: \"$$value.maxCount\",\n                currentStreak: 0\n              }\n            }\n          }\n        }\n      },\n      // Calculate average score\n      averageScore: { $avg: \"$grades.score\" },\n      // Get last inspection date\n      lastInspectionDate: { $arrayElemAt: [\"$grades.date\", 0] }\n    }\n  },\n  \n  // Stage 3: Extract the consecutive A grade count\n  {\n    $addFields: {\n      consecutiveAGrades: \"$consecutiveAGrades.maxCount\"\n    }\n  },\n  \n  // Stage 4: Sort by consecutive A grades (descending)\n  {\n    $sort: { consecutiveAGrades: -1 }\n  },\n  \n  // Stage 5: Limit to top 15\n  {\n    $limit: 15\n  },\n  \n  // Stage 6: Project required fields\n  {\n    $project: {\n      name: 1,\n      address: {\n        street: \"$address.street\",\n        building: \"$address.building\"\n      },\n      consecutiveAGrades: 1,\n      averageScore: { $round: [\"$averageScore\", 2] },\n      lastInspectionDate: 1\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f450b5","address":{"street":"3 Avenue","building":"107"},"name":"Lano'S Coffee Shop & Restaurant","consecutiveAGrades":7,"lastInspectionDate":"2014-02-19T00:00:00.000Z","averageScore":10},{"_id":"5eb3d668b31de5d588f44f26","address":{"street":"4 Avenue","building":"4316"},"name":"Mi Castillo Restaurant","consecutiveAGrades":7,"lastInspectionDate":"2014-12-12T00:00:00.000Z","averageScore":10.71},{"_id":"5eb3d668b31de5d588f42db5","address":{"street":"5 Avenue","building":"4408"},"name":"International Restaurant","consecutiveAGrades":6,"lastInspectionDate":"2014-08-04T00:00:00.000Z","averageScore":8.67},{"_id":"5eb3d669b31de5d588f459c1","address":{"street":"Broadway","building":"1571"},"name":"Loma Coffee Shop Ii","consecutiveAGrades":6,"lastInspectionDate":"2014-08-21T00:00:00.000Z","averageScore":11.83},{"_id":"5eb3d668b31de5d588f43fff","address":{"street":"Myrtle Avenue","building":"454"},"name":"El Cofre Restaurant","consecutiveAGrades":6,"lastInspectionDate":"2014-10-31T00:00:00.000Z","averageScore":11.17},{"_id":"5eb3d668b31de5d588f43d4a","address":{"street":"Atlantic Avenue","building":"2729"},"name":"Happy Coffee Shop","consecutiveAGrades":6,"lastInspectionDate":"2014-02-25T00:00:00.000Z","averageScore":7.17},{"_id":"5eb3d669b31de5d588f45288","address":{"street":"Church Avenue","building":"1902"},"name":"Flatbush Latin Grill","consecutiveAGrades":6,"lastInspectionDate":"2014-06-20T00:00:00.000Z","averageScore":10.83},{"_id":"5eb3d668b31de5d588f43dbe","address":{"street":"Sutter Avenue","building":"1377"},"name":"Coco' S Pizza & Restaurant","consecutiveAGrades":6,"lastInspectionDate":"2014-12-24T00:00:00.000Z","averageScore":4.5},{"_id":"5eb3d668b31de5d588f4479b","address":{"street":"Manhattan Avenue","building":"1015"},"name":"Cafecito Bogota","consecutiveAGrades":5,"lastInspectionDate":"2014-06-05T00:00:00.000Z","averageScore":7},{"_id":"5eb3d668b31de5d588f44659","address":{"street":"Flushing Avenue","building":"1047"},"name":"Rinconcito Sabaneno 2","consecutiveAGrades":5,"lastInspectionDate":"2014-05-28T00:00:00.000Z","averageScore":7.6},{"_id":"5eb3d668b31de5d588f432bc","address":{"street":"51 Street","building":"407"},"name":"La Carreta Restaurant","consecutiveAGrades":5,"lastInspectionDate":"2014-10-01T00:00:00.000Z","averageScore":7.4},{"_id":"5eb3d668b31de5d588f44b00","address":{"street":"Bedford Avenue","building":"1000"},"name":"Colador Cafe","consecutiveAGrades":5,"lastInspectionDate":"2014-10-22T00:00:00.000Z","averageScore":10.67},{"_id":"5eb3d668b31de5d588f444ff","address":{"street":"9 Street","building":"317"},"name":"El Viejo Yayo Rest Ii","consecutiveAGrades":5,"lastInspectionDate":"2014-09-22T00:00:00.000Z","averageScore":10.5},{"_id":"5eb3d668b31de5d588f43481","address":{"street":"Foster Avenue","building":"10110"},"name":"Metro Coffee Shop @ Jetro","consecutiveAGrades":5,"lastInspectionDate":"2014-09-23T00:00:00.000Z","averageScore":11},{"_id":"5eb3d668b31de5d588f42f19","address":{"street":"Fifth Avenue","building":"672"},"name":"El Continental Restaurant","consecutiveAGrades":5,"lastInspectionDate":"2014-11-12T00:00:00.000Z","averageScore":11.83}],"executionTimeMs":4363,"queryOperators":["$match","$addFields","$reduce","$cond","$eq","$add","$max","$avg","$arrayElemAt","$sort","$limit","$project","$round"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Show me 12 restaurants in Brooklyn that improved from B or C grades to maintaining A grades in their last 3 inspections","dbQuery":"db.restaurants.aggregate([\n  // Filter for Brooklyn restaurants\n  {\n    $match: {\n      borough: \"Brooklyn\"\n    }\n  },\n  // Ensure restaurant has at least 3 inspections\n  {\n    $match: {\n      $expr: { $gte: [{ $size: \"$grades\" }, 3] }\n    }\n  },\n  // Add fields for analysis\n  {\n    $addFields: {\n      // Get the last 3 grades\n      last3Grades: { $slice: [\"$grades\", 0, 3] },\n      // Get all grades except the last 3\n      previousGrades: { $slice: [\"$grades\", 3, { $size: \"$grades\" }] }\n    }\n  },\n  // Check if all last 3 grades are A\n  {\n    $match: {\n      $expr: {\n        $eq: [\n          { $size: {\n            $filter: {\n              input: \"$last3Grades\",\n              cond: { $eq: [\"$$this.grade\", \"A\"] }\n            }\n          }},\n          3\n        ]\n      }\n    }\n  },\n  // Check if there's at least one B or C grade before the A streak\n  {\n    $match: {\n      $expr: {\n        $gt: [\n          { $size: {\n            $filter: {\n              input: \"$previousGrades\",\n              cond: { $in: [\"$$this.grade\", [\"B\", \"C\"]] }\n            }\n          }},\n          0\n        ]\n      }\n    }\n  },\n  // Project the required fields\n  {\n    $project: {\n      name: 1,\n      cuisine: 1,\n      // Get the most recent B or C grade before the A streak\n      previousGrade: {\n        $arrayElemAt: [\n          {\n            $map: {\n              input: {\n                $filter: {\n                  input: \"$previousGrades\",\n                  cond: { $in: [\"$$this.grade\", [\"B\", \"C\"]] }\n                }\n              },\n              in: \"$$this.grade\"\n            }\n          },\n          0\n        ]\n      },\n      currentStreak: { $literal: 3 },\n      latestScore: { $arrayElemAt: [\"$last3Grades.score\", 0] },\n      // Date of the oldest A grade in the current streak (3rd most recent)\n      improvementDate: { $arrayElemAt: [\"$last3Grades.date\", 2] }\n    }\n  },\n  // Limit to 12 results\n  {\n    $limit: 12\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f42975","cuisine":"Polish","name":"Polish National Home","previousGrade":"C","currentStreak":3,"latestScore":2,"improvementDate":"2012-02-17T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f429b2","cuisine":"Italian","name":"Michael'S Restaurant","previousGrade":"B","currentStreak":3,"latestScore":9,"improvementDate":"2013-01-22T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42a79","cuisine":"American","name":"Mariner Inn","previousGrade":"B","currentStreak":3,"latestScore":10,"improvementDate":"2012-08-09T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42a4d","cuisine":"Italian","name":"Bamonte'S Restaurant","previousGrade":"B","currentStreak":3,"latestScore":12,"improvementDate":"2013-05-29T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42abd","cuisine":"American","name":"Turkey'S Nest Tavern","previousGrade":"B","currentStreak":3,"latestScore":4,"improvementDate":"2012-01-17T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42935","cuisine":"Jewish/Kosher","name":"Seuda Foods","previousGrade":"B","currentStreak":3,"latestScore":11,"improvementDate":"2012-10-04T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f429b9","cuisine":"American","name":"Three Star Restaurant","previousGrade":"B","currentStreak":3,"latestScore":12,"improvementDate":"2013-02-13T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f429c9","cuisine":"American","name":"Roll-N-Roaster","previousGrade":"B","currentStreak":3,"latestScore":5,"improvementDate":"2013-06-25T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42b12","cuisine":"American","name":"Rex Manor","previousGrade":"B","currentStreak":3,"latestScore":12,"improvementDate":"2013-06-26T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42ad6","cuisine":"Italian","name":"Marco Polo Ristorante","previousGrade":"B","currentStreak":3,"latestScore":12,"improvementDate":"2012-12-29T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42a56","cuisine":"American","name":"Greenpoint Tavern","previousGrade":"B","currentStreak":3,"latestScore":12,"improvementDate":"2012-03-15T00:00:00.000Z"},{"_id":"5eb3d668b31de5d588f42afb","cuisine":"Jewish/Kosher","name":"Kosher Hut Of Brooklyn","previousGrade":"C","currentStreak":3,"latestScore":7,"improvementDate":"2013-01-31T00:00:00.000Z"}],"executionTimeMs":4269,"queryOperators":["$match","$expr","$gte","$size","$addFields","$slice","$eq","$filter","$gt","$in","$project","$arrayElemAt","$map","$literal","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Which borough had the first Mexican restaurants based on earliest inspection dates, and when did they appear?","dbQuery":"db.restaurants.aggregate([\n  // Match Mexican restaurants\n  {\n    $match: {\n      cuisine: \"Mexican\"\n    }\n  },\n  // Unwind grades array to work with individual inspection records\n  {\n    $unwind: \"$grades\"\n  },\n  // Group by restaurant to find earliest inspection date per restaurant\n  {\n    $group: {\n      _id: {\n        restaurant_id: \"$restaurant_id\",\n        name: \"$name\",\n        borough: \"$borough\"\n      },\n      earliestDate: { $min: \"$grades.date\" }\n    }\n  },\n  // Sort by earliest date to find the absolute earliest\n  {\n    $sort: {\n      earliestDate: 1\n    }\n  },\n  // Group by borough to find the earliest restaurant in each borough\n  {\n    $group: {\n      _id: \"$_id.borough\",\n      earliestDate: { $first: \"$earliestDate\" },\n      restaurantName: { $first: \"$_id.name\" }\n    }\n  },\n  // Sort by earliest date again\n  {\n    $sort: {\n      earliestDate: 1\n    }\n  },\n  // Limit to the borough with the earliest Mexican restaurant\n  {\n    $limit: 1\n  },\n  // Project to match the desired output format\n  {\n    $project: {\n      _id: 0,\n      borough: \"$_id\",\n      earliestDate: 1,\n      restaurantName: 1\n    }\n  }\n])","language":"mongosh","result":[{"earliestDate":"2011-02-09T00:00:00.000Z","restaurantName":"Blockhead'S Mexican Diner","borough":"Manhattan"}],"executionTimeMs":4106,"queryOperators":["$match","$unwind","$group","$min","$sort","$first","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the restaurant count for each of NYC's five boroughs sorted by the number of restaurants from highest to lowest","dbQuery":"db.restaurants.aggregate([\n  {\n    $group: {\n      _id: \"$borough\",\n      restaurantCount: { $sum: 1 }\n    }\n  },\n  {\n    $project: {\n      borough: \"$_id\",\n      restaurantCount: 1,\n      _id: 0\n    }\n  },\n  {\n    $sort: { restaurantCount: -1 }\n  }\n])","language":"mongosh","result":[{"restaurantCount":10259,"borough":"Manhattan"},{"restaurantCount":6086,"borough":"Brooklyn"},{"restaurantCount":5656,"borough":"Queens"},{"restaurantCount":2338,"borough":"Bronx"},{"restaurantCount":969,"borough":"Staten Island"},{"restaurantCount":51,"borough":"Missing"}],"executionTimeMs":4034,"queryOperators":["$group","$sum","$project","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Compare the restaurant density between Manhattan and Queens by calculating restaurants per square mile for each borough","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      borough: { $in: [\"Manhattan\", \"Queens\"] }\n    }\n  },\n  {\n    $group: {\n      _id: \"$borough\",\n      restaurantCount: { $sum: 1 }\n    }\n  },\n  {\n    $project: {\n      _id: 0,\n      borough: \"$_id\",\n      restaurantCount: 1,\n      densityPerSquareMile: {\n        $round: [\n          {\n            $switch: {\n              branches: [\n                {\n                  case: { $eq: [\"$_id\", \"Manhattan\"] },\n                  then: { $divide: [\"$restaurantCount\", 22.83] }\n                },\n                {\n                  case: { $eq: [\"$_id\", \"Queens\"] },\n                  then: { $divide: [\"$restaurantCount\", 108.1] }\n                }\n              ],\n              default: 0\n            }\n          },\n          2\n        ]\n      }\n    }\n  },\n  {\n    $sort: { densityPerSquareMile: -1 }\n  }\n])","language":"mongosh","result":[{"restaurantCount":10259,"borough":"Manhattan","densityPerSquareMile":449.36},{"restaurantCount":5656,"borough":"Queens","densityPerSquareMile":52.32}],"executionTimeMs":3961,"queryOperators":["$match","$in","$group","$sum","$project","$round","$switch","$eq","$divide","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the top 10 restaurants that improved from a B grade to an A grade and how many days it took them to recover","dbQuery":"db.restaurants.aggregate([\n  // First, filter restaurants that have both A and B grades\n  {\n    $match: {\n      \"grades.grade\": { $in: [\"A\", \"B\"] }\n    }\n  },\n  // Calculate recovery times for B to A transitions\n  {\n    $addFields: {\n      recoveryTimes: {\n        $reduce: {\n          input: { $range: [0, { $subtract: [{ $size: \"$grades\" }, 1] }] },\n          initialValue: [],\n          in: {\n            $let: {\n              vars: {\n                currentGrade: { $arrayElemAt: [\"$grades\", \"$$this\"] },\n                nextGrade: { $arrayElemAt: [\"$grades\", { $add: [\"$$this\", 1] }] }\n              },\n              in: {\n                $cond: {\n                  if: {\n                    $and: [\n                      { $eq: [\"$$currentGrade.grade\", \"B\"] },\n                      { $eq: [\"$$nextGrade.grade\", \"A\"] }\n                    ]\n                  },\n                  then: {\n                    $concatArrays: [\n                      \"$$value\",\n                      [{\n                        daysToRecover: {\n                          $divide: [\n                            { $subtract: [\"$$nextGrade.date\", \"$$currentGrade.date\"] },\n                            86400000 // Convert milliseconds to days\n                          ]\n                        },\n                        bGradeDate: \"$$currentGrade.date\",\n                        aGradeDate: \"$$nextGrade.date\"\n                      }]\n                    ]\n                  },\n                  else: \"$$value\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  // Filter out restaurants with no B to A recoveries\n  {\n    $match: {\n      recoveryTimes: { $ne: [] }\n    }\n  },\n  // Unwind the recovery times to get one document per recovery\n  {\n    $unwind: \"$recoveryTimes\"\n  },\n  // Sort by recovery time (fastest first)\n  {\n    $sort: { \"recoveryTimes.daysToRecover\": 1 }\n  },\n  // Limit to top 10\n  {\n    $limit: 10\n  },\n  // Project final result\n  {\n    $project: {\n      name: 1,\n      daysToRecover: \"$recoveryTimes.daysToRecover\"\n    }\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d669b31de5d588f462cc","name":"Sal'S Family Pizza","daysToRecover":-1009},{"_id":"5eb3d668b31de5d588f42c97","name":"Gun Post Lanes Snack Bar","daysToRecover":-733},{"_id":"5eb3d669b31de5d588f45b48","name":"Ruby Falls Nightlife Cafe","daysToRecover":-722},{"_id":"5eb3d668b31de5d588f43295","name":"El Caramelo Coffee Shop","daysToRecover":-699},{"_id":"5eb3d668b31de5d588f43b79","name":"Time Warner(Cafeteria)","daysToRecover":-617},{"_id":"5eb3d669b31de5d588f459ab","name":"Liquid Lounge","daysToRecover":-604},{"_id":"5eb3d668b31de5d588f44e77","name":"The Griffin","daysToRecover":-602},{"_id":"5eb3d669b31de5d588f45efe","name":"Srb Brooklyn","daysToRecover":-602},{"_id":"5eb3d668b31de5d588f439d0","name":"Uncle Louie G'S Italian Ices & Ice Cream","daysToRecover":-588},{"_id":"5eb3d668b31de5d588f44305","name":"All Star Pizza","daysToRecover":-577}],"executionTimeMs":5630,"queryOperators":["$match","$in","$addFields","$reduce","$range","$subtract","$size","$let","$arrayElemAt","$add","$cond","$and","$eq","$concatArrays","$divide","$ne","$unwind","$sort","$limit","$project"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"moderate","databaseName":"sample_restaurants"}
{"nlQuery":"What's the average time it takes for restaurants in each borough to recover from a C grade back to an A grade, showing only boroughs with at least 5 such recoveries?","dbQuery":"db.restaurants.aggregate([\n  // Unwind grades array to work with individual grades\n  { $unwind: \"$grades\" },\n  \n  // Sort by restaurant and date to ensure chronological order\n  { $sort: { \"_id\": 1, \"grades.date\": 1 } },\n  \n  // Group back by restaurant to get ordered grades array\n  {\n    $group: {\n      _id: \"$_id\",\n      borough: { $first: \"$borough\" },\n      name: { $first: \"$name\" },\n      grades: { $push: \"$grades\" }\n    }\n  },\n  \n  // Process each restaurant to find C->A recoveries\n  {\n    $project: {\n      borough: 1,\n      name: 1,\n      recoveries: {\n        $reduce: {\n          input: { $range: [1, { $size: \"$grades\" }] },\n          initialValue: [],\n          in: {\n            $cond: [\n              // Check if previous grade is C and current grade is A\n              {\n                $and: [\n                  { $eq: [{ $arrayElemAt: [\"$grades.grade\", { $subtract: [\"$$this\", 1] }] }, \"C\"] },\n                  { $eq: [{ $arrayElemAt: [\"$grades.grade\", \"$$this\"] }, \"A\"] }\n                ]\n              },\n              // If C->A recovery found, add the recovery time in milliseconds\n              {\n                $concatArrays: [\n                  \"$$value\",\n                  [{\n                    recoveryTimeMs: {\n                      $subtract: [\n                        { $arrayElemAt: [\"$grades.date\", \"$$this\"] },\n                        { $arrayElemAt: [\"$grades.date\", { $subtract: [\"$$this\", 1] }] }\n                      ]\n                    }\n                  }]\n                ]\n              },\n              \"$$value\"\n            ]\n          }\n        }\n      }\n    }\n  },\n  \n  // Filter out restaurants with no recoveries\n  { $match: { \"recoveries.0\": { $exists: true } } },\n  \n  // Unwind recoveries to calculate averages\n  { $unwind: \"$recoveries\" },\n  \n  // Convert recovery time from milliseconds to days\n  {\n    $project: {\n      borough: 1,\n      recoveryDays: { $divide: [\"$recoveries.recoveryTimeMs\", 1000 * 60 * 60 * 24] }\n    }\n  },\n  \n  // Group by borough to calculate averages\n  {\n    $group: {\n      _id: \"$borough\",\n      avgRecoveryDays: { $avg: \"$recoveryDays\" },\n      recoveryCount: { $sum: 1 }\n    }\n  },\n  \n  // Filter boroughs with at least 5 recoveries\n  { $match: { recoveryCount: { $gte: 5 } } },\n  \n  // Format output\n  {\n    $project: {\n      borough: \"$_id\",\n      avgRecoveryDays: { $round: [\"$avgRecoveryDays\", 2] },\n      recoveryCount: 1\n    }\n  },\n  \n  // Sort by average recovery days\n  { $sort: { avgRecoveryDays: 1 } }\n])","language":"mongosh","result":[{"_id":"Bronx","recoveryCount":173,"borough":"Bronx","avgRecoveryDays":161.1},{"_id":"Brooklyn","recoveryCount":490,"borough":"Brooklyn","avgRecoveryDays":164.02},{"_id":"Queens","recoveryCount":375,"borough":"Queens","avgRecoveryDays":167.67},{"_id":"Manhattan","recoveryCount":806,"borough":"Manhattan","avgRecoveryDays":170},{"_id":"Staten Island","recoveryCount":54,"borough":"Staten Island","avgRecoveryDays":198.19}],"executionTimeMs":6064,"queryOperators":["$unwind","$sort","$group","$first","$push","$project","$reduce","$range","$size","$cond","$and","$eq","$arrayElemAt","$subtract","$concatArrays","$match","$exists","$divide","$avg","$sum","$gte","$round"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
{"nlQuery":"Show me the count of restaurants for each health grade (A, B, C) based on their most recent inspection","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      grades: { $exists: true, $ne: [], $type: \"array\" }\n    }\n  },\n  {\n    $project: {\n      mostRecentGrade: { $arrayElemAt: [\"$grades.grade\", 0] }\n    }\n  },\n  {\n    $group: {\n      _id: \"$mostRecentGrade\",\n      count: { $sum: 1 }\n    }\n  },\n  {\n    $sort: { _id: 1 }\n  }\n])","language":"mongosh","result":[{"_id":"A","count":20687},{"_id":"B","count":1852},{"_id":"C","count":220},{"_id":"Not Yet Graded","count":525},{"_id":"Z","count":1337}],"executionTimeMs":4567,"queryOperators":["$match","$exists","$ne","$type","$project","$arrayElemAt","$group","$sum","$sort"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"simple","databaseName":"sample_restaurants"}
{"nlQuery":"Find 10 restaurants that have had at least 5 inspections with the highest variance in their inspection scores, showing their name, average score, and the difference between their highest and lowest scores","dbQuery":"db.restaurants.aggregate([\n  {\n    $match: {\n      $expr: { $gte: [{ $size: \"$grades\" }, 5] }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      restaurant_id: 1,\n      inspectionCount: { $size: \"$grades\" },\n      scores: {\n        $map: {\n          input: \"$grades\",\n          as: \"grade\",\n          in: \"$$grade.score\"\n        }\n      }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      restaurant_id: 1,\n      inspectionCount: 1,\n      averageScore: { $avg: \"$scores\" },\n      highestScore: { $max: \"$scores\" },\n      lowestScore: { $min: \"$scores\" }\n    }\n  },\n  {\n    $project: {\n      name: 1,\n      restaurant_id: 1,\n      inspectionCount: 1,\n      averageScore: { $round: [\"$averageScore\", 2] },\n      highestScore: 1,\n      lowestScore: 1,\n      scoreRange: { $subtract: [\"$highestScore\", \"$lowestScore\"] }\n    }\n  },\n  {\n    $sort: { scoreRange: -1 }\n  },\n  {\n    $limit: 10\n  }\n])","language":"mongosh","result":[{"_id":"5eb3d668b31de5d588f42a92","name":"Murals On 54/Randolphs'S","restaurant_id":"40372466","inspectionCount":6,"highestScore":131,"lowestScore":11,"averageScore":33.67,"scoreRange":120},{"_id":"5eb3d669b31de5d588f45cb1","name":"Baluchi'S Indian Food","restaurant_id":"41569277","inspectionCount":6,"highestScore":98,"lowestScore":7,"averageScore":27.83,"scoreRange":91},{"_id":"5eb3d668b31de5d588f42b26","name":"Gandhi","restaurant_id":"40381295","inspectionCount":7,"highestScore":92,"lowestScore":2,"averageScore":24.14,"scoreRange":90},{"_id":"5eb3d668b31de5d588f42c88","name":"Bella Napoli","restaurant_id":"40393488","inspectionCount":5,"highestScore":98,"lowestScore":11,"averageScore":38.6,"scoreRange":87},{"_id":"5eb3d668b31de5d588f43a69","name":"Bistro Caterers","restaurant_id":"40987023","inspectionCount":6,"highestScore":84,"lowestScore":5,"averageScore":29,"scoreRange":79},{"_id":"5eb3d668b31de5d588f43383","name":"B.B. Kings","restaurant_id":"40704853","inspectionCount":7,"highestScore":80,"lowestScore":5,"averageScore":28.43,"scoreRange":75},{"_id":"5eb3d669b31de5d588f47161","name":"Lexington Restaurant","restaurant_id":"41720706","inspectionCount":5,"highestScore":79,"lowestScore":5,"averageScore":24.4,"scoreRange":74},{"_id":"5eb3d669b31de5d588f467e4","name":"Cheikh Umar Futiyu Restaurant","restaurant_id":"41660581","inspectionCount":7,"highestScore":78,"lowestScore":4,"averageScore":30.29,"scoreRange":74},{"_id":"5eb3d668b31de5d588f43fc7","name":"New Heights Bar And Restaurant","restaurant_id":"41135835","inspectionCount":6,"highestScore":73,"lowestScore":0,"averageScore":25.67,"scoreRange":73},{"_id":"5eb3d668b31de5d588f447ee","name":"Brothers Fish Market","restaurant_id":"41297769","inspectionCount":6,"highestScore":77,"lowestScore":5,"averageScore":26.33,"scoreRange":72}],"executionTimeMs":5236,"queryOperators":["$match","$expr","$gte","$size","$project","$map","$avg","$max","$min","$round","$subtract","$sort","$limit"],"methods":["aggregate"],"isReferenceAnswer":true,"complexity":"complex","databaseName":"sample_restaurants"}
